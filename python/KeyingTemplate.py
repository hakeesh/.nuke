set cut_paste_input [stack 0]
version 12.2 v2
BackdropNode {
inputs 0
name BackdropNode8
tile_color 0x3b4245ff
label "Advanced Keying Template"
note_font_size 200
note_font_color 0xffffffff
selected true
xpos -37212
ypos 11769
bdwidth 8480
bdheight 9896
z_order -2
}
BackdropNode {
inputs 0
name BackdropNode10
tile_color 0x374935ff
label "Green\nScreen Footage"
note_font_size 112
selected true
xpos -34840
ypos 12106
bdwidth 1208
bdheight 847
}
BackdropNode {
inputs 0
name BackdropNode11
tile_color 0x5c5539ff
label "Edge Matte"
note_font_size 140
note_font_color 0xffffffff
selected true
xpos -31964
ypos 13925
bdwidth 1411
bdheight 2103
}
BackdropNode {
inputs 0
name BackdropNode12
tile_color 0x61454f00
label Cleanplate
note_font_size 140
note_font_color 0xffffffff
selected true
xpos -30381
ypos 13928
bdwidth 1026
bdheight 1464
}
BackdropNode {
inputs 0
name BackdropNode13
tile_color 0x6b506800
label "inject alpha"
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -34532
ypos 16891
bdwidth 514
bdheight 240
}
BackdropNode {
inputs 0
name BackdropNode19
tile_color 0x666d6500
label LightWrap
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -34577
ypos 20890
bdwidth 719
bdheight 391
}
BackdropNode {
inputs 0
name BackdropNode22
tile_color 0x6a5353ff
label "Keep Util Channels"
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -34936
ypos 16494
bdwidth 634
bdheight 344
}
BackdropNode {
inputs 0
name BackdropNode25
tile_color 0x535a6bff
label "Comine Despill"
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -34918
ypos 15760
bdwidth 1009
bdheight 557
}
BackdropNode {
inputs 0
name BackdropNode27
tile_color 0x47633eff
label "Additive Keyer"
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -27583
ypos 21312
bdwidth 665
bdheight 399
}
BackdropNode {
inputs 0
name BackdropNode35
tile_color 0x687675ff
label premult
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -34498
ypos 20568
bdwidth 160
bdheight 160
}
BackdropNode {
inputs 0
name BackdropNode38
tile_color 0x4c5e5bff
label "Making BG Stamp\nfor BG Blend and Lightwrap"
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -27550
ypos 20914
bdwidth 736
bdheight 282
}
BackdropNode {
inputs 0
name BackdropNode39
tile_color 0x645c38ff
label "BG despill edge blending"
note_font_size 62
note_font_color 0xffffffff
selected true
xpos -34735
ypos 19472
bdwidth 1601
bdheight 854
}
BackdropNode {
inputs 0
name BackdropNode40
tile_color 0x39525cff
label "Core Despill"
note_font_size 140
note_font_color 0xffffffff
selected true
xpos -36291
ypos 14002
bdwidth 1205
bdheight 1295
}
BackdropNode {
inputs 0
name BackdropNode41
tile_color 0x4b6648ff
label "creating GS channel\nfor review at bottom of key"
note_font_size 42
note_font_color 0xffffffff
selected true
xpos -34645
ypos 13073
bdwidth 554
bdheight 462
}
BackdropNode {
inputs 0
name BackdropNode42
tile_color 0x472e5500
label Transforms
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -34647
ypos 18298
bdwidth 478
bdheight 481
}
BackdropNode {
inputs 0
name BackdropNode43
tile_color 0x39525cff
label "Core Matte"
note_font_size 140
note_font_color 0xffffffff
selected true
xpos -33135
ypos 13941
bdwidth 1097
bdheight 1475
}
BackdropNode {
inputs 0
name BackdropNode44
tile_color 0x5c5539ff
label "Edge Despill"
note_font_size 140
note_font_color 0xffffffff
selected true
xpos -34932
ypos 13977
bdwidth 1485
bdheight 1364
}
BackdropNode {
inputs 0
name BackdropNode45
tile_color 0x808080ff
label "Output Stamps"
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -34495
ypos 18991
bdwidth 922
bdheight 305
}
BackdropNode {
inputs 0
name BackdropNode46
tile_color 0x4e3f6800
label "GS Plate (transformed)\nfor QC comparison"
note_font_size 30
note_font_color 0xffffffff
selected true
xpos -27705
ypos 21981
bdwidth 350
bdheight 243
}
BackdropNode {
inputs 0
name BackdropNode47
tile_color 0x667c7c00
label "BG Element"
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -27482
ypos 12773
bdwidth 610
bdheight 387
}
BackdropNode {
inputs 0
name BackdropNode48
tile_color 0x8e388e00
label "Clean Plate tools"
note_font_size 42
selected true
xpos -31768
ypos 12932
bdwidth 620
bdheight 666
}
BackdropNode {
inputs 0
name BackdropNode5
tile_color 0x5a3f6200
label "inject cleanplate"
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -34534
ypos 17187
bdwidth 511
bdheight 299
}
BackdropNode {
inputs 0
name BackdropNode50
tile_color 0x7171c600
label "useful tools"
note_font_size 42
selected true
xpos -32795
ypos 13109
bdwidth 518
bdheight 468
}
BackdropNode {
inputs 0
name BackdropNode63
tile_color 0x503d4600
label "test BG"
note_font_size 60
note_font_color 0xffffffff
selected true
xpos -27645
ypos 11712
bdwidth 643
bdheight 492
}
BackdropNode {
inputs 0
name BackdropNode7
tile_color 0x5b7179ff
label "exponentially blurring inwards\nfor blending the core/edge despills"
note_font_size 26
note_font_color 0xffffffff
selected true
xpos -33219
ypos 15830
bdwidth 420
bdheight 275
}
BackdropNode {
inputs 0
name BackdropNode9
tile_color 0x4e6689ff
label "Color Corrections"
note_font_size 50
note_font_color 0xffffffff
selected true
xpos -34626
ypos 17689
bdwidth 433
bdheight 480
}
push $cut_paste_input
Roto {
output alpha
cliptype none
curves {{{v x3f99999a}
  {f 0}
  {n
   {layer Root
    {f 2097152}
    {t x44800000 x44070000}
    {a pt1x 0 pt1y 0 pt2x 0 pt2y 0 pt3x 0 pt3y 0 pt4x 0 pt4y 0 ptex00 0 ptex01 0 ptex02 0 ptex03 0 ptex10 0 ptex11 0 ptex12 0 ptex13 0 ptex20 0 ptex21 0 ptex22 0 ptex23 0 ptex30 0 ptex31 0 ptex32 0 ptex33 0 ptof1x 0 ptof1y 0 ptof2x 0 ptof2y 0 ptof3x 0 ptof3y 0 ptof4x 0 ptof4y 0 pterr 0 ptrefset 0 ptmot x40800000 ptref 0}
    {curvegroup Ellipse1 512 bezier
     {{cc
       {f 8192}
       {px x447ec000
        {xc227e500 0}
        {x44750000 x44500000}
        {x4227e500 0}
        {0 xc2a379f0}
        {x44840000 x44750000}
        {0 x42a379f0}
        {x4227e500 0}
        {x44750000 x448d0000}
        {xc227e500 0}
        {0 x42a379f0}
        {x44620000 x44750000}
        {0 xc2a379f0}}}
      {cc
       {f 8192}
       {p
        {{{x447ec000 xc227e500}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 0}}}
        {{{x447ec000 x4227e500}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 xc2a379f0}}}
        {{{x447ec000 0}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 x42a379f0}}}
        {{{x447ec000 x4227e500}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 0}}}
        {{{x447ec000 xc227e500}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 x42a379f0}}}
        {{{x447ec000 0}}
      {{x447ec000 0}}}
        {{{x447ec000 0}}
      {{x447ec000 xc2a379f0}}}}}}
     {tx x447ec000 x44750000 x44750000}
     {a osw x41200000 osf 0 str 1 spx x44800000 spy x44070000 sb 1 ltn x447ec000 ltm x447ec000 tt x40e00000}}}}}}
toolbox {selectAll {
  { selectAll str 1 ssx 1 ssy 1 sf 1 }
  { createBezier str 1 ssx 1 ssy 1 sf 1 sb 1 tt 4 }
  { createBezierCusped str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { createBSpline str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { createEllipse str 1 ssx 1 ssy 1 sf 1 sb 1 tt 7 }
  { createRectangle str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { createRectangleCusped str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { brush str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { eraser src 2 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { clone src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { reveal src 3 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { dodge src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { burn src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { blur src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { sharpen src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
  { smear src 1 str 1 ssx 1 ssy 1 sf 1 sb 1 }
} }
toolbar_brush_hardness 0.200000003
toolbar_source_transform_scale {1 1}
toolbar_source_transform_center {1024 540}
colorOverlay {0 0 0 0}
lifetime_type "all frames"
lifetime_start 1019
lifetime_end 1019
motionblur_shutter_offset_type centred
source_black_outside true
name Roto17
selected true
xpos -27425
ypos 11944
}
Blur {
size 100
name Blur16
label "\[value size]"
selected true
xpos -27425
ypos 12004
}
Constant {
inputs 0
channels rgb
color {2.960000038 2.999999762 3.039999962 12}
name Constant3
selected true
xpos -27569
ypos 12054
}
CheckerBoard2 {
inputs 0
name CheckerBoard3
selected true
xpos -27248
ypos 11778
}
Grade {
multiply 0.105
name Grade34
selected true
xpos -27248
ypos 11890
}
Keymix {
inputs 3
channels rgba
name Keymix5
selected true
xpos -27248
ypos 12078
disable true
}
Dot {
name Dot111
label BG_ELEMENT
note_font_size 51
selected true
xpos -27214
ypos 13035
}
Dot {
name Dot11
label BG
note_font_size 71
selected true
xpos -27214
ypos 21101
}
set N79bbac00 [stack 0]
NoOp {
name Anchor_3cad2b60ea1
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
knobChanged stamps.anchorKnobChanged()
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0xffffff01
note_font_size 20
selected true
xpos -27420
ypos 21093
addUserKnob {20 anchor_tab l "Anchor Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "BG Before Key"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "BG Before Key"}
addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_3cad2b60ea}
addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
tags 2D,
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
set N79bba800 [stack 0]
NoOp {
name Stamp1
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
knobChanged "import stamps; stamps.wiredKnobChanged()"
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0x1000001
note_font "Bitstream Vera Sans"
note_font_size 20
selected true
xpos -34154
ypos 20988
hide_input true
addUserKnob {20 wired_tab l "Wired Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "BG Before Key"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "BG Before Key"}
addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." +HIDDEN T " "}
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 anchor_label l Anchor: T " "}
addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
addUserKnob {26 space_1 l "" +STARTLINE T " "}
addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
addUserKnob {26 space_2 l "" +STARTLINE T " "}
addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
addUserKnob {1 anchor l Anchor}
anchor Anchor_3cad2b60ea
addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Dot {
name Dot12
label BG
note_font_size 101
selected true
xpos -34120
ypos 21129
}
Read {
inputs 0
file_type exr
file J:/FAR_AWAY_DOWNS_4159/_shots/002/002-0035/conform/pl02/Comp/002-0035_conform_pl02_v0001/002-0035_conform_pl02_v0001.####.exr
format "1920 1080 0 0 1920 1080 1 HD_1080"
first 1001
last 1068
origfirst 1001
origlast 1068
origset true
name Read13
tile_color 0xa4c22bff
label "<font color=white><b>002-0035</b></font>\n<font color=white><b>conform pl02</b></font>\n<font color=white><b>v0001</b></font><font size=2>\n<b><font color=grey>Creator: </b><font color=White >David Orman\n<b><font color=grey>Created: </b><font color=White >2020-12-15 15:03:37+11:00\n<b><font color=grey>Status: </b><font color=White >Published</font>"
note_font_color 0xdf77ffff
selected true
xpos -34458
ypos 12268
}
Dot {
name Dot13
label GreenScreenPlate
note_font_size 41
selected true
xpos -34424
ypos 12507
}
AddChannels {
channels rgba
name AddChannels1
selected true
xpos -34458
ypos 12577
}
Dot {
name Dot14
selected true
xpos -34424
ypos 13190
}
add_layer {GS_Plate GS_Plate.red GS_Plate.green GS_Plate.blue GS_Plate.alpha}
Shuffle {
black red
white green
red2 blue
green2 black
out2 GS_Plate
name Shuffle1
label "\[value in] → \[value out2]"
selected true
xpos -34458
ypos 13253
}
Dot {
name Dot15
note_font_size 41
selected true
xpos -34424
ypos 13390
}
set N79bb8400 [stack 0]
Dot {
name Dot16
selected true
xpos -34424
ypos 13720
}
set N79b73c00 [stack 0]
Dot {
name Dot17
selected true
xpos -32628
ypos 13720
}
set N79b73800 [stack 0]
Dot {
name Dot18
selected true
xpos -31364
ypos 13720
}
set N79b73400 [stack 0]
Remove {
operation keep
channels rgb
name Remove1
selected true
xpos -31398
ypos 13841
}
Dot {
name Dot19
note_font_size 41
selected true
xpos -31364
ypos 14119
}
set N79b72c00 [stack 0]
IBKColourV3 {
name IBKColourV3_1
selected true
xpos -31156
ypos 14116
}
Group {
name BinaryAlpha1
tile_color 0x2a2a2aff
label "(\[value an] --> \[value output1])"
note_font Verdana
note_font_color 0xfffff9ff
selected true
xpos -31156
ypos 14174
addUserKnob {20 BinaryAlpha}
addUserKnob {4 an l Analyze: M {rgb rgba alpha "" "" ""}}
addUserKnob {4 output1 l Output: M {rgba alpha "" "" "" ""}}
output1 alpha
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "Analyzes channel input and creates a binary result 0 or 1 and outputs it into output channel" T BinaryAlpha}
addUserKnob {26 ver l Version: T v03}
}
Input {
inputs 0
name Input
xpos -398
ypos 275
}
Expression {
temp_name0 rgb_an
temp_expr0 "r !=0 || g!=0 || b!=0?1:0"
temp_name1 rgba_an
temp_expr1 "r!=0 || g!=0 || b!=0 || a!=0?1:0"
temp_name2 alpha_an
temp_expr2 a!=0?1:0
expr3 "parent.an == 0 ? rgb_an : parent.an == 1 ? rgba_an : alpha_an"
name Expression
xpos -398
ypos 341
}
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle
label "\[value in]"
xpos -398
ypos 367
disable {{parent.output1}}
}
Output {
name Output1
xpos -398
ypos 456
}
end_group
EdgeBlur {
channels rgba
size 10
name EdgeBlur2
selected true
xpos -31156
ypos 14212
}
Group {
name ExponBlurSimple5
onCreate "n = nuke.thisNode()\nn.knob('size').setRange(-100, 100)\nn.knob('adjustBBoxPixels').setRange(0, 400)\nn.knob('adjustBBoxPercent').setRange(1, 2)\nn.knob('safeBBoxPixels').setRange(0, 400)\nn.knob('safeBBoxPercent').setRange(1, 2)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n        \n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n        \nelif k.name() == \"steps\":\n    \n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n        \n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n        \n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('mult').getValue()\n        \n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, b1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression(\"(Blur1.size)*(mult)**%s\"%(i))\n            b\[\"label\"].setValue(\"\[value size]\")\n            merge.setInput(i if i<2 else i+1, b)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n            \n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n            \nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n        \nelif k.name() == \"safeBBox\":\n    if n.knob(\"safeBBox\").getValue() == 0:\n        n.knob('safeBBoxText').setVisible(False)\n        n.knob('safetyBBoxMethod').setVisible(False)\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(False)\n        \n    elif n.knob(\"safeBBox\").getValue() == 1:\n        n.knob('safetyBBoxMethod').setVisible(True)\n        n.knob('safeBBoxText').setVisible(True)\n        if n.knob('safetyBBoxMethod').value() == \"pixels\":\n            n.knob('safeBBoxPixels').setVisible(True)\n            n.knob('safeBBoxPercent').setVisible(False)\n        elif n.knob('safetyBBoxMethod').value() == \"percent\":\n            n.knob('safeBBoxPixels').setVisible(False)\n            n.knob('safeBBoxPercent').setVisible(True)\n            \nelif k.name() == \"safetyBBoxMethod\":\n    if n.knob(\"safetyBBoxMethod\").value() == \"pixels\":\n        n.knob('safeBBoxPixels').setVisible(True)\n        n.knob('safeBBoxPercent').setVisible(False)\n    elif n.knob(\"safetyBBoxMethod\").value() == \"percent\":\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(True)\n        \nelif k.name() == \"adjustBBoxExtra\":\n    if n.knob(\"adjustBBoxExtra\").value() == \"pixels\":\n        n.knob('adjustBBoxPixels').setVisible(True)\n        n.knob('adjustBBoxPercent').setVisible(False)\n    elif n.knob(\"adjustBBoxExtra\").value() == \"percent\":\n        n.knob('adjustBBoxPixels').setVisible(False)\n        n.knob('adjustBBoxPercent').setVisible(True)\n"
tile_color 0xcc804eff
label "(\[value output2])"
note_font "Verdana Bold"
note_font_color 0xffffffff
selected true
xpos -31156
ypos 14269
addUserKnob {20 ExponBlurSimple}
addUserKnob {41 channels T Remove1.channels}
addUserKnob {41 maskChannelMask_1 l area T Multiply1.maskChannelMask}
addUserKnob {41 inject_1 l inject -STARTLINE T Multiply1.inject}
addUserKnob {41 invert_mask_1 l invert -STARTLINE T Multiply1.invert_mask}
addUserKnob {41 fringe_1 l fringe -STARTLINE T Multiply1.fringe}
addUserKnob {26 ""}
addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
output2 Over
addUserKnob {3 steps l "  Steps" -STARTLINE}
steps 4
addUserKnob {26 text l " " -STARTLINE T " "}
addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
includeOriginal true
addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
addUserKnob {14 size l Size R -100 100}
size 2
addUserKnob {7 mult l Multiplier R 1 5}
mult 2.5
addUserKnob {6 clamp +STARTLINE}
addUserKnob {14 postBlur l "Post Blur" R 0 100}
addUserKnob {26 ""}
addUserKnob {20 bboxControl l "BBox Control" n 1}
bboxControl 0
addUserKnob {26 text_2 l " " T " "}
addUserKnob {4 bbox l "BBox: " -STARTLINE M {union intersectionMask A B "input format" "" "" "" "" "" "" "" "" "" "" "" ""}}
addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
addUserKnob {6 safeBBox l "Safe BBox" t "If the output BBox is larger than the input format and the input box combined. the result will be max of the input/format bbox plus a safety \"buffer\" in pixels or percent \n\nTurning off might make your BBox grow exponentially with high blur values" -STARTLINE}
safeBBox true
addUserKnob {26 safeBBoxText l "" +STARTLINE T " "}
addUserKnob {4 safetyBBoxMethod l "Safe BBox Buffer  " -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""}}
safetyBBoxMethod percent
addUserKnob {14 safeBBoxPixels l "" -STARTLINE +HIDDEN R 0 400}
safeBBoxPixels 100
addUserKnob {14 safeBBoxPercent l "" -STARTLINE R 1 2}
safeBBoxPercent 1.1
addUserKnob {26 text_3 l "" +STARTLINE T " "}
addUserKnob {4 adjustBBoxExtra l "Extra BBox Adjust" -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" ""}}
addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
adjustBBoxPercent 1
addUserKnob {14 adjustBBoxPixels l "" -STARTLINE R 0 400}
addUserKnob {26 ""}
addUserKnob {20 endGroup n -1}
addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
addUserKnob {41 mix T MergeKeymix.mix}
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "Tony Lyons"}
addUserKnob {26 desc l Description: T ExponBlurSimple}
addUserKnob {26 ver l Version: T v03}
}
BackdropNode {
inputs 0
name BackdropNode1
tile_color 0x535e5a00
label "BBox Management"
note_font_size 30
note_font_color 0xffffffff
xpos -529
ypos 492
bdwidth 341
bdheight 525
}
Input {
inputs 0
name Inputimg
xpos 0
ypos -969
}
Dot {
name Dot16
note_font_size 41
xpos 34
ypos -802
}
set N18540c00 [stack 0]
Dot {
name Dot2
note_font_size 41
xpos -367
ypos -802
}
Dot {
name Dot18
label B
note_font_size 41
xpos -367
ypos 434
}
Dot {
name Dot11
note_font_size 41
xpos -367
ypos 623
}
set N1d09bc00 [stack 0]
Dot {
name Dot3
note_font_size 41
xpos -367
ypos 675
}
set N1d09b800 [stack 0]
Dot {
name Dot8
note_font_size 41
xpos -463
ypos 675
}
Dot {
name Dot15
note_font_size 41
xpos -463
ypos 831
}
push $N18540c00
Dot {
name Dot1
note_font_size 41
xpos 461
ypos -802
}
Remove {
operation keep
channels rgba
name Remove1
xpos 427
ypos -718
}
Dot {
name Dot21
note_font_size 41
xpos 461
ypos -597
}
set N1d09a400 [stack 0]
Invert {
name Invert1
xpos 695
ypos -604
disable {{"parent.size < 0 ? 0 : 1"}}
}
set N1d09a000 [stack 0]
Dot {
name Dot4
note_font_size 41
xpos 540
ypos -543
}
NoOp {
name Original
xpos 506
ypos -327
}
set N1d099800 [stack 0]
Dot {
name Dot5
note_font_size 41
xpos 540
ypos 14
}
Crop {
inputs 0
box {{"!\[exists parent.input0] ? 0 : input.format.x"} {"!\[exists parent.input0] ? 0 : input.format.y"} {"!\[exists parent.input0] ? 0 : input.format.r"} {"!\[exists parent.input0] ? 0 : input.format.t"}}
reformat true
crop false
name Crop1
xpos 210
ypos -750
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
AddChannels {
channels rgba
name AddChannels2
xpos 210
ypos -724
}
push $N18540c00
Merge2 {
inputs 2
name Merge3
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 83
ypos -671
}
NoOp {
name BBoxInput
xpos 83
ypos -628
addUserKnob {20 User}
addUserKnob {15 bbox}
bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
}
push $N1d099800
Input {
inputs 0
name Inputarea
xpos 289
ypos -638
number 2
}
AddChannels {
channels alpha
color 1
name AddChannels1
xpos 289
ypos -580
}
Invert {
channels rgba
name Invert3
xpos 289
ypos -503
}
push $N1d09a000
Multiply {
inputs 1+1
value 0
name Multiply1
label "\[value value]"
xpos 695
ypos -512
}
NoOp {
name Start
xpos 695
ypos -450
}
set N1d062c00 [stack 0]
Blur {
size {{(Blur1.size)*(mult)**3} {(Blur1.size)*(mult)**3}}
crop false
name Blur4
label "\[value size]"
xpos 995
ypos -370
}
push $N1d062c00
Blur {
size {{(Blur1.size)*(mult)**2} {(Blur1.size)*(mult)**2}}
crop false
name Blur3
label "\[value size]"
xpos 895
ypos -370
}
push 0
push $N1d062c00
Blur {
size {{(Blur1.size)*(mult)**1} {(Blur1.size)*(mult)**1}}
crop false
name Blur2
label "\[value size]"
xpos 795
ypos -370
}
push $N1d062c00
Blur {
size {{parent.size.w} {parent.size.h}}
name Blur1
label "\[value size]"
xpos 695
ypos -370
}
Merge2 {
inputs 5+1
operation {{mergeNumber.mergeNumber}}
also_merge all
name Merge1
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 695
ypos -273
}
NoOp {
name End
xpos 695
ypos -230
}
set N1d061400 [stack 0]
CopyBBox {
inputs 2
name CopyBBox1
xpos 585
ypos -175
}
Group {
name BBoxToFormat
onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
tile_color 0xa57aaaff
note_font "Verdana Bold"
note_font_color 0xffffffff
xpos 585
ypos -151
addUserKnob {20 CropBBox}
addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
addUserKnob {41 intersect T Crop6.intersect}
addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
overscanType {{parent.safetyBBoxMethod}}
addUserKnob {14 overscan l Overscan R 0 400}
overscan {{parent.safeBBoxPixels} {parent.safeBBoxPixels}}
addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
overscanPercent {{parent.safeBBoxPercent} {parent.safeBBoxPercent}}
addUserKnob {20 inputBbox l "BBox Data" n 1}
addUserKnob {15 inputFormat l "Input Format"}
inputFormat {0 0 {input.width} {input.height}}
addUserKnob {15 inputBBox l "Input BBox"}
inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
addUserKnob {15 outputBBox l "Output BBox"}
outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
addUserKnob {20 endGroup n -1}
addUserKnob {20 info_1 l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
addUserKnob {26 ver l Version: T v02}
}
Input {
inputs 0
name Input
xpos 261
ypos 394
}
Dot {
name Dot2
note_font_size 41
xpos 295
ypos 462
}
set N1d060800 [stack 0]
Dot {
name Dot1
note_font_size 41
xpos -160
ypos 462
}
set N1d060400 [stack 0]
push $N1d060800
Crop {
box {{parent.inputBBox} {parent.inputBBox} {parent.inputBBox} {parent.inputBBox}}
crop {{parent.blackOutside}}
name Crop6
xpos 261
ypos 510
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
set Nbbdb7c00 [stack 0]
Remove {
operation keep
channels none
name Remove1
xpos 120
ypos 504
}
set Nbbdb7800 [stack 0]
Transform {
scale {{parent.overscanPercent} {parent.overscanPercent}}
center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
shutteroffset centred
name Transform1
selected true
xpos 120
ypos 553
}
push $Nbbdb7800
AdjBBox {
numpixels {{parent.overscan} {parent.overscan}}
name AdjBBox1
xpos -5
ypos 510
}
Switch {
inputs 2
which {{overscanType}}
name Switch2
label "\[value which]"
xpos -5
ypos 549
}
Merge2 {
inputs 2
bbox intersection
Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
name Merge1
xpos -5
ypos 647
disable {{!parent.Crop6.intersect}}
}
push $N1d060400
CopyBBox {
inputs 2
name CopyBBox1
xpos -194
ypos 653
}
BlackOutside {
name BlackOutside1
xpos -194
ypos 692
disable {{!parent.blackOutside}}
}
Dot {
name Dot4
note_font_size 41
xpos -160
ypos 769
}
push $Nbbdb7c00
Switch {
inputs 2
which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
name Switch1
label "\[value which]"
xpos 261
ypos 759
}
set Nbbdb5800 [stack 0]
Output {
name Output1
xpos 261
ypos 921
}
push $Nbbdb5800
NoOp {
name OutputBBox1
xpos 378
ypos 821
addUserKnob {20 User}
addUserKnob {15 OutputBBox l "Output BBox"}
OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
}
end_group
push $N1d061400
Merge2 {
inputs 2
bbox intersection
also_merge all
name Merge4
xpos 585
ypos -127
}
push $N1d061400
CopyBBox {
inputs 2
name CopyBBox2
xpos 585
ypos -101
}
push $N1d061400
Switch {
inputs 2
which {{"parent.safeBBox && ((BBoxResult.bbox.x < BBoxInput.bbox.x || BBoxResult.bbox.y < BBoxInput.bbox.y || BBoxResult.bbox.r > BBoxInput.bbox.r || BBoxResult.bbox.t > BBoxInput.bbox.t))"}}
name Switch2
label "\[value which]"
xpos 695
ypos -106
}
Grade {
channels all
whitepoint 5
black_clamp false
name AverageMult
xpos 695
ypos -37
disable {{"output2 == 4 ? 0 : 1"}}
}
Merge2 {
inputs 2
operation max
also_merge all
name Merge2
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 695
ypos 10
disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
}
Clamp {
name Clamp1
selected true
xpos 695
ypos 50
disable {{!parent.clamp}}
}
Blur {
size {{postBlur} {postBlur}}
name BlurOriginal
label "\[value size]"
xpos 695
ypos 102
}
Invert {
name Invert2
xpos 695
ypos 144
disable {{"parent.size < 0 ? 0 : 1"}}
}
push $N1d09a400
Switch {
inputs 2
which {{"parent.size == 0 ? 0 : 1"}}
name Switch1
label "\[value which]"
xpos 427
ypos 190
}
Dot {
name Dot17
label A
note_font_size 41
xpos 34
ypos 455
}
Dot {
name Dot7
note_font_size 41
xpos 34
ypos 579
}
set Nbbd72000 [stack 0]
Dot {
name Dot12
note_font_size 41
xpos -260
ypos 579
}
Dot {
name Dot13
note_font_size 41
xpos -260
ypos 799
}
push $N1d09bc00
Input {
inputs 0
name Inputmask
xpos 512
ypos 322
number 1
}
Dot {
name Dot19
label Mask
note_font_size 41
xpos 546
ypos 435
}
set Nbbd71000 [stack 0]
Dot {
name Dot20
note_font_size 41
xpos 436
ypos 435
}
push $Nbbd72000
Merge2 {
inputs 2
bbox intersection
Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
output {rgba.red -rgba.green -rgba.blue rgba.alpha}
name MergeIntersection
xpos 402
ypos 572
disable {{"!\[exists parent.input1]"}}
}
Merge2 {
inputs 2
Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
output {rgba.red -rgba.green -rgba.blue rgba.alpha}
name MergeUnion
xpos 402
ypos 610
disable {{"!\[exists parent.input1]"}}
}
Dot {
name Dot6
label "intersection\nof (Mask and A) + B"
note_font_size 14
note_font_color 0xffffffff
xpos 436
ypos 770
}
push $Nbbd71000
Dot {
name Dot10
note_font_size 41
xpos 546
ypos 672
}
push $Nbbd72000
push $N1d09b800
Merge2 {
inputs 2+1
operation copy
Achannels none
Bchannels none
output none
also_merge {{{parent.Remove1.channels}}}
name MergeKeymix
xpos 0
ypos 665
}
Dot {
name Dot14
note_font_size 41
xpos 34
ypos 747
}
set Nbbd1b000 [stack 0]
push $N1d09b800
CopyBBox {
inputs 2
name CopyBBoxUnion
xpos -401
ypos 743
disable {{parent.bbox==0?0:1}}
}
CopyBBox {
inputs 2
name CopyBBoxIntersection
xpos -401
ypos 769
disable {{"parent.bbox==1 ? 0 : 1"}}
}
CopyBBox {
inputs 2
name CopyBBoxA
xpos -401
ypos 795
disable {{"parent.bbox==2 ? 0 : 1"}}
}
CopyBBox {
inputs 2
name CopyBBoxB
xpos -401
ypos 827
disable {{"parent.bbox==3 ? 0 : 1"}}
}
Crop {
box {0 0 {parent.width} {parent.height}}
crop false
name CopyBBoxFormat
xpos -401
ypos 853
disable {{"parent.bbox==4 ? 0 : 1"}}
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
set Nbbd19c00 [stack 0]
Transform {
scale {{parent.adjustBBoxPercent} {parent.adjustBBoxPercent}}
center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
black_outside false
shutteroffset centred
name TransformBBoxAdjustPercent
xpos -516
ypos 898
}
push $Nbbd19c00
AdjBBox {
numpixels {{parent.adjustBBoxPixels} {parent.adjustBBoxPixels}}
name AdjBBoxPixels
xpos -401
ypos 901
}
Switch {
inputs 2
which {{adjustBBoxExtra}}
name Switch3
xpos -401
ypos 940
}
Dot {
name Dot9
note_font_size 41
xpos -367
ypos 993
}
push $Nbbd1b000
CopyBBox {
inputs 2
name CopyBBox
xpos 0
ypos 989
}
BlackOutside {
name BlackOutside1
xpos 0
ypos 1015
disable {{!parent.blackOutside}}
}
Output {
name Output1
xpos 0
ypos 1155
}
NoOp {
inputs 0
name mergeNumber
xpos 229
ypos -862
addUserKnob {20 User}
addUserKnob {3 mergeNumber}
mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
}
push $N1d061400
NoOp {
name BBoxResult
xpos 585
ypos -230
addUserKnob {20 User}
addUserKnob {15 bbox}
bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
}
end_group
Unpremult {
name Unpremult10
selected true
xpos -31156
ypos 14307
}
Dot {
name Dot20
label "first level \nfor detail"
note_font "DejaVu LGC Sans"
note_font_size 20
selected true
xpos -31122
ypos 14361
}
Group {
name BinaryAlpha2
tile_color 0x2a2a2aff
label "(\[value an] --> \[value output1])"
note_font Verdana
note_font_color 0xfffff9ff
selected true
xpos -31156
ypos 14399
addUserKnob {20 BinaryAlpha}
addUserKnob {4 an l Analyze: M {rgb rgba alpha "" "" ""}}
addUserKnob {4 output1 l Output: M {rgba alpha "" "" "" ""}}
output1 alpha
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "Analyzes channel input and creates a binary result 0 or 1 and outputs it into output channel" T BinaryAlpha}
addUserKnob {26 ver l Version: T v03}
}
Input {
inputs 0
name Input
xpos -398
ypos 275
}
Expression {
temp_name0 rgb_an
temp_expr0 "r !=0 || g!=0 || b!=0?1:0"
temp_name1 rgba_an
temp_expr1 "r!=0 || g!=0 || b!=0 || a!=0?1:0"
temp_name2 alpha_an
temp_expr2 a!=0?1:0
expr3 "parent.an == 0 ? rgb_an : parent.an == 1 ? rgba_an : alpha_an"
name Expression
xpos -398
ypos 341
}
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle
label "\[value in]"
xpos -398
ypos 367
disable {{parent.output1}}
}
Output {
name Output1
xpos -398
ypos 456
}
end_group
EdgeBlur {
channels rgba
size 79
name EdgeBlur3
selected true
xpos -31156
ypos 14437
}
Group {
name ExponBlurSimple6
onCreate "n = nuke.thisNode()\nn.knob('size').setRange(-100, 100)\nn.knob('adjustBBoxPixels').setRange(0, 400)\nn.knob('adjustBBoxPercent').setRange(1, 2)\nn.knob('safeBBoxPixels').setRange(0, 400)\nn.knob('safeBBoxPercent').setRange(1, 2)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n        \n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n        \nelif k.name() == \"steps\":\n    \n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n        \n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n        \n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('mult').getValue()\n        \n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, b1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression(\"(Blur1.size)*(mult)**%s\"%(i))\n            b\[\"label\"].setValue(\"\[value size]\")\n            merge.setInput(i if i<2 else i+1, b)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n            \n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n            \nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n        \nelif k.name() == \"safeBBox\":\n    if n.knob(\"safeBBox\").getValue() == 0:\n        n.knob('safeBBoxText').setVisible(False)\n        n.knob('safetyBBoxMethod').setVisible(False)\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(False)\n        \n    elif n.knob(\"safeBBox\").getValue() == 1:\n        n.knob('safetyBBoxMethod').setVisible(True)\n        n.knob('safeBBoxText').setVisible(True)\n        if n.knob('safetyBBoxMethod').value() == \"pixels\":\n            n.knob('safeBBoxPixels').setVisible(True)\n            n.knob('safeBBoxPercent').setVisible(False)\n        elif n.knob('safetyBBoxMethod').value() == \"percent\":\n            n.knob('safeBBoxPixels').setVisible(False)\n            n.knob('safeBBoxPercent').setVisible(True)\n            \nelif k.name() == \"safetyBBoxMethod\":\n    if n.knob(\"safetyBBoxMethod\").value() == \"pixels\":\n        n.knob('safeBBoxPixels').setVisible(True)\n        n.knob('safeBBoxPercent').setVisible(False)\n    elif n.knob(\"safetyBBoxMethod\").value() == \"percent\":\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(True)\n        \nelif k.name() == \"adjustBBoxExtra\":\n    if n.knob(\"adjustBBoxExtra\").value() == \"pixels\":\n        n.knob('adjustBBoxPixels').setVisible(True)\n        n.knob('adjustBBoxPercent').setVisible(False)\n    elif n.knob(\"adjustBBoxExtra\").value() == \"percent\":\n        n.knob('adjustBBoxPixels').setVisible(False)\n        n.knob('adjustBBoxPercent').setVisible(True)\n"
tile_color 0xcc804eff
label "(\[value output2])"
note_font "Verdana Bold"
note_font_color 0xffffffff
selected true
xpos -31156
ypos 14491
addUserKnob {20 ExponBlurSimple}
addUserKnob {41 channels T Remove1.channels}
addUserKnob {41 maskChannelMask_1 l area T Multiply1.maskChannelMask}
addUserKnob {41 inject_1 l inject -STARTLINE T Multiply1.inject}
addUserKnob {41 invert_mask_1 l invert -STARTLINE T Multiply1.invert_mask}
addUserKnob {41 fringe_1 l fringe -STARTLINE T Multiply1.fringe}
addUserKnob {26 ""}
addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
output2 Over
addUserKnob {3 steps l "  Steps" -STARTLINE}
steps 4
addUserKnob {26 text l " " -STARTLINE T " "}
addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
includeOriginal true
addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
addUserKnob {14 size l Size R -100 100}
size 3.2
addUserKnob {7 mult l Multiplier R 1 5}
mult 3.4
addUserKnob {6 clamp +STARTLINE}
addUserKnob {14 postBlur l "Post Blur" R 0 100}
addUserKnob {26 ""}
addUserKnob {20 bboxControl l "BBox Control" n 1}
bboxControl 0
addUserKnob {26 text_2 l " " T " "}
addUserKnob {4 bbox l "BBox: " -STARTLINE M {union intersectionMask A B "input format" "" "" "" "" "" "" "" "" "" "" "" ""}}
addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
addUserKnob {6 safeBBox l "Safe BBox" t "If the output BBox is larger than the input format and the input box combined. the result will be max of the input/format bbox plus a safety \"buffer\" in pixels or percent \n\nTurning off might make your BBox grow exponentially with high blur values" -STARTLINE}
safeBBox true
addUserKnob {26 safeBBoxText l "" +STARTLINE T " "}
addUserKnob {4 safetyBBoxMethod l "Safe BBox Buffer  " -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""}}
safetyBBoxMethod percent
addUserKnob {14 safeBBoxPixels l "" -STARTLINE +HIDDEN R 0 400}
safeBBoxPixels 100
addUserKnob {14 safeBBoxPercent l "" -STARTLINE R 1 2}
safeBBoxPercent 1.1
addUserKnob {26 text_3 l "" +STARTLINE T " "}
addUserKnob {4 adjustBBoxExtra l "Extra BBox Adjust" -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" ""}}
addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
adjustBBoxPercent 1
addUserKnob {14 adjustBBoxPixels l "" -STARTLINE R 0 400}
addUserKnob {26 ""}
addUserKnob {20 endGroup n -1}
addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
addUserKnob {41 mix T MergeKeymix.mix}
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "Tony Lyons"}
addUserKnob {26 desc l Description: T ExponBlurSimple}
addUserKnob {26 ver l Version: T v03}
}
BackdropNode {
inputs 0
name BackdropNode1
tile_color 0x535e5a00
label "BBox Management"
note_font_size 30
note_font_color 0xffffffff
xpos -529
ypos 492
bdwidth 341
bdheight 525
}
Input {
inputs 0
name Inputimg
xpos 0
ypos -969
}
Dot {
name Dot16
note_font_size 41
xpos 34
ypos -802
}
set Nf0314c00 [stack 0]
Dot {
name Dot2
note_font_size 41
xpos -367
ypos -802
}
Dot {
name Dot18
label B
note_font_size 41
xpos -367
ypos 434
}
Dot {
name Dot11
note_font_size 41
xpos -367
ypos 623
}
set Nf02c7c00 [stack 0]
Dot {
name Dot3
note_font_size 41
xpos -367
ypos 675
}
set Nf02c7800 [stack 0]
Dot {
name Dot8
note_font_size 41
xpos -463
ypos 675
}
Dot {
name Dot15
note_font_size 41
xpos -463
ypos 831
}
push $Nf0314c00
Dot {
name Dot1
note_font_size 41
xpos 461
ypos -802
}
Remove {
operation keep
channels rgba
name Remove1
xpos 427
ypos -718
}
Dot {
name Dot21
note_font_size 41
xpos 461
ypos -597
}
set Nf02c6400 [stack 0]
Invert {
name Invert1
xpos 695
ypos -604
disable {{"parent.size < 0 ? 0 : 1"}}
}
set Nf02c6000 [stack 0]
Dot {
name Dot4
note_font_size 41
xpos 540
ypos -543
}
NoOp {
name Original
xpos 506
ypos -327
}
set Nf02c5800 [stack 0]
Dot {
name Dot5
note_font_size 41
xpos 540
ypos 14
}
Crop {
inputs 0
box {{"!\[exists parent.input0] ? 0 : input.format.x"} {"!\[exists parent.input0] ? 0 : input.format.y"} {"!\[exists parent.input0] ? 0 : input.format.r"} {"!\[exists parent.input0] ? 0 : input.format.t"}}
reformat true
crop false
name Crop1
xpos 210
ypos -750
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
AddChannels {
channels rgba
name AddChannels2
xpos 210
ypos -724
}
push $Nf0314c00
Merge2 {
inputs 2
name Merge3
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 83
ypos -671
}
NoOp {
name BBoxInput
xpos 83
ypos -628
addUserKnob {20 User}
addUserKnob {15 bbox}
bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
}
push $Nf02c5800
Input {
inputs 0
name Inputarea
xpos 289
ypos -638
number 2
}
AddChannels {
channels alpha
color 1
name AddChannels1
xpos 289
ypos -580
}
Invert {
channels rgba
name Invert3
xpos 289
ypos -503
}
push $Nf02c6000
Multiply {
inputs 1+1
value 0
name Multiply1
label "\[value value]"
xpos 695
ypos -512
}
NoOp {
name Start
xpos 695
ypos -450
}
set N9947ac00 [stack 0]
Blur {
size {{(Blur1.size)*(mult)**3} {(Blur1.size)*(mult)**3}}
crop false
name Blur4
label "\[value size]"
xpos 995
ypos -370
}
push $N9947ac00
Blur {
size {{(Blur1.size)*(mult)**2} {(Blur1.size)*(mult)**2}}
crop false
name Blur3
label "\[value size]"
xpos 895
ypos -370
}
push 0
push $N9947ac00
Blur {
size {{(Blur1.size)*(mult)**1} {(Blur1.size)*(mult)**1}}
crop false
name Blur2
label "\[value size]"
xpos 795
ypos -370
}
push $N9947ac00
Blur {
size {{parent.size.w} {parent.size.h}}
name Blur1
label "\[value size]"
xpos 695
ypos -370
}
Merge2 {
inputs 5+1
operation {{mergeNumber.mergeNumber}}
also_merge all
name Merge1
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 695
ypos -273
}
NoOp {
name End
xpos 695
ypos -230
}
set N99479400 [stack 0]
CopyBBox {
inputs 2
name CopyBBox1
xpos 585
ypos -175
}
Group {
name BBoxToFormat
onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
tile_color 0xa57aaaff
note_font "Verdana Bold"
note_font_color 0xffffffff
xpos 585
ypos -151
addUserKnob {20 CropBBox}
addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
addUserKnob {41 intersect T Crop6.intersect}
addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
overscanType {{parent.safetyBBoxMethod}}
addUserKnob {14 overscan l Overscan R 0 400}
overscan {{parent.safeBBoxPixels} {parent.safeBBoxPixels}}
addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
overscanPercent {{parent.safeBBoxPercent} {parent.safeBBoxPercent}}
addUserKnob {20 inputBbox l "BBox Data" n 1}
addUserKnob {15 inputFormat l "Input Format"}
inputFormat {0 0 {input.width} {input.height}}
addUserKnob {15 inputBBox l "Input BBox"}
inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
addUserKnob {15 outputBBox l "Output BBox"}
outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
addUserKnob {20 endGroup n -1}
addUserKnob {20 info_1 l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
addUserKnob {26 ver l Version: T v02}
}
Input {
inputs 0
name Input
xpos 261
ypos 394
}
Dot {
name Dot2
note_font_size 41
xpos 295
ypos 462
}
set N99478800 [stack 0]
Dot {
name Dot1
note_font_size 41
xpos -160
ypos 462
}
set N99478400 [stack 0]
push $N99478800
Crop {
box {{parent.inputBBox} {parent.inputBBox} {parent.inputBBox} {parent.inputBBox}}
crop {{parent.blackOutside}}
name Crop6
xpos 261
ypos 510
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
set N99423c00 [stack 0]
Remove {
operation keep
channels none
name Remove1
xpos 120
ypos 504
}
set N99423800 [stack 0]
Transform {
scale {{parent.overscanPercent} {parent.overscanPercent}}
center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
shutteroffset centred
name Transform1
selected true
xpos 120
ypos 553
}
push $N99423800
AdjBBox {
numpixels {{parent.overscan} {parent.overscan}}
name AdjBBox1
xpos -5
ypos 510
}
Switch {
inputs 2
which {{overscanType}}
name Switch2
label "\[value which]"
xpos -5
ypos 549
}
Merge2 {
inputs 2
bbox intersection
Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
name Merge1
xpos -5
ypos 647
disable {{!parent.Crop6.intersect}}
}
push $N99478400
CopyBBox {
inputs 2
name CopyBBox1
xpos -194
ypos 653
}
BlackOutside {
name BlackOutside1
xpos -194
ypos 692
disable {{!parent.blackOutside}}
}
Dot {
name Dot4
note_font_size 41
xpos -160
ypos 769
}
push $N99423c00
Switch {
inputs 2
which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
name Switch1
label "\[value which]"
xpos 261
ypos 759
}
set N99421800 [stack 0]
Output {
name Output1
xpos 261
ypos 921
}
push $N99421800
NoOp {
name OutputBBox1
xpos 378
ypos 821
addUserKnob {20 User}
addUserKnob {15 OutputBBox l "Output BBox"}
OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
}
end_group
push $N99479400
Merge2 {
inputs 2
bbox intersection
also_merge all
name Merge4
xpos 585
ypos -127
}
push $N99479400
CopyBBox {
inputs 2
name CopyBBox2
xpos 585
ypos -101
}
push $N99479400
Switch {
inputs 2
which {{"parent.safeBBox && ((BBoxResult.bbox.x < BBoxInput.bbox.x || BBoxResult.bbox.y < BBoxInput.bbox.y || BBoxResult.bbox.r > BBoxInput.bbox.r || BBoxResult.bbox.t > BBoxInput.bbox.t))"}}
name Switch2
label "\[value which]"
xpos 695
ypos -106
}
Grade {
channels all
whitepoint 5
black_clamp false
name AverageMult
xpos 695
ypos -37
disable {{"output2 == 4 ? 0 : 1"}}
}
Merge2 {
inputs 2
operation max
also_merge all
name Merge2
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 695
ypos 10
disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
}
Clamp {
name Clamp1
selected true
xpos 695
ypos 50
disable {{!parent.clamp}}
}
Blur {
size {{postBlur} {postBlur}}
name BlurOriginal
label "\[value size]"
xpos 695
ypos 102
}
Invert {
name Invert2
xpos 695
ypos 144
disable {{"parent.size < 0 ? 0 : 1"}}
}
push $Nf02c6400
Switch {
inputs 2
which {{"parent.size == 0 ? 0 : 1"}}
name Switch1
label "\[value which]"
xpos 427
ypos 190
}
Dot {
name Dot17
label A
note_font_size 41
xpos 34
ypos 455
}
Dot {
name Dot7
note_font_size 41
xpos 34
ypos 579
}
set Na917e000 [stack 0]
Dot {
name Dot12
note_font_size 41
xpos -260
ypos 579
}
Dot {
name Dot13
note_font_size 41
xpos -260
ypos 799
}
push $Nf02c7c00
Input {
inputs 0
name Inputmask
xpos 512
ypos 322
number 1
}
Dot {
name Dot19
label Mask
note_font_size 41
xpos 546
ypos 435
}
set Na917d000 [stack 0]
Dot {
name Dot20
note_font_size 41
xpos 436
ypos 435
}
push $Na917e000
Merge2 {
inputs 2
bbox intersection
Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
output {rgba.red -rgba.green -rgba.blue rgba.alpha}
name MergeIntersection
xpos 402
ypos 572
disable {{"!\[exists parent.input1]"}}
}
Merge2 {
inputs 2
Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
output {rgba.red -rgba.green -rgba.blue rgba.alpha}
name MergeUnion
xpos 402
ypos 610
disable {{"!\[exists parent.input1]"}}
}
Dot {
name Dot6
label "intersection\nof (Mask and A) + B"
note_font_size 14
note_font_color 0xffffffff
xpos 436
ypos 770
}
push $Na917d000
Dot {
name Dot10
note_font_size 41
xpos 546
ypos 672
}
push $Na917e000
push $Nf02c7800
Merge2 {
inputs 2+1
operation copy
Achannels none
Bchannels none
output none
also_merge {{{parent.Remove1.channels}}}
name MergeKeymix
xpos 0
ypos 665
}
Dot {
name Dot14
note_font_size 41
xpos 34
ypos 747
}
set Na9127000 [stack 0]
push $Nf02c7800
CopyBBox {
inputs 2
name CopyBBoxUnion
xpos -401
ypos 743
disable {{parent.bbox==0?0:1}}
}
CopyBBox {
inputs 2
name CopyBBoxIntersection
xpos -401
ypos 769
disable {{"parent.bbox==1 ? 0 : 1"}}
}
CopyBBox {
inputs 2
name CopyBBoxA
xpos -401
ypos 795
disable {{"parent.bbox==2 ? 0 : 1"}}
}
CopyBBox {
inputs 2
name CopyBBoxB
xpos -401
ypos 827
disable {{"parent.bbox==3 ? 0 : 1"}}
}
Crop {
box {0 0 {parent.width} {parent.height}}
crop false
name CopyBBoxFormat
xpos -401
ypos 853
disable {{"parent.bbox==4 ? 0 : 1"}}
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
set Na9125c00 [stack 0]
Transform {
scale {{parent.adjustBBoxPercent} {parent.adjustBBoxPercent}}
center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
black_outside false
shutteroffset centred
name TransformBBoxAdjustPercent
xpos -516
ypos 898
}
push $Na9125c00
AdjBBox {
numpixels {{parent.adjustBBoxPixels} {parent.adjustBBoxPixels}}
name AdjBBoxPixels
xpos -401
ypos 901
}
Switch {
inputs 2
which {{adjustBBoxExtra}}
name Switch3
xpos -401
ypos 940
}
Dot {
name Dot9
note_font_size 41
xpos -367
ypos 993
}
push $Na9127000
CopyBBox {
inputs 2
name CopyBBox
xpos 0
ypos 989
}
BlackOutside {
name BlackOutside1
xpos 0
ypos 1015
disable {{!parent.blackOutside}}
}
Output {
name Output1
xpos 0
ypos 1155
}
NoOp {
inputs 0
name mergeNumber
xpos 229
ypos -862
addUserKnob {20 User}
addUserKnob {3 mergeNumber}
mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
}
push $N99479400
NoOp {
name BBoxResult
xpos 585
ypos -230
addUserKnob {20 User}
addUserKnob {15 bbox}
bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
}
end_group
Unpremult {
name Unpremult11
selected true
xpos -31156
ypos 14529
}
Dot {
name Dot21
label "mid level,\nfill in / blend"
note_font "DejaVu LGC Sans"
note_font_size 20
selected true
xpos -31122
ypos 14576
}
Group {
name BinaryAlpha3
tile_color 0x2a2a2aff
label "(\[value an] --> \[value output1])"
note_font Verdana
note_font_color 0xfffff9ff
selected true
xpos -31156
ypos 14625
addUserKnob {20 BinaryAlpha}
addUserKnob {4 an l Analyze: M {rgb rgba alpha "" "" ""}}
addUserKnob {4 output1 l Output: M {rgba alpha "" "" "" ""}}
output1 alpha
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "Analyzes channel input and creates a binary result 0 or 1 and outputs it into output channel" T BinaryAlpha}
addUserKnob {26 ver l Version: T v03}
}
Input {
inputs 0
name Input
xpos -398
ypos 275
}
Expression {
temp_name0 rgb_an
temp_expr0 "r !=0 || g!=0 || b!=0?1:0"
temp_name1 rgba_an
temp_expr1 "r!=0 || g!=0 || b!=0 || a!=0?1:0"
temp_name2 alpha_an
temp_expr2 a!=0?1:0
expr3 "parent.an == 0 ? rgb_an : parent.an == 1 ? rgba_an : alpha_an"
name Expression
xpos -398
ypos 341
}
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle
label "\[value in]"
xpos -398
ypos 367
disable {{parent.output1}}
}
Output {
name Output1
xpos -398
ypos 456
}
end_group
EdgeBlur {
channels rgba
size 62
name EdgeBlur4
selected true
xpos -31156
ypos 14663
}
Group {
name ExponBlurSimple7
onCreate "n = nuke.thisNode()\nn.knob('size').setRange(-100, 100)\nn.knob('adjustBBoxPixels').setRange(0, 400)\nn.knob('adjustBBoxPercent').setRange(1, 2)\nn.knob('safeBBoxPixels').setRange(0, 400)\nn.knob('safeBBoxPercent').setRange(1, 2)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n        \n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n        \nelif k.name() == \"steps\":\n    \n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n        \n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n        \n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('mult').getValue()\n        \n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, b1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression(\"(Blur1.size)*(mult)**%s\"%(i))\n            b\[\"label\"].setValue(\"\[value size]\")\n            merge.setInput(i if i<2 else i+1, b)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n            \n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n            \nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n        \nelif k.name() == \"safeBBox\":\n    if n.knob(\"safeBBox\").getValue() == 0:\n        n.knob('safeBBoxText').setVisible(False)\n        n.knob('safetyBBoxMethod').setVisible(False)\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(False)\n        \n    elif n.knob(\"safeBBox\").getValue() == 1:\n        n.knob('safetyBBoxMethod').setVisible(True)\n        n.knob('safeBBoxText').setVisible(True)\n        if n.knob('safetyBBoxMethod').value() == \"pixels\":\n            n.knob('safeBBoxPixels').setVisible(True)\n            n.knob('safeBBoxPercent').setVisible(False)\n        elif n.knob('safetyBBoxMethod').value() == \"percent\":\n            n.knob('safeBBoxPixels').setVisible(False)\n            n.knob('safeBBoxPercent').setVisible(True)\n            \nelif k.name() == \"safetyBBoxMethod\":\n    if n.knob(\"safetyBBoxMethod\").value() == \"pixels\":\n        n.knob('safeBBoxPixels').setVisible(True)\n        n.knob('safeBBoxPercent').setVisible(False)\n    elif n.knob(\"safetyBBoxMethod\").value() == \"percent\":\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(True)\n        \nelif k.name() == \"adjustBBoxExtra\":\n    if n.knob(\"adjustBBoxExtra\").value() == \"pixels\":\n        n.knob('adjustBBoxPixels').setVisible(True)\n        n.knob('adjustBBoxPercent').setVisible(False)\n    elif n.knob(\"adjustBBoxExtra\").value() == \"percent\":\n        n.knob('adjustBBoxPixels').setVisible(False)\n        n.knob('adjustBBoxPercent').setVisible(True)\n"
tile_color 0xcc804eff
label "(\[value output2])"
note_font "Verdana Bold"
note_font_color 0xffffffff
selected true
xpos -31156
ypos 14717
addUserKnob {20 ExponBlurSimple}
addUserKnob {41 channels T Remove1.channels}
addUserKnob {41 maskChannelMask_1 l area T Multiply1.maskChannelMask}
addUserKnob {41 inject_1 l inject -STARTLINE T Multiply1.inject}
addUserKnob {41 invert_mask_1 l invert -STARTLINE T Multiply1.invert_mask}
addUserKnob {41 fringe_1 l fringe -STARTLINE T Multiply1.fringe}
addUserKnob {26 ""}
addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
output2 Over
addUserKnob {3 steps l "  Steps" -STARTLINE}
steps 4
addUserKnob {26 text l " " -STARTLINE T " "}
addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
includeOriginal true
addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
addUserKnob {14 size l Size R -100 100}
size 4
addUserKnob {7 mult l Multiplier R 1 5}
mult 4
addUserKnob {6 clamp +STARTLINE}
addUserKnob {14 postBlur l "Post Blur" R 0 100}
addUserKnob {26 ""}
addUserKnob {20 bboxControl l "BBox Control" n 1}
bboxControl 0
addUserKnob {26 text_2 l " " T " "}
addUserKnob {4 bbox l "BBox: " -STARTLINE M {union intersectionMask A B "input format" "" "" "" "" "" "" "" "" "" "" "" ""}}
addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
addUserKnob {6 safeBBox l "Safe BBox" t "If the output BBox is larger than the input format and the input box combined. the result will be max of the input/format bbox plus a safety \"buffer\" in pixels or percent \n\nTurning off might make your BBox grow exponentially with high blur values" -STARTLINE}
safeBBox true
addUserKnob {26 safeBBoxText l "" +STARTLINE T " "}
addUserKnob {4 safetyBBoxMethod l "Safe BBox Buffer  " -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""}}
safetyBBoxMethod percent
addUserKnob {14 safeBBoxPixels l "" -STARTLINE +HIDDEN R 0 400}
safeBBoxPixels 100
addUserKnob {14 safeBBoxPercent l "" -STARTLINE R 1 2}
safeBBoxPercent 1.1
addUserKnob {26 text_3 l "" +STARTLINE T " "}
addUserKnob {4 adjustBBoxExtra l "Extra BBox Adjust" -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" ""}}
addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
adjustBBoxPercent 1
addUserKnob {14 adjustBBoxPixels l "" -STARTLINE R 0 400}
addUserKnob {26 ""}
addUserKnob {20 endGroup n -1}
addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
addUserKnob {41 mix T MergeKeymix.mix}
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "Tony Lyons"}
addUserKnob {26 desc l Description: T ExponBlurSimple}
addUserKnob {26 ver l Version: T v03}
}
BackdropNode {
inputs 0
name BackdropNode1
tile_color 0x535e5a00
label "BBox Management"
note_font_size 30
note_font_color 0xffffffff
xpos -529
ypos 492
bdwidth 341
bdheight 525
}
Input {
inputs 0
name Inputimg
xpos 0
ypos -969
}
Dot {
name Dot16
note_font_size 41
xpos 34
ypos -802
}
set Nef690c00 [stack 0]
Dot {
name Dot2
note_font_size 41
xpos -367
ypos -802
}
Dot {
name Dot18
label B
note_font_size 41
xpos -367
ypos 434
}
Dot {
name Dot11
note_font_size 41
xpos -367
ypos 623
}
set Nef637c00 [stack 0]
Dot {
name Dot3
note_font_size 41
xpos -367
ypos 675
}
set Nef637800 [stack 0]
Dot {
name Dot8
note_font_size 41
xpos -463
ypos 675
}
Dot {
name Dot15
note_font_size 41
xpos -463
ypos 831
}
push $Nef690c00
Dot {
name Dot1
note_font_size 41
xpos 461
ypos -802
}
Remove {
operation keep
channels rgba
name Remove1
xpos 427
ypos -718
}
Dot {
name Dot21
note_font_size 41
xpos 461
ypos -597
}
set Nef636400 [stack 0]
Invert {
name Invert1
xpos 695
ypos -604
disable {{"parent.size < 0 ? 0 : 1"}}
}
set Nef636000 [stack 0]
Dot {
name Dot4
note_font_size 41
xpos 540
ypos -543
}
NoOp {
name Original
xpos 506
ypos -327
}
set Nef635800 [stack 0]
Dot {
name Dot5
note_font_size 41
xpos 540
ypos 14
}
Crop {
inputs 0
box {{"!\[exists parent.input0] ? 0 : input.format.x"} {"!\[exists parent.input0] ? 0 : input.format.y"} {"!\[exists parent.input0] ? 0 : input.format.r"} {"!\[exists parent.input0] ? 0 : input.format.t"}}
reformat true
crop false
name Crop1
xpos 210
ypos -750
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
AddChannels {
channels rgba
name AddChannels2
xpos 210
ypos -724
}
push $Nef690c00
Merge2 {
inputs 2
name Merge3
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 83
ypos -671
}
NoOp {
name BBoxInput
xpos 83
ypos -628
addUserKnob {20 User}
addUserKnob {15 bbox}
bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
}
push $Nef635800
Input {
inputs 0
name Inputarea
xpos 289
ypos -638
number 2
}
AddChannels {
channels alpha
color 1
name AddChannels1
xpos 289
ypos -580
}
Invert {
channels rgba
name Invert3
xpos 289
ypos -503
}
push $Nef636000
Multiply {
inputs 1+1
value 0
name Multiply1
label "\[value value]"
xpos 695
ypos -512
}
NoOp {
name Start
xpos 695
ypos -450
}
set Nff57ac00 [stack 0]
Blur {
size {{(Blur1.size)*(mult)**3} {(Blur1.size)*(mult)**3}}
crop false
name Blur4
label "\[value size]"
xpos 995
ypos -370
}
push $Nff57ac00
Blur {
size {{(Blur1.size)*(mult)**2} {(Blur1.size)*(mult)**2}}
crop false
name Blur3
label "\[value size]"
xpos 895
ypos -370
}
push 0
push $Nff57ac00
Blur {
size {{(Blur1.size)*(mult)**1} {(Blur1.size)*(mult)**1}}
crop false
name Blur2
label "\[value size]"
xpos 795
ypos -370
}
push $Nff57ac00
Blur {
size {{parent.size.w} {parent.size.h}}
name Blur1
label "\[value size]"
xpos 695
ypos -370
}
Merge2 {
inputs 5+1
operation {{mergeNumber.mergeNumber}}
also_merge all
name Merge1
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 695
ypos -273
}
NoOp {
name End
xpos 695
ypos -230
}
set Nff579400 [stack 0]
CopyBBox {
inputs 2
name CopyBBox1
xpos 585
ypos -175
}
Group {
name BBoxToFormat
onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
tile_color 0xa57aaaff
note_font "Verdana Bold"
note_font_color 0xffffffff
xpos 585
ypos -151
addUserKnob {20 CropBBox}
addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
addUserKnob {41 intersect T Crop6.intersect}
addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
overscanType {{parent.safetyBBoxMethod}}
addUserKnob {14 overscan l Overscan R 0 400}
overscan {{parent.safeBBoxPixels} {parent.safeBBoxPixels}}
addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
overscanPercent {{parent.safeBBoxPercent} {parent.safeBBoxPercent}}
addUserKnob {20 inputBbox l "BBox Data" n 1}
addUserKnob {15 inputFormat l "Input Format"}
inputFormat {0 0 {input.width} {input.height}}
addUserKnob {15 inputBBox l "Input BBox"}
inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
addUserKnob {15 outputBBox l "Output BBox"}
outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
addUserKnob {20 endGroup n -1}
addUserKnob {20 info_1 l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
addUserKnob {26 ver l Version: T v02}
}
Input {
inputs 0
name Input
xpos 261
ypos 394
}
Dot {
name Dot2
note_font_size 41
xpos 295
ypos 462
}
set Nff578800 [stack 0]
Dot {
name Dot1
note_font_size 41
xpos -160
ypos 462
}
set Nff578400 [stack 0]
push $Nff578800
Crop {
box {{parent.inputBBox} {parent.inputBBox} {parent.inputBBox} {parent.inputBBox}}
crop {{parent.blackOutside}}
name Crop6
xpos 261
ypos 510
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
set Nff51fc00 [stack 0]
Remove {
operation keep
channels none
name Remove1
xpos 120
ypos 504
}
set Nff51f800 [stack 0]
Transform {
scale {{parent.overscanPercent} {parent.overscanPercent}}
center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
shutteroffset centred
name Transform1
selected true
xpos 120
ypos 553
}
push $Nff51f800
AdjBBox {
numpixels {{parent.overscan} {parent.overscan}}
name AdjBBox1
xpos -5
ypos 510
}
Switch {
inputs 2
which {{overscanType}}
name Switch2
label "\[value which]"
xpos -5
ypos 549
}
Merge2 {
inputs 2
bbox intersection
Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
name Merge1
xpos -5
ypos 647
disable {{!parent.Crop6.intersect}}
}
push $Nff578400
CopyBBox {
inputs 2
name CopyBBox1
xpos -194
ypos 653
}
BlackOutside {
name BlackOutside1
xpos -194
ypos 692
disable {{!parent.blackOutside}}
}
Dot {
name Dot4
note_font_size 41
xpos -160
ypos 769
}
push $Nff51fc00
Switch {
inputs 2
which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
name Switch1
label "\[value which]"
xpos 261
ypos 759
}
set Nff51d800 [stack 0]
Output {
name Output1
xpos 261
ypos 921
}
push $Nff51d800
NoOp {
name OutputBBox1
xpos 378
ypos 821
addUserKnob {20 User}
addUserKnob {15 OutputBBox l "Output BBox"}
OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
}
end_group
push $Nff579400
Merge2 {
inputs 2
bbox intersection
also_merge all
name Merge4
xpos 585
ypos -127
}
push $Nff579400
CopyBBox {
inputs 2
name CopyBBox2
xpos 585
ypos -101
}
push $Nff579400
Switch {
inputs 2
which {{"parent.safeBBox && ((BBoxResult.bbox.x < BBoxInput.bbox.x || BBoxResult.bbox.y < BBoxInput.bbox.y || BBoxResult.bbox.r > BBoxInput.bbox.r || BBoxResult.bbox.t > BBoxInput.bbox.t))"}}
name Switch2
label "\[value which]"
xpos 695
ypos -106
}
Grade {
channels all
whitepoint 5
black_clamp false
name AverageMult
xpos 695
ypos -37
disable {{"output2 == 4 ? 0 : 1"}}
}
Merge2 {
inputs 2
operation max
also_merge all
name Merge2
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 695
ypos 10
disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
}
Clamp {
name Clamp1
selected true
xpos 695
ypos 50
disable {{!parent.clamp}}
}
Blur {
size {{postBlur} {postBlur}}
name BlurOriginal
label "\[value size]"
xpos 695
ypos 102
}
Invert {
name Invert2
xpos 695
ypos 144
disable {{"parent.size < 0 ? 0 : 1"}}
}
push $Nef636400
Switch {
inputs 2
which {{"parent.size == 0 ? 0 : 1"}}
name Switch1
label "\[value which]"
xpos 427
ypos 190
}
Dot {
name Dot17
label A
note_font_size 41
xpos 34
ypos 455
}
Dot {
name Dot7
note_font_size 41
xpos 34
ypos 579
}
set N90686000 [stack 0]
Dot {
name Dot12
note_font_size 41
xpos -260
ypos 579
}
Dot {
name Dot13
note_font_size 41
xpos -260
ypos 799
}
push $Nef637c00
Input {
inputs 0
name Inputmask
xpos 512
ypos 322
number 1
}
Dot {
name Dot19
label Mask
note_font_size 41
xpos 546
ypos 435
}
set N90685000 [stack 0]
Dot {
name Dot20
note_font_size 41
xpos 436
ypos 435
}
push $N90686000
Merge2 {
inputs 2
bbox intersection
Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
output {rgba.red -rgba.green -rgba.blue rgba.alpha}
name MergeIntersection
xpos 402
ypos 572
disable {{"!\[exists parent.input1]"}}
}
Merge2 {
inputs 2
Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
output {rgba.red -rgba.green -rgba.blue rgba.alpha}
name MergeUnion
xpos 402
ypos 610
disable {{"!\[exists parent.input1]"}}
}
Dot {
name Dot6
label "intersection\nof (Mask and A) + B"
note_font_size 14
note_font_color 0xffffffff
xpos 436
ypos 770
}
push $N90685000
Dot {
name Dot10
note_font_size 41
xpos 546
ypos 672
}
push $N90686000
push $Nef637800
Merge2 {
inputs 2+1
operation copy
Achannels none
Bchannels none
output none
also_merge {{{parent.Remove1.channels}}}
name MergeKeymix
xpos 0
ypos 665
}
Dot {
name Dot14
note_font_size 41
xpos 34
ypos 747
}
set N9062b000 [stack 0]
push $Nef637800
CopyBBox {
inputs 2
name CopyBBoxUnion
xpos -401
ypos 743
disable {{parent.bbox==0?0:1}}
}
CopyBBox {
inputs 2
name CopyBBoxIntersection
xpos -401
ypos 769
disable {{"parent.bbox==1 ? 0 : 1"}}
}
CopyBBox {
inputs 2
name CopyBBoxA
xpos -401
ypos 795
disable {{"parent.bbox==2 ? 0 : 1"}}
}
CopyBBox {
inputs 2
name CopyBBoxB
xpos -401
ypos 827
disable {{"parent.bbox==3 ? 0 : 1"}}
}
Crop {
box {0 0 {parent.width} {parent.height}}
crop false
name CopyBBoxFormat
xpos -401
ypos 853
disable {{"parent.bbox==4 ? 0 : 1"}}
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
set N90629c00 [stack 0]
Transform {
scale {{parent.adjustBBoxPercent} {parent.adjustBBoxPercent}}
center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
black_outside false
shutteroffset centred
name TransformBBoxAdjustPercent
xpos -516
ypos 898
}
push $N90629c00
AdjBBox {
numpixels {{parent.adjustBBoxPixels} {parent.adjustBBoxPixels}}
name AdjBBoxPixels
xpos -401
ypos 901
}
Switch {
inputs 2
which {{adjustBBoxExtra}}
name Switch3
xpos -401
ypos 940
}
Dot {
name Dot9
note_font_size 41
xpos -367
ypos 993
}
push $N9062b000
CopyBBox {
inputs 2
name CopyBBox
xpos 0
ypos 989
}
BlackOutside {
name BlackOutside1
xpos 0
ypos 1015
disable {{!parent.blackOutside}}
}
Output {
name Output1
xpos 0
ypos 1155
}
NoOp {
inputs 0
name mergeNumber
xpos 229
ypos -862
addUserKnob {20 User}
addUserKnob {3 mergeNumber}
mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
}
push $Nff579400
NoOp {
name BBoxResult
xpos 585
ypos -230
addUserKnob {20 User}
addUserKnob {15 bbox}
bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
}
end_group
Unpremult {
name Unpremult12
selected true
xpos -31156
ypos 14773
}
Dot {
name Dot124
label "final level,\nfill rest of \nscreen"
note_font_size 20
selected true
xpos -31122
ypos 14827
}
Dot {
name Dot22
note_font_size 41
selected true
xpos -31122
ypos 14917
}
set N9d096800 [stack 0]
Dot {
name Dot23
note_font_size 41
selected true
xpos -29874
ypos 14917
}
Dot {
name Dot127
label Cleanplate
note_font_size 60
selected true
xpos -29874
ypos 15280
}
Dot {
name Dot128
label Cleanplate
note_font_size 60
selected true
xpos -29874
ypos 15997
}
Dot {
name Dot24
label Cleanplate
note_font_size 60
selected true
xpos -29874
ypos 17394
}
add_layer {cleanplate cleanplate.red cleanplate.green cleanplate.blue cleanplate.alpha}
Shuffle {
black red
white green
red2 blue
green2 black
out2 cleanplate
name Shuffle3
label "\[value in] → \[value out2]"
selected true
xpos -34298
ypos 17384
}
push $N79b73800
Remove {
operation keep
channels rgb
name Remove15
selected true
xpos -32662
ypos 13841
}
Dot {
name Dot26
note_font_size 41
selected true
xpos -32628
ypos 14142
}
Primatte3 {
data { 5
    11757 12586 28017
    65552
    0 5
    30234 30234 30234 0
    131.703 115.29 2282.26 72.2175 59.1462 2129.06 939.83 259.302 51.8183 549.229 904.755 276.263 92.3108 578.039 120.609 234.956 234.82 146.119 237.546 743.532 100.669 573.049 43.009 63.2739 116.749 6215.42 168.03 1762.74 3864.11 55.7825 120.53 782.613 3846.16 137.667 121.352 101.794 8606.14 147.362 77.5146 198.503 573.917 81.358 1101.7 522.226 871.183 109.573 110.87 144.688 126.765 33.3146 34.0749 5144.71 4299.28 18477.9 96.8055 90.0376 231.86 11773.6 405.26 440.61 169.247 274.68 242.589 111.212 102.975 105.83
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 16795 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 23001.1 130560 130560 130560 130560 130560 130560 130560 130560
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 16795 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 23001.1 130560 130560 130560 130560 130560 130560 130560 130560
    -173008 -2.22551e+14 -2.22551e+14 -1.75797e+08 3.24562e+13 3.24562e+13
    -88728 -2.22551e+14 -2.22551e+14 -3.33563e+07 2.59518e+13 2.59518e+13
    -49917.5 -1.9095e+14 -1.9095e+14 2.99695e+07 1.24769e+13 1.24769e+13
    -275696 -1.62776e+14 -1.62776e+14 5.27411e+07 -2.14449e+12 -2.14449e+12
    -95526 -2.22551e+14 -2.22551e+14 1.29744e+07 1.69562e+13 1.69562e+13
    -48985 -2.22551e+14 -2.22551e+14 3.80106e+07 1.04518e+13 1.04518e+13
    -57891.4 -2.22551e+14 -2.22551e+14 2.42861e+07 -2.59518e+13 -2.59518e+13
    -319741 -1.89714e+14 -1.89714e+14 3.3319e+06 -3.70182e+13 -3.70182e+13
    -1.46426e+06 -4.06321e+14 -4.06321e+14 -6.42384e+08 6.71983e+13 6.71983e+13
    -8.55972e+07 -7.25395e+12 -7.25395e+12 -4.66618e+09 1.27042e+13 1.27042e+13
    -3.9253e+06 -1.98547e+12 -1.98547e+12 2.63799e+08 1.83081e+12 1.83081e+12
    -1.11147e+08 -4.01415e+12 -4.01415e+12 -2.18771e+09 8.80462e+12 8.80462e+12
    -3.71416e+06 -4.06321e+14 -4.06321e+14 8.76061e+08 -4.9151e+13 -4.9151e+13
    -282796 -4.06321e+14 -4.06321e+14 -4.12997e+07 -2.48811e+13 -2.48811e+13
    -20396 -4.06321e+14 -4.06321e+14 -2.03765e+07 -3.23759e+12 -3.23759e+12
    -1.15164e+10 -4.06321e+14 -4.06321e+14 1.17853e+09 -1.03268e+14 -1.03268e+14
    -4.34651e+09 -5.76078e+12 -5.76078e+12 -1.28057e+10 9.10482e+12 9.10482e+12
    -258688 -2.42948e+14 -2.42948e+14 3.95126e+07 8.78112e+13 8.78112e+13
    -65592 -4.06321e+14 -4.06321e+14 -3.43375e+07 2.48811e+13 2.48811e+13
    -2.98885e+07 -8.74202e+11 -8.74202e+11 -8.66012e+08 3.03045e+11 3.03045e+11
    -562448 -4.06321e+14 -4.06321e+14 1.75345e+08 3.90796e+13 3.90796e+13
    -1.70271e+06 -4.06321e+14 -4.06321e+14 6.26216e+07 -6.09506e+13 -6.09506e+13
    -7.9007e+07 -4.06321e+14 -4.06321e+14 1.52156e+10 -9.14682e+13 -9.14682e+13
    -6.56372e+08 -1.55159e+13 -1.55159e+13 3.2503e+10 -6.35202e+12 -6.35202e+12
    -3.37791e+08 -9.2413e+13 -9.2413e+13 -6.93039e+08 1.39767e+14 1.39767e+14
    -4.78643e+06 -1.42796e+13 -1.42796e+13 -4.03005e+08 1.74249e+13 1.74249e+13
    -1.03233e+06 -1.12003e+14 -1.12003e+14 -9.588e+07 3.48023e+13 3.48023e+13
    -2.04677e+08 -1.16868e+12 -1.16868e+12 -2.39029e+08 -1.34758e+11 -1.34758e+11
    -893296 -5.24559e+14 -5.24559e+14 -1.53781e+08 -2.95997e+13 -2.95997e+13
    -1.60356e+06 -5.24559e+14 -5.24559e+14 3.18342e+08 -9.64026e+13 -9.64026e+13
    -93988 -5.24559e+14 -5.24559e+14 5.9775e+07 -6.27891e+13 -6.27891e+13
    -1.29519e+10 -2.34124e+14 -2.34124e+14 -4.53767e+10 -4.78306e+13 -4.78306e+13
    -3.44886e+06 -4.06321e+14 -4.06321e+14 -2.18227e+08 6.80597e+13 6.80597e+13
    -569166 -2.54198e+14 -2.54198e+14 -6.19316e+07 1.15759e+14 1.15759e+14
    -528400 -5.65689e+13 -5.65689e+13 -1.74988e+08 1.30936e+14 1.30936e+14
    -2.1286e+07 -8.34717e+12 -8.34717e+12 -2.10171e+09 1.4745e+13 1.4745e+13
    -596176 -4.06321e+14 -4.06321e+14 8.40006e+07 -6.96482e+12 -6.96482e+12
    -230817 -4.06321e+14 -4.06321e+14 7.04665e+06 4.11041e+11 4.11041e+11
    -13557 -4.06321e+14 -4.06321e+14 -1.20581e+07 -2.85297e+13 -2.85297e+13
    -5.03316e+07 -2.73268e+14 -2.73268e+14 1.43263e+10 -8.80179e+13 -8.80179e+13
    -31228 -2.22551e+14 -2.22551e+14 1.80443e+07 3.12724e+13 3.12724e+13
    -3.22987e+09 -3.32092e+11 -3.32092e+11 -1.44559e+10 3.46322e+11 3.46322e+11
    -4.71444e+08 -7.14508e+11 -7.14508e+11 -2.14529e+10 9.18671e+11 9.18671e+11
    -1.64549e+06 -5.10403e+13 -5.10403e+13 5.42704e+07 2.07275e+13 2.07275e+13
    -1.02509e+08 -2.22551e+14 -2.22551e+14 7.44013e+09 -4.10238e+13 -4.10238e+13
    -220020 -2.22551e+14 -2.22551e+14 -1.17411e+07 -2.43094e+13 -2.43094e+13
    -55078 -2.22551e+14 -2.22551e+14 2.67342e+07 8.80939e+12 8.80939e+12
    -5.45586e+09 -2.22551e+14 -2.22551e+14 1.99278e+10 -5.44912e+13 -5.44912e+13
    -2.29466e+09 -1.35475e+13 -1.35475e+13 -2.18582e+10 2.0952e+13 2.0952e+13
    -2.68691e+06 -2.30801e+13 -2.30801e+13 -2.93389e+08 2.81856e+13 2.81856e+13
    -308272 -4.06321e+14 -4.06321e+14 -5.18663e+07 7.27645e+13 7.27645e+13
    -3.20791e+08 -7.56085e+11 -7.56085e+11 -6.62225e+09 2.06047e+12 2.06047e+12
    -343800 -4.06321e+14 -4.06321e+14 -1.00216e+08 -8.80379e+12 -8.80379e+12
    -4.51419e+07 -4.06321e+14 -4.06321e+14 1.08829e+10 -8.96585e+13 -8.96585e+13
    -1.672e+06 -4.06321e+14 -4.06321e+14 4.73304e+08 -6.27603e+13 -6.27603e+13
    -7.47418e+07 -1.81352e+14 -1.81352e+14 1.88562e+10 -9.12369e+13 -9.12369e+13
    -2.64224e+08 -5.78142e+13 -5.78142e+13 2.05357e+09 8.43729e+13 8.43729e+13
    -247784 -3.13644e+14 -3.13644e+14 6.70985e+07 3.07649e+13 3.07649e+13
    -148368 -5.24559e+14 -5.24559e+14 -7.90006e+07 3.45854e+13 3.45854e+13
    -3.51635e+07 -1.11673e+12 -1.11673e+12 1.67142e+09 1.17381e+12 1.17381e+12
    -2.57304e+06 -5.24559e+14 -5.24559e+14 -9.17211e+06 3.22175e+13 3.22175e+13
    -394416 -5.24559e+14 -5.24559e+14 -5.42436e+07 -5.93409e+13 -5.93409e+13
    -546688 -5.24559e+14 -5.24559e+14 4.73626e+08 -9.98509e+13 -9.98509e+13
    -4.89972e+09 -2.71902e+13 -2.71902e+13 1.48134e+11 2.4441e+13 2.4441e+13
    -2.5618e+06 -2.54198e+14 -2.54198e+14 -1.04936e+08 1.03768e+14 1.03768e+14
    -201818 -4.06321e+14 -4.06321e+14 5.25342e+07 2.85297e+13 2.85297e+13
    -45108 -4.06322e+14 -4.06322e+14 -4.66993e+07 -4.1103e+11 -4.1103e+11
    -2.48883e+06 -7.8946e+12 -7.8946e+12 -5.29195e+08 1.28701e+13 1.28701e+13
    -2.3376e+06 -4.06321e+14 -4.06321e+14 3.09963e+08 3.99409e+13 3.99409e+13
    -223498 -4.06321e+14 -4.06321e+14 7.31205e+07 -1.87645e+13 -1.87645e+13
    -390016 -4.06321e+14 -4.06321e+14 3.14765e+08 -7.54355e+13 -7.54355e+13
    -1.75239e+08 -4.02259e+13 -4.02259e+13 2.96184e+10 -9.17516e+12 -9.17516e+12
    -1.23968e+06 -4.06321e+14 -4.06321e+14 -7.37413e+08 8.53962e+13 8.53962e+13
    -6.75126e+07 -1.7841e+12 -1.7841e+12 6.61983e+09 4.41779e+12 4.41779e+12
    -2.81985e+07 -1.64193e+13 -1.64193e+13 -4.24373e+09 1.39135e+13 1.39135e+13
    -2.41807e+07 -4.45722e+12 -4.45722e+12 -4.99349e+09 4.6435e+11 4.6435e+11
    -3.19968e+06 -4.06321e+14 -4.06321e+14 1.31085e+09 -5.01286e+13 -5.01286e+13
    -1.53757e+06 -4.06321e+14 -4.06321e+14 3.53143e+08 -7.27645e+13 -7.27645e+13
    -69220 -4.06321e+14 -4.06321e+14 -5.92075e+07 -2.14355e+13 -2.14355e+13
    -7.50032e+09 -4.06321e+14 -4.06321e+14 2.5079e+10 -1.0229e+14 -1.0229e+14
    -7.0802e+09 -6.51685e+11 -6.51685e+11 -4.88213e+10 6.56937e+11 6.56937e+11
    -268558 -1.03017e+14 -1.03017e+14 -4.2673e+07 7.70381e+13 7.70381e+13
    -25490 -2.22551e+14 -2.22551e+14 1.22614e+07 2.43094e+13 2.43094e+13
    -2.15065e+08 -3.64106e+11 -3.64106e+11 -9.26604e+09 4.80813e+11 4.80813e+11
    -67472 -2.22551e+14 -2.22551e+14 3.92834e+07 1.57724e+13 1.57724e+13
    -5.0378e+08 -2.22551e+14 -2.22551e+14 2.33334e+10 -4.75282e+13 -4.75282e+13
    -1.11016e+09 -2.22551e+14 -2.22551e+14 3.32117e+10 -4.79868e+13 -4.79868e+13
    -1.34809e+06 -1.10265e+14 -1.10265e+14 1.86729e+08 -4.9724e+13 -4.9724e+13
    -9.88307e+06 -5.24559e+14 -5.24559e+14 -1.68476e+08 1.06099e+14 1.06099e+14
    -1.15611e+06 -7.27994e+13 -7.27994e+13 -1.41131e+08 4.05615e+13 4.05615e+13
    -980442 -1.81738e+13 -1.81738e+13 6.90831e+07 2.48541e+13 2.48541e+13
    -1.00781e+08 -1.4597e+12 -1.4597e+12 2.29401e+09 1.12587e+12 1.12587e+12
    -2.29498e+06 -5.24559e+14 -5.24559e+14 -3.61518e+08 -2.83376e+13 -2.83376e+13
    -309804 -5.24559e+14 -5.24559e+14 -4.70927e+07 -3.45854e+13 -3.45854e+13
    -13865 -5.24559e+14 -5.24559e+14 -1.27731e+07 -3.92958e+13 -3.92958e+13
    -1.0284e+10 -3.52787e+14 -3.52787e+14 -7.83663e+10 -8.20847e+13 -8.20847e+13
    -1.93585e+06 -3.63425e+14 -3.63425e+14 -9.27423e+07 6.22805e+13 6.22805e+13
    -220555 -3.63425e+14 -3.63425e+14 1.51874e+06 4.55258e+13 4.55258e+13
    -78392 -3.1182e+14 -3.1182e+14 -7.74062e+07 -1.10039e+13 -1.10039e+13
    -2.03932e+06 -3.70959e+13 -3.70959e+13 2.23079e+08 6.12195e+13 6.12195e+13
    -724400 -3.63425e+14 -3.63425e+14 -1.4328e+08 2.23541e+13 2.23541e+13
    -139264 -3.63425e+14 -3.63425e+14 9.41002e+06 5.59947e+12 5.59947e+12
    -27318 -3.63425e+14 -3.63425e+14 9.57975e+06 -4.55258e+13 -4.55258e+13
    -1.94705e+07 -2.08354e+14 -2.08354e+14 2.87003e+09 -7.34549e+13 -7.34549e+13
    -311128 -3.63425e+14 -3.63425e+14 -1.32985e+08 6.06356e+13 6.06356e+13
    -5.74384e+08 -1.0002e+12 -1.0002e+12 -4.02646e+10 1.6823e+12 1.6823e+12
    -5.23187e+07 -2.07128e+12 -2.07128e+12 -7.35669e+09 1.98585e+12 1.98585e+12
    -1.77738e+07 -9.62428e+12 -9.62428e+12 3.19403e+09 1.67449e+13 1.67449e+13
    -1.77928e+07 -3.63425e+14 -3.63425e+14 2.32491e+09 -5.82066e+13 -5.82066e+13
    -288718 -3.63425e+14 -3.63425e+14 -2.6594e+07 -4.26996e+13 -4.26996e+13
    -42434 -3.63425e+14 -3.63425e+14 -5.17523e+07 2.77326e+12 2.77326e+12
    -7.2133e+10 -3.63425e+14 -3.63425e+14 -1.86415e+11 -9.28972e+13 -9.28972e+13
    -6.39369e+10 -1.55874e+12 -1.55874e+12 2.07376e+11 2.35973e+12 2.35973e+12
    -322348 -1.00585e+14 -1.00585e+14 6.49868e+07 2.64138e+13 2.64138e+13
    -63157 -3.63425e+14 -3.63425e+14 1.4609e+07 4.26996e+13 4.26996e+13
    -1.81731e+08 -4.64739e+11 -4.64739e+11 6.90731e+09 2.44935e+11 2.44935e+11
    -258224 -3.63425e+14 -3.63425e+14 1.39737e+08 2.07093e+13 2.07093e+13
    -4.00876e+07 -3.63425e+14 -3.63425e+14 7.19011e+09 -7.49612e+13 -7.49612e+13
    -1.00694e+08 -3.63425e+14 -3.63425e+14 1.36334e+10 -7.61426e+13 -7.61426e+13
    -8.5995e+07 -8.03662e+13 -8.03662e+13 3.33733e+09 -3.52808e+13 -3.52808e+13
    -5.72174e+08 -1.06709e+14 -1.06709e+14 -4.20627e+09 1.65952e+14 1.65952e+14
    -550016 -8.03413e+13 -8.03413e+13 -6.2677e+07 1.01651e+14 1.01651e+14
    -478394 -1.2933e+14 -1.2933e+14 2.00402e+07 2.06147e+14 2.06147e+14
    -1.36416e+08 -9.17634e+11 -9.17634e+11 -5.28366e+09 1.40665e+12 1.40665e+12
    -3.06936e+06 -6.05708e+14 -6.05708e+14 9.28682e+07 -1.04378e+13 -1.04378e+13
    -329860 -6.05708e+14 -6.05708e+14 -3.99497e+07 -7.72407e+13 -7.72407e+13
    -39166 -6.05708e+14 -6.05708e+14 2.21804e+07 -8.19511e+13 -8.19511e+13
    -1.11235e+11 -1.81817e+14 -1.81817e+14 -1.17571e+11 -3.81741e+13 -3.81741e+13
    -1 -1 -1 -1
    -1 -1 999999 999999
    -1 -1 -1 -1
    0.05 1.732 1.732
    0.05 1.732 1.732
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
  }

primEdgedata { 5
    11757 12586 28017
    65552
    0 5
    30234 30234 30234 0
    131.703 115.29 2282.26 72.2175 59.1462 2129.06 939.83 259.302 51.8183 549.229 904.755 276.263 92.3108 578.039 120.609 234.956 234.82 146.119 237.546 743.532 100.669 573.049 43.009 63.2739 116.749 6215.42 168.03 1762.74 3864.11 55.7825 120.53 782.613 3846.16 137.667 121.352 101.794 8606.14 147.362 77.5146 198.503 573.917 81.358 1101.7 522.226 871.183 109.573 110.87 144.688 126.765 33.3146 34.0749 5144.71 4299.28 18477.9 96.8055 90.0376 231.86 11773.6 405.26 440.61 169.247 274.68 242.589 111.212 102.975 105.83
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 18167.2 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 31419.7 130560 130560 130560 130560 130560 130560 130560 130560
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 18167.2 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 31419.7 130560 130560 130560 130560 130560 130560 130560 130560
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    -1 -1 -1 -1
    -1 -1 999999 999999
    -1 -1 -1 -1
    0.05 1.732 1.732
    0.05 1.732 1.732
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
  }

primBodydata { 5
    11757 12586 28017
    65552
    0 5
    30234 30234 30234 0
    1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 16795 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 23001.1 130560 130560 130560 130560 130560 130560 130560 130560
    130560 130560 130560 130560 130560 15703.5 22545.4 21185 130560 130560 26795.2 130560 130560 130560 130560 81679.3 130560 130560 111296 64686.9 112021 18414.1 130560 130560 130560 130560 60434.8 12591.6 24709.3 130560 130560 130560 130560 130560 130560 130560 16795 130560 130560 130560 130560 130560 12274.2 18220.6 15075.8 130560 130560 27876.9 130560 130560 130560 58272.4 87806.9 130560 78064.5 130560 28962.9 23001.1 130560 130560 130560 130560 130560 130560 130560 130560
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    0 0 0 0 0 0
    -1 -1 -1 -1
    -1 -1 999999 999999
    -1 -1 -1 -1
    0.05 1.732 1.732
    0.05 1.732 1.732
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
    0.05 0.866 0.866
  }

crop {0 0 2440 1802}
"Adjust Lighting" 0
"Hybrid Matte" 0
"Fine Tuning" 0
name Primatte3
selected true
xpos -32662
ypos 14280
}
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle4
tile_color 0xffffffff
selected true
xpos -32662
ypos 14324
}
Dot {
name Dot27
label "Core\nMatte"
note_font_size 60
selected true
xpos -32628
ypos 15649
}
Dot {
name Dot28
selected true
xpos -32628
ypos 15742
}
set N9d04f800 [stack 0]
Dot {
name Dot29
note_font_size 41
selected true
xpos -32628
ypos 16442
}
push $N9d096800
push $N79b72c00
IBKGizmoV3 {
inputs 2
name IBKGizmoV3_2
xpos -31398
ypos 14914
}
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle5
tile_color 0xffffffff
selected true
xpos -31398
ypos 14965
}
Dot {
name Dot134
label "Edge\nMatte"
note_font_size 60
selected true
xpos -31364
ypos 16209
}
Merge2 {
inputs 2
operation screen
bbox B
name Merge10
selected true
xpos -31398
ypos 16438
}
Dot {
name Dot30
label "Combined\nMatte"
note_font_size 60
selected true
xpos -31364
ypos 17032
}
Dot {
name Dot31
label "Combined\nMatte"
note_font_size 60
selected true
xpos -34305
ypos 17032
}
push $N79bb8400
Remove {
channels rgba
name Remove16
selected true
xpos -34596
ypos 13387
}
NoOp {
name Anchor_217ff93ec1
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
knobChanged stamps.anchorKnobChanged()
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0xffffff01
note_font_size 20
selected true
xpos -34596
ypos 13436
addUserKnob {20 anchor_tab l "Anchor Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "GS Utils"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "GS Utils"}
addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_217ff93ec8}
addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
tags 2D,
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
NoOp {
name Stamp2
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
knobChanged "import stamps; stamps.wiredKnobChanged()"
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0x1000001
note_font "Bitstream Vera Sans"
note_font_size 20
selected true
xpos -34695
ypos 16643
hide_input true
addUserKnob {20 wired_tab l "Wired Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "GS Utils"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "GS Utils"}
addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." T "<i>creating GS channel,Advanced Keying Template</i>"}
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 anchor_label l Anchor: T " "}
addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
addUserKnob {26 space_1 l "" +STARTLINE T " "}
addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
addUserKnob {26 space_2 l "" +STARTLINE T " "}
addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
addUserKnob {1 anchor l Anchor}
anchor Anchor_217ff93ec8
addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Dot {
name Dot32
note_font_size 41
selected true
xpos -34661
ypos 16721
}
Dot {
name Dot33
note_font_size 41
selected true
xpos -34528
ypos 16721
}
set N9d002400 [stack 0]
Dot {
name Dot34
note_font_size 41
selected true
xpos -34528
ypos 16771
}
push $N9d002400
push $N9d04f800
Dot {
name Dot37
note_font_size 41
selected true
xpos -33013
ypos 15742
}
Group {
name ExponBlurSimple8
onCreate "n = nuke.thisNode()\nn.knob('size').setRange(-100, 100)\nn.knob('adjustBBoxPixels').setRange(0, 400)\nn.knob('adjustBBoxPercent').setRange(1, 2)\nn.knob('safeBBoxPixels').setRange(0, 400)\nn.knob('safeBBoxPercent').setRange(1, 2)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n        \n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n        \nelif k.name() == \"steps\":\n    \n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n        \n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n        \n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('mult').getValue()\n        \n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, b1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression(\"(Blur1.size)*(mult)**%s\"%(i))\n            b\[\"label\"].setValue(\"\[value size]\")\n            merge.setInput(i if i<2 else i+1, b)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n            \n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n            \nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n        \nelif k.name() == \"safeBBox\":\n    if n.knob(\"safeBBox\").getValue() == 0:\n        n.knob('safeBBoxText').setVisible(False)\n        n.knob('safetyBBoxMethod').setVisible(False)\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(False)\n        \n    elif n.knob(\"safeBBox\").getValue() == 1:\n        n.knob('safetyBBoxMethod').setVisible(True)\n        n.knob('safeBBoxText').setVisible(True)\n        if n.knob('safetyBBoxMethod').value() == \"pixels\":\n            n.knob('safeBBoxPixels').setVisible(True)\n            n.knob('safeBBoxPercent').setVisible(False)\n        elif n.knob('safetyBBoxMethod').value() == \"percent\":\n            n.knob('safeBBoxPixels').setVisible(False)\n            n.knob('safeBBoxPercent').setVisible(True)\n            \nelif k.name() == \"safetyBBoxMethod\":\n    if n.knob(\"safetyBBoxMethod\").value() == \"pixels\":\n        n.knob('safeBBoxPixels').setVisible(True)\n        n.knob('safeBBoxPercent').setVisible(False)\n    elif n.knob(\"safetyBBoxMethod\").value() == \"percent\":\n        n.knob('safeBBoxPixels').setVisible(False)\n        n.knob('safeBBoxPercent').setVisible(True)\n        \nelif k.name() == \"adjustBBoxExtra\":\n    if n.knob(\"adjustBBoxExtra\").value() == \"pixels\":\n        n.knob('adjustBBoxPixels').setVisible(True)\n        n.knob('adjustBBoxPercent').setVisible(False)\n    elif n.knob(\"adjustBBoxExtra\").value() == \"percent\":\n        n.knob('adjustBBoxPixels').setVisible(False)\n        n.knob('adjustBBoxPercent').setVisible(True)\n"
tile_color 0xcc804eff
label "(\[value output2])"
note_font "Verdana Bold"
note_font_color 0xffffffff
selected true
xpos -33047
ypos 15981
addUserKnob {20 ExponBlurSimple}
addUserKnob {41 channels T Remove1.channels}
addUserKnob {41 maskChannelMask_1 l area T Multiply1.maskChannelMask}
addUserKnob {41 inject_1 l inject -STARTLINE T Multiply1.inject}
addUserKnob {41 invert_mask_1 l invert -STARTLINE T Multiply1.invert_mask}
addUserKnob {41 fringe_1 l fringe -STARTLINE T Multiply1.fringe}
addUserKnob {26 ""}
addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
addUserKnob {3 steps l "  Steps" -STARTLINE}
steps 4
addUserKnob {26 text l " " -STARTLINE T " "}
addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
includeOriginal true
addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
addUserKnob {14 size l Size R -100 100}
size -3
addUserKnob {7 mult l Multiplier R 1 5}
mult 3
addUserKnob {6 clamp +STARTLINE}
addUserKnob {14 postBlur l "Post Blur" R 0 100}
addUserKnob {26 ""}
addUserKnob {20 bboxControl l "BBox Control" n 1}
bboxControl 0
addUserKnob {26 text_2 l " " T " "}
addUserKnob {4 bbox l "BBox: " -STARTLINE M {union intersectionMask A B "input format" "" "" "" "" "" "" "" "" "" "" "" ""}}
addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
addUserKnob {6 safeBBox l "Safe BBox" t "If the output BBox is larger than the input format and the input box combined. the result will be max of the input/format bbox plus a safety \"buffer\" in pixels or percent \n\nTurning off might make your BBox grow exponentially with high blur values" -STARTLINE}
safeBBox true
addUserKnob {26 safeBBoxText l "" +STARTLINE T " "}
addUserKnob {4 safetyBBoxMethod l "Safe BBox Buffer  " -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""}}
safetyBBoxMethod percent
addUserKnob {14 safeBBoxPixels l "" -STARTLINE +HIDDEN R 0 400}
safeBBoxPixels 100
addUserKnob {14 safeBBoxPercent l "" -STARTLINE R 1 2}
safeBBoxPercent 1.1
addUserKnob {26 text_3 l "" +STARTLINE T " "}
addUserKnob {4 adjustBBoxExtra l "Extra BBox Adjust" -STARTLINE M {pixels percent "" "" "" "" "" "" "" "" "" "" "" "" ""}}
addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
adjustBBoxPercent 1
addUserKnob {14 adjustBBoxPixels l "" -STARTLINE R 0 400}
addUserKnob {26 ""}
addUserKnob {20 endGroup n -1}
addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
addUserKnob {41 mix T MergeKeymix.mix}
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "Tony Lyons"}
addUserKnob {26 desc l Description: T ExponBlurSimple}
addUserKnob {26 ver l Version: T v03}
}
BackdropNode {
inputs 0
name BackdropNode1
tile_color 0x535e5a00
label "BBox Management"
note_font_size 30
note_font_color 0xffffffff
xpos -529
ypos 492
bdwidth 341
bdheight 525
}
Input {
inputs 0
name Inputimg
xpos 0
ypos -969
}
Dot {
name Dot16
note_font_size 41
xpos 34
ypos -802
}
set N9d001000 [stack 0]
Dot {
name Dot2
note_font_size 41
xpos -367
ypos -802
}
Dot {
name Dot18
label B
note_font_size 41
xpos -367
ypos 434
}
Dot {
name Dot11
note_font_size 41
xpos -367
ypos 623
}
set N9d000400 [stack 0]
Dot {
name Dot3
note_font_size 41
xpos -367
ypos 675
}
set Nd0643c00 [stack 0]
Dot {
name Dot8
note_font_size 41
xpos -463
ypos 675
}
Dot {
name Dot15
note_font_size 41
xpos -463
ypos 831
}
push $N9d001000
Dot {
name Dot1
note_font_size 41
xpos 461
ypos -802
}
Remove {
operation keep
channels rgba
name Remove1
xpos 427
ypos -718
}
Dot {
name Dot21
note_font_size 41
xpos 461
ypos -597
}
set Nd0642800 [stack 0]
Invert {
name Invert1
xpos 695
ypos -604
disable {{"parent.size < 0 ? 0 : 1"}}
}
set Nd0642400 [stack 0]
Dot {
name Dot4
note_font_size 41
xpos 540
ypos -543
}
NoOp {
name Original
xpos 506
ypos -327
}
set Nd0641c00 [stack 0]
Dot {
name Dot5
note_font_size 41
xpos 540
ypos 14
}
Crop {
inputs 0
box {{"!\[exists parent.input0] ? 0 : input.format.x"} {"!\[exists parent.input0] ? 0 : input.format.y"} {"!\[exists parent.input0] ? 0 : input.format.r"} {"!\[exists parent.input0] ? 0 : input.format.t"}}
reformat true
crop false
name Crop1
xpos 210
ypos -750
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
AddChannels {
channels rgba
name AddChannels2
xpos 210
ypos -724
}
push $N9d001000
Merge2 {
inputs 2
name Merge3
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 83
ypos -671
}
NoOp {
name BBoxInput
xpos 83
ypos -628
addUserKnob {20 User}
addUserKnob {15 bbox}
bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
}
push $Nd0641c00
Input {
inputs 0
name Inputarea
xpos 289
ypos -638
number 2
}
AddChannels {
channels alpha
color 1
name AddChannels1
xpos 289
ypos -580
}
Invert {
channels rgba
name Invert3
xpos 289
ypos -503
}
push $Nd0642400
Multiply {
inputs 1+1
value 0
name Multiply1
label "\[value value]"
xpos 695
ypos -512
}
NoOp {
name Start
xpos 695
ypos -450
}
set Nd060f000 [stack 0]
Blur {
size {{(Blur1.size)*(mult)**3} {(Blur1.size)*(mult)**3}}
crop false
name Blur4
label "\[value size]"
xpos 995
ypos -370
}
push $Nd060f000
Blur {
size {{(Blur1.size)*(mult)**2} {(Blur1.size)*(mult)**2}}
crop false
name Blur3
label "\[value size]"
xpos 895
ypos -370
}
push 0
push $Nd060f000
Blur {
size {{(Blur1.size)*(mult)**1} {(Blur1.size)*(mult)**1}}
crop false
name Blur2
label "\[value size]"
xpos 795
ypos -370
}
push $Nd060f000
Blur {
size {{parent.size.w} {parent.size.h}}
name Blur1
label "\[value size]"
xpos 695
ypos -370
}
Merge2 {
inputs 5+1
operation {{mergeNumber.mergeNumber}}
also_merge all
name Merge1
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 695
ypos -273
}
NoOp {
name End
xpos 695
ypos -230
}
set Nd060d800 [stack 0]
CopyBBox {
inputs 2
name CopyBBox1
xpos 585
ypos -175
}
Group {
name BBoxToFormat
onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
tile_color 0xa57aaaff
note_font "Verdana Bold"
note_font_color 0xffffffff
xpos 585
ypos -151
addUserKnob {20 CropBBox}
addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
addUserKnob {41 intersect T Crop6.intersect}
addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
overscanType {{parent.safetyBBoxMethod}}
addUserKnob {14 overscan l Overscan R 0 400}
overscan {{parent.safeBBoxPixels} {parent.safeBBoxPixels}}
addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
overscanPercent {{parent.safeBBoxPercent} {parent.safeBBoxPercent}}
addUserKnob {20 inputBbox l "BBox Data" n 1}
addUserKnob {15 inputFormat l "Input Format"}
inputFormat {0 0 {input.width} {input.height}}
addUserKnob {15 inputBBox l "Input BBox"}
inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
addUserKnob {15 outputBBox l "Output BBox"}
outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
addUserKnob {20 endGroup n -1}
addUserKnob {20 info_1 l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
addUserKnob {26 ver l Version: T v02}
}
Input {
inputs 0
name Input
xpos 261
ypos 394
}
Dot {
name Dot2
note_font_size 41
xpos 295
ypos 462
}
set Nd060cc00 [stack 0]
Dot {
name Dot1
note_font_size 41
xpos -160
ypos 462
}
set Nd060c800 [stack 0]
push $Nd060cc00
Crop {
box {{parent.inputBBox} {parent.inputBBox} {parent.inputBBox} {parent.inputBBox}}
crop {{parent.blackOutside}}
name Crop6
xpos 261
ypos 510
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
set Nd060c400 [stack 0]
Remove {
operation keep
channels none
name Remove1
xpos 120
ypos 504
}
set N1ed87c00 [stack 0]
Transform {
scale {{parent.overscanPercent} {parent.overscanPercent}}
center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
shutteroffset centred
name Transform1
selected true
xpos 120
ypos 553
}
push $N1ed87c00
AdjBBox {
numpixels {{parent.overscan} {parent.overscan}}
name AdjBBox1
xpos -5
ypos 510
}
Switch {
inputs 2
which {{overscanType}}
name Switch2
label "\[value which]"
xpos -5
ypos 549
}
Merge2 {
inputs 2
bbox intersection
Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
name Merge1
xpos -5
ypos 647
disable {{!parent.Crop6.intersect}}
}
push $Nd060c800
CopyBBox {
inputs 2
name CopyBBox1
xpos -194
ypos 653
}
BlackOutside {
name BlackOutside1
xpos -194
ypos 692
disable {{!parent.blackOutside}}
}
Dot {
name Dot4
note_font_size 41
xpos -160
ypos 769
}
push $Nd060c400
Switch {
inputs 2
which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
name Switch1
label "\[value which]"
xpos 261
ypos 759
}
set N1ed85c00 [stack 0]
Output {
name Output1
xpos 261
ypos 921
}
push $N1ed85c00
NoOp {
name OutputBBox1
xpos 378
ypos 821
addUserKnob {20 User}
addUserKnob {15 OutputBBox l "Output BBox"}
OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
}
end_group
push $Nd060d800
Merge2 {
inputs 2
bbox intersection
also_merge all
name Merge4
xpos 585
ypos -127
}
push $Nd060d800
CopyBBox {
inputs 2
name CopyBBox2
xpos 585
ypos -101
}
push $Nd060d800
Switch {
inputs 2
which {{"parent.safeBBox && ((BBoxResult.bbox.x < BBoxInput.bbox.x || BBoxResult.bbox.y < BBoxInput.bbox.y || BBoxResult.bbox.r > BBoxInput.bbox.r || BBoxResult.bbox.t > BBoxInput.bbox.t))"}}
name Switch2
label "\[value which]"
xpos 695
ypos -106
}
Grade {
channels all
whitepoint 5
black_clamp false
name AverageMult
xpos 695
ypos -37
disable {{"output2 == 4 ? 0 : 1"}}
}
Merge2 {
inputs 2
operation max
also_merge all
name Merge2
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 695
ypos 10
disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
}
Clamp {
name Clamp1
selected true
xpos 695
ypos 50
disable {{!parent.clamp}}
}
Blur {
size {{postBlur} {postBlur}}
name BlurOriginal
label "\[value size]"
xpos 695
ypos 102
}
Invert {
name Invert2
xpos 695
ypos 144
disable {{"parent.size < 0 ? 0 : 1"}}
}
push $Nd0642800
Switch {
inputs 2
which {{"parent.size == 0 ? 0 : 1"}}
name Switch1
label "\[value which]"
xpos 427
ypos 190
}
Dot {
name Dot17
label A
note_font_size 41
xpos 34
ypos 455
}
Dot {
name Dot7
note_font_size 41
xpos 34
ypos 579
}
set N1ed36400 [stack 0]
Dot {
name Dot12
note_font_size 41
xpos -260
ypos 579
}
Dot {
name Dot13
note_font_size 41
xpos -260
ypos 799
}
push $N9d000400
Input {
inputs 0
name Inputmask
xpos 512
ypos 322
number 1
}
Dot {
name Dot19
label Mask
note_font_size 41
xpos 546
ypos 435
}
set N1ed35400 [stack 0]
Dot {
name Dot20
note_font_size 41
xpos 436
ypos 435
}
push $N1ed36400
Merge2 {
inputs 2
bbox intersection
Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
output {rgba.red -rgba.green -rgba.blue rgba.alpha}
name MergeIntersection
xpos 402
ypos 572
disable {{"!\[exists parent.input1]"}}
}
Merge2 {
inputs 2
Achannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue rgba.alpha}
output {rgba.red -rgba.green -rgba.blue rgba.alpha}
name MergeUnion
xpos 402
ypos 610
disable {{"!\[exists parent.input1]"}}
}
Dot {
name Dot6
label "intersection\nof (Mask and A) + B"
note_font_size 14
note_font_color 0xffffffff
xpos 436
ypos 770
}
push $N1ed35400
Dot {
name Dot10
note_font_size 41
xpos 546
ypos 672
}
push $N1ed36400
push $Nd0643c00
Merge2 {
inputs 2+1
operation copy
Achannels none
Bchannels none
output none
also_merge {{{parent.Remove1.channels}}}
name MergeKeymix
xpos 0
ypos 665
}
Dot {
name Dot14
note_font_size 41
xpos 34
ypos 747
}
set Nc7397400 [stack 0]
push $Nd0643c00
CopyBBox {
inputs 2
name CopyBBoxUnion
xpos -401
ypos 743
disable {{parent.bbox==0?0:1}}
}
CopyBBox {
inputs 2
name CopyBBoxIntersection
xpos -401
ypos 769
disable {{"parent.bbox==1 ? 0 : 1"}}
}
CopyBBox {
inputs 2
name CopyBBoxA
xpos -401
ypos 795
disable {{"parent.bbox==2 ? 0 : 1"}}
}
CopyBBox {
inputs 2
name CopyBBoxB
xpos -401
ypos 827
disable {{"parent.bbox==3 ? 0 : 1"}}
}
Crop {
box {0 0 {parent.width} {parent.height}}
crop false
name CopyBBoxFormat
xpos -401
ypos 853
disable {{"parent.bbox==4 ? 0 : 1"}}
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
set Nc7396000 [stack 0]
Transform {
scale {{parent.adjustBBoxPercent} {parent.adjustBBoxPercent}}
center {{((input.bbox.r-input.bbox.x)/2)+input.bbox.x} {((input.bbox.t-input.bbox.y)/2)+input.bbox.y}}
black_outside false
shutteroffset centred
name TransformBBoxAdjustPercent
xpos -516
ypos 898
}
push $Nc7396000
AdjBBox {
numpixels {{parent.adjustBBoxPixels} {parent.adjustBBoxPixels}}
name AdjBBoxPixels
xpos -401
ypos 901
}
Switch {
inputs 2
which {{adjustBBoxExtra}}
name Switch3
xpos -401
ypos 940
}
Dot {
name Dot9
note_font_size 41
xpos -367
ypos 993
}
push $Nc7397400
CopyBBox {
inputs 2
name CopyBBox
xpos 0
ypos 989
}
BlackOutside {
name BlackOutside1
xpos 0
ypos 1015
disable {{!parent.blackOutside}}
}
Output {
name Output1
xpos 0
ypos 1155
}
NoOp {
inputs 0
name mergeNumber
xpos 229
ypos -862
addUserKnob {20 User}
addUserKnob {3 mergeNumber}
mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
}
push $Nd060d800
NoOp {
name BBoxResult
xpos 585
ypos -230
addUserKnob {20 User}
addUserKnob {15 bbox}
bbox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
}
end_group
Dot {
name Dot38
note_font_size 41
selected true
xpos -33013
ypos 16149
}
Dot {
name Dot39
label "Core\nMatte"
note_font_size 60
selected true
xpos -34084
ypos 16149
}
Dot {
name Dot41
note_font_size 41
selected true
xpos -34194
ypos 16149
}
set Nc7352c00 [stack 0]
push $N79b73c00
Dot {
name Dot42
selected true
xpos -36072
ypos 13720
}
Remove {
operation keep
channels rgb
name Remove17
selected true
xpos -36106
ypos 13841
}
Dot {
name Dot43
selected true
xpos -36072
ypos 14203
}
set Nc7352000 [stack 0]
Group {
name apDespill3
help "apDespill v1.0 by Adrian Pueyo\n\nGizmo to despill an image, with options to despill any hue (and not only the primaries), select different algorithms for des/respilling, and protect tones from the despill.\n\nIf you just want a basic despill, its default values should already be enough and the tool will avoid any extra calculations.\n\nadrianpueyo.com, 2014-2017"
onCreate "n = nuke.thisNode()\nn\['tolerance'].setRange(0,2)\nn\['prot1_tolerance'].setFlag(0x00000004)\nn\['prot1_effect'].setFlag(0x00000004)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\nif k.name() == \"color\":\n    if k.getValue() == 0:\n        n\[\"custom_weight\"].setLabel(\"green - blue\")\n    elif k.getValue() == 1:\n        n\[\"custom_weight\"].setLabel(\"red - blue\")\n    elif k.getValue() == 2:\n        n\[\"custom_weight\"].setLabel(\"red - green\")\n    n\[\"pick\"].setVisible(k.getValue() == 3)\nelif k.name() == \"mode\":\n    n\[\"custom_weight\"].setVisible(n\[\"mode\"].getValue()==3)\nelif k.name() in \[\"out\",\"output_alpha\"]:\n    n\[\"respill_math\"].setEnabled(n\[\"out\"].getValue()==0 or n\[\"output_alpha\"].getValue()==1)\n    n\[\"respill_color\"].setEnabled(n\[\"out\"].getValue()==0)\nelif k.name() == \"prot1_activate\":\n    protA = n\[\"prot1_activate\"].value()\n    n\[\"prot1_preview\"].setEnabled(protA)\n    n\[\"prot1\"].setVisible(protA)\n    n\[\"prot1_tolerance\"].setVisible(protA)\n    n\[\"prot1_falloff\"].setVisible(protA)\n    n\[\"prot1_effect\"].setVisible(protA)"
tile_color 0x8b8b8bff
selected true
xpos -36106
ypos 14397
addUserKnob {20 apDespill}
addUserKnob {6 pick_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {41 "Local GPU: " T apDespillKernel.gpuName}
addUserKnob {41 "Use GPU if Available" T apDespillKernel.useGPUIfAvailable}
addUserKnob {41 vectorize l "Vectorize on CPU" -STARTLINE T apDespillKernel.vectorize}
addUserKnob {26 ""}
addUserKnob {4 color t "Select a primary as a starting point, or custom to show RGB controls to select any color." M {red green blue custom ""}}
color green
addUserKnob {18 pick +HIDDEN}
pick {0 0 0}
addUserKnob {6 pick_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 pick_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 pick_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 pick_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 pick_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 pick_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 pick_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 dfg_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {4 out l output t "Quick switch to output the despilled image or the substracted one." M {despill spill}}
addUserKnob {6 output_alpha l "output spill matte in alpha" t "Output the spill luminance in the alpha channel." -STARTLINE}
addUserKnob {4 mode l "despill math" t "average = avg of other two channels\nmaximum = max of other two channels\nminimum = min of other two channels\ncustom = select custom weights" M {average maximum minimum custom}}
addUserKnob {4 logLin l "Colorspace Log/Lin" -STARTLINE +INVISIBLE M {Log Lin ""}}
logLin Lin
addUserKnob {6 logspace l "Log Space" -STARTLINE}
addUserKnob {7 custom_weight l "red - blue" t "-1 = only capped by the first channel\n0 = capped by avg of both\n1 = only capped by the second channel" -STARTLINE +HIDDEN R -1 1}
addUserKnob {41 colorspace_out l colorspace T Colorspace1.colorspace_out}
addUserKnob {41 illuminant_out l "" -STARTLINE T Colorspace1.illuminant_out}
addUserKnob {41 primary_out l "" -STARTLINE T Colorspace1.primary_out}
addUserKnob {26 text l " " T " "}
addUserKnob {7 hue_offset l "hue offset" t "Rotate the despill vectors to despill an arbitrary tone other than the primaries.\nNote: A rotation of +-120 degrees is the same as selecting another color channel." R -180 180}
addUserKnob {7 tolerance t "Use this to multiply the hue tolerance (the limiter value). You can move it all the way down to 0 to completely remove a hue from your image." R 0 2}
tolerance 1
addUserKnob {6 prot1_activate l "protect tones" t "Enable controls to select tones to protect from despilling." +STARTLINE}
addUserKnob {6 prot1_preview l preview t "Output the protected tones." -STARTLINE +DISABLED}
addUserKnob {18 prot1 l protect t "Pick the central hue to protect.\n(ctrl/cmd+alt+click)" +HIDDEN}
prot1 {0 0 0}
addUserKnob {6 prot1_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 prot1_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 prot1_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 prot1_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 prot1_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 prot1_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 prot1_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {7 prot1_tolerance l tolerance t "Amount of hues to include in the selection." +HIDDEN}
prot1_tolerance 0.2
addUserKnob {7 prot1_falloff l falloff t "Falloff for the hue selection. A higher falloff will make hues apart from the picked one lose weight more quickly." +HIDDEN R 0 4}
prot1_falloff 2
addUserKnob {7 prot1_effect l effect t "Multiplier for the hue protection, and for the spill limit value." +HIDDEN R 0 10}
prot1_effect 1
addUserKnob {26 respill_divider l "" +STARTLINE}
addUserKnob {4 respill_math l "respill math" t "Settings for the way of desaturating the spill before adding it back." M {"Rec 709" "Ccir 601" Average Maximum "" ""}}
addUserKnob {18 respill_color l "respill color" t "RGB multiplier for the desaturated spill when adding it back.\n\nNote: if used on non-degrained plates (which should be avoided anyway), any value other than 1 here will most likely produce grain artifacts." R 0 4}
respill_color 1
addUserKnob {6 respill_color_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 respill_color_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 respill_color_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 respill_color_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 respill_color_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 respill_color_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 respill_color_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {26 ""}
addUserKnob {41 maskChannelMask l mask T Merge.maskChannelMask}
addUserKnob {41 inject -STARTLINE T Merge.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T Merge.invert_mask}
addUserKnob {41 fringe -STARTLINE T Merge.fringe}
addUserKnob {41 mix T Merge.mix}
addUserKnob {26 version_author l "" t "apDespill v1.0\n14 March, 2017" +STARTLINE T "<span style=\"color:#666\"><br/><b>apDespill v1.0</b> - <a href=\"http://www.adrianpueyo.com\" style=\"color:#666;text-decoration: none;\">adrianpueyo.com</a>, 2014-2017</span>"}
addUserKnob {20 GPU_Settings l "GPU Settings"}
addUserKnob {41 maxGPUMemory l "Percentage of GPU memory to use" T apDespillKernel.maxGPUMemory}
addUserKnob {41 maxTileLines l "Percentage of image height per tile" T apDespillKernel.maxTileLines}
}
Input {
inputs 0
name Inputmask
xpos 339
ypos -447
number 1
}
Input {
inputs 0
name Inputimg
xpos 449
ypos -764
}
set Nc7351800 [stack 0]
Colorspace {
name Colorspace1
label "\[value colorspace_in] >> \[value colorspace_out]"
xpos 559
ypos -703
}
Log2Lin {
operation lin2log
name Log2Lin1
xpos 559
ypos -665
disable {{!logspace}}
}
Shuffle {
name Shuffle
xpos 559
ypos -608
disable {{"\[exists parent.input0]"}}
}
BlinkScript {
ProgramGroup 1
KernelDescription "2 \"apDespillKernel\" iterate pixelWise 86d17838f15464a9e9273cd415388c19006f9163a6efd15e7ad521c828dc89ac 2 \"src\" Read Point \"dst\" Write Point 17 \"limit\" Float 1 AACAPw== \"shift\" Float 1 AAAAAA== \"weights\" Float 1 AAAAAA== \"outmode\" Int 1 AAAAAA== \"output_alpha\" Int 1 AAAAAA== \"clr\" Int 1 AAAAAA== \"mode\" Int 1 AAAAAA== \"respill_math\" Int 1 AAAAAA== \"respill_color\" Float 4 AAAAAAAAAAAAAAAAAAAAAA== \"prot1_on\" Int 1 AAAAAA== \"prot1_preview\" Int 1 AAAAAA== \"prot1\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"prot1_tolerance\" Float 1 AAAAAA== \"prot1_mult\" Float 1 AAAAAA== \"prot1_falloff\" Float 1 AAAAAA== \"lumaHueShift\" Int 1 AAAAAA== \"pickSpill\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== 17 \"limit\" 1 1 \"shift\" 1 1 \"weights\" 1 1 \"outmode\" 1 1 \"output_alpha\" 1 1 \"clr\" 1 1 \"mode\" 1 1 \"respill_math\" 1 1 \"respill_color\" 4 1 \"prot1_on\" 1 1 \"prot1_preview\" 1 1 \"prot1\" 3 1 \"prot1_tolerance\" 1 1 \"prot1_mult\" 1 1 \"prot1_falloff\" 1 1 \"lumaHueShift\" 1 1 \"pickSpill\" 3 1 3 \"_usePicked\" Int 1 1 AAAAAA== \"_clr\" Int 1 1 AAAAAA== \"_ret\" Int 1 1 AAAAAA=="
kernelSource "//---------------------------------------------------------\n// apDespillKernel - apDespill v1.0 by Adrian Pueyo\n//\n// Despill an image, with options to despill any hue (and\n// not only the primaries), select different algorithms for\n// des/respilling, and protect tones from the despill.\n//\n// adrianpueyo.com, 2014-2017\n// ---------------------------------------------------------\n\nstatic inline float y_convert_ccir601(const float4 in)\{\n  return in.x * 0.299f + in.y * 0.587f + in.z * 0.114f;\n\}\n\nstatic inline float y_convert_rec709(const float4 in)\{\n  return in.x * 0.2125f + in.y * 0.7154f + in.z * 0.0721f;\n\}\n\nstatic inline float4 hueShift(const float4 in, const float H)\{\n  if(H==0.0f)\{\n    return in;\n  \}else\{\n    float U = cos(H*PI/180);\n    float W = sin(H*PI/180);\n    float3 ret;\n    ret.x = (.299+.701*U+.168*W)*in.x + (.587-.587*U+.330*W)*in.y + (.114-.114*U-.497*W)*in.z;\n    ret.y = (.299-.299*U-.328*W)*in.x + (.587+.413*U+.035*W)*in.y + (.114-.114*U+.292*W)*in.z;\n    ret.z = (.299-.3*U+1.25*W)*in.x + (.587-.588*U-1.05*W)*in.y + (.114+.886*U-.203*W)*in.z;\n    return float4(ret.x,ret.y,ret.z,in\[3]);\n  \}\n\}\n\nstatic inline float4 hueRotate(const float4 in, const float H)\{\n  if(H==0.0f)\{\n    return in;\n  \}else\{\n    float cosH = cos(H*PI/180);\n    float sinH = sin(H*PI/180);\n    float3 ret;\n    ret.x = (in.x+in.y+in.z)*(1-cosH)/3 + in.x*cosH + (-in.y/sqrt(3.0f)+in.z/sqrt(3.0f))*sinH;\n    ret.y = (in.x+in.y+in.z)*(1-cosH)/3 + in.y*cosH + (in.x/sqrt(3.0f)-in.z/sqrt(3.0f))*sinH;\n    ret.z = (in.x+in.y+in.z)*(1-cosH)/3 + in.z*cosH + (-in.x/sqrt(3.0f)+in.y/sqrt(3.0f))*sinH;\n    return float4(ret.x,ret.y,ret.z,in\[3]);\n  \}\n\}\n\nfloat3 vecToPlane(float3 v1, float3 v2 = float3(1.0f,1.0f,1.0f))\{\n  float3 v1onv2;\n  v1onv2 = v2 * float((float(dot(v2,v1))/float(dot(v2,v2)))); //Projection of vector on another (plane's normal)\n  return v1-v1onv2; //Projection of vector on plane\n\}\n\nstatic inline float colorAngle(const float3 v1, const float3 v2)\{\n  const float3 vN=float3(1.0f,1.0f,1.0f);\n  float ang = acos(float(dot(v1,v2))/float(sqrt(dot(v1,v1)*dot(v2,v2))));\n  float3 crs = cross(v1,v2);\n  if (dot(vN, crs) > 0) \{\n    ang = -ang;\n  \}\n  return ang;\n\}\n\nkernel apDespillKernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src;\n  Image<eWrite> dst;\n\n  param:\n    float limit;\n    float shift;\n    float weights;\n    int outmode;//0=despill,1=spill\n    int output_alpha;\n    int clr; //0=red,1=green,2=blue\n    int mode; //0=average,1=maximum,2=minimum,3=custom\n    int respill_math; //0=Rec709,1=Ccir601,2=Avg,3=Max\n    float4 respill_color;\n    int prot1_on;\n    int prot1_preview;\n    float3 prot1;\n    float prot1_tolerance;\n    float prot1_mult;\n    float prot1_falloff;\n    int lumaHueShift;//If disabled, the hue is just rotated without the luma coefficients\n    float3 pickSpill;\n  local:\n    int _usePicked;\n    int _clr;\n    int _ret;\n\n  void define() \{\n    defineParam(limit, \"limit\", 1.0f);\n    defineParam(shift, \"shift\", 0.0f);\n  \}\n\n  void init() \{\n    _ret = 0;\n    if(clr!=3)\{//red green or blue\n      _usePicked = 0;\n      _clr = clr;\n    \}else if(pickSpill.x==pickSpill.y && pickSpill.x==pickSpill.z)\{\n      _ret = 1;//if \"custom\" selected but has a gray value, avoid any calculations\n    \}else\{\n      _usePicked = 1;\n      _clr = 0;\n    \}\n  \}\n\n  void process() \{\n\n    if(_ret == 1)\{ dst()=src(); return; \}//Avoid any calculations if no despill selected\n    //0. Calculate autoShift if picked spill is not 0\n    float autoShift = 0.0f;\n    if(_usePicked==1)\{\n      float3 vNorm = float3(1.0f,1.0f,1.0f);\n      autoShift = colorAngle(vecToPlane(pickSpill,vNorm),vecToPlane(float3(1.0f,0.0f,0.0f),vNorm));\n      autoShift = autoShift*180/PI;//to deg\n    \}\n\n    //1. HueShift IN\n    float4 despilled;\n    if (lumaHueShift==1)\{\n      despilled = hueShift(src(),shift-autoShift);\n    \}else\{\n      despilled = hueRotate(src(),shift-autoShift);\n    \}\n\n    //2. Calculate the limit\n    float resultLimit = 0.0f;\n    int2 others;\n    if(_clr==0)\{//If red (and if _usePicked, also set red)\n      others = int2(1,2);\n    \}else if(_clr==1)\{\n      others=int2(0,2);\n    \}else if(_clr==2)\{\n      others=int2(0,1);\n    \}\n\n    if(mode==0)\{//average\n      resultLimit = (despilled\[others\[0]]+despilled\[others\[1]])/2;\n    \}else if(mode==1)\{//max\n      resultLimit = max(despilled\[others\[0]],despilled\[others\[1]]);\n    \}else if(mode==2)\{//min\n      resultLimit = min(despilled\[others\[0]],despilled\[others\[1]]);\n    \}else\{//custom\n      resultLimit = despilled\[others\[0]]*weights+despilled\[others\[1]]*(1-weights);\n    \}\n\n    //3. Protect tones\n    float prot1_result;\n    if(prot1_on==1&&(prot1\[0]!=prot1\[1]||prot1\[0]!=prot1\[2]||prot1\[1]!=prot1\[2]))\{\n      float cos_prot1_angle;\n      cos_prot1_angle = (src(0)*prot1\[0]+src(1)*prot1\[1]+src(2)*prot1\[2]) / (sqrt(prot1\[0]*prot1\[0]+prot1\[1]*prot1\[1]+prot1\[2]*prot1\[2]) * sqrt(src(0)*src(0)+src(1)*src(1)+src(2)*src(2)));\n      prot1_result = pow(clamp(cos_prot1_angle,0.0f,1.0f),1/pow(prot1_tolerance,prot1_falloff));\n      resultLimit = resultLimit*(1+prot1_result*prot1_mult);\n    \}\n    \n\n    //4. Calculate the despill and return the hue shift\n    for (int component = 0; component < dst.kComps; component++)\{\n      despilled\[component] = component==_clr?min(despilled\[component],resultLimit*limit):despilled\[component];\n    \}\n    if (lumaHueShift==1)\{\n      despilled = hueShift(despilled,-shift+autoShift);\n    \}else\{\n      despilled = hueRotate(despilled,-shift+autoShift);\n    \}\n\n    //5. Respill/restore despill values\n    float luma;\n    float4 spill = src()-despilled;\n    if(respill_math==0)\{\n      luma = y_convert_rec709(spill);\n    \}else if(respill_math==1)\{\n      luma = y_convert_ccir601(spill);\n    \}else if(respill_math==2)\{\n      luma = (spill\[0]+spill\[1]+spill\[2])/3;\n    \}else\{\n      luma = max(max(spill\[0],spill\[1]),spill\[2]);\n    \}\n\n    //6. Output (options)\n    if(prot1_preview==1 && prot1_on==1)\{\n      dst() = src()*clamp(prot1_result*prot1_mult,0.0f,1.0f);\n    \}else if(outmode==0)\{\n      dst() = despilled+luma*respill_color;\n      if(output_alpha==0)\{\n        dst(3)=src(3);\n      \}else\{\n        dst(3)=luma;\n      \}\n    \}else\{\n      if(output_alpha==0)\{\n        spill\[3]=src(3);\n      \}else\{\n        spill\[3]=luma;\n      \}\n      dst() = spill;\n    \}\n    //dst() = hueRotate(src(),shift-autoShift);\n    //dst() = autoShift;\n  \}\n\};"
rebuild ""
apDespillKernel_limit {{parent.tolerance}}
apDespillKernel_shift {{parent.hue_offset}}
apDespillKernel_weights {{(parent.custom_weight+1)/2}}
apDespillKernel_outmode {{parent.out}}
apDespillKernel_output_alpha {{parent.output_alpha}}
apDespillKernel_clr {{parent.color}}
apDespillKernel_mode {{parent.mode}}
apDespillKernel_respill_math {{parent.respill_math}}
apDespillKernel_respill_color {{parent.respill_color.r} {parent.respill_color.g} {parent.respill_color.b} 1}
apDespillKernel_prot1_on {{parent.prot1_activate}}
apDespillKernel_prot1_preview {{parent.prot1_preview}}
apDespillKernel_prot1 {{parent.prot1} {parent.prot1} {parent.prot1}}
apDespillKernel_prot1_tolerance {{parent.prot1_tolerance}}
apDespillKernel_prot1_mult {{parent.prot1_effect}}
apDespillKernel_prot1_falloff {{parent.prot1_falloff}}
apDespillKernel_pickSpill {{parent.pick} {parent.pick} {parent.pick}}
rebuild_finalise ""
name apDespillKernel
xpos 559
ypos -582
}
Log2Lin {
name Log2Lin2
xpos 559
ypos -520
disable {{!logspace}}
}
Colorspace {
channels {{{parent.Colorspace5.channels}}}
colorspace_in {{parent.Colorspace1.colorspace_out}}
illuminant_in {{parent.Colorspace1.illuminant_out}}
primary_in {{parent.Colorspace1.primary_out}}
name Colorspace2
label "\[value colorspace_in] >> \[value colorspace_out]"
xpos 559
ypos -494
}
push $Nc7351800
Merge2 {
inputs 2+1
operation copy
bbox B
name Merge
xpos 449
ypos -447
}
Output {
name Output
xpos 449
ypos -400
}
end_group
Dot {
name Dot44
selected true
xpos -36072
ypos 14634
}
set N8d9b000 [stack 0]
push $Nc7352000
Dot {
name Dot45
selected true
xpos -35490
ypos 14203
}
Merge2 {
inputs 2
operation from
name Merge11
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
selected true
xpos -35524
ypos 14630
}
Saturation {
saturation 0
name Saturation2
selected true
xpos -35524
ypos 14681
}
Dot {
name Dot46
selected true
xpos -35490
ypos 14772
}
Dot {
name Dot47
label "Restore Lum"
note_font_size 41
selected true
xpos -35945
ypos 14772
}
push $N8d9b000
Merge2 {
inputs 2
operation plus
output {rgba.red rgba.green rgba.blue -rgba.alpha}
name Merge12
selected true
xpos -36106
ypos 14768
}
Dot {
name Dot49
label "core \ndespill"
note_font_size 60
selected true
xpos -36072
ypos 15128
}
Dot {
name Dot50
selected true
xpos -36072
ypos 16149
}
Dot {
name Dot52
label "core \ndespill"
note_font_size 60
selected true
xpos -34723
ypos 16149
}
push $Nc7352c00
Dot {
name Dot53
note_font_size 41
selected true
xpos -34194
ypos 16026
}
push $N79b73c00
Remove {
operation keep
channels rgb
name Remove18
selected true
xpos -34458
ypos 13841
}
Dot {
name Dot54
selected true
xpos -34424
ypos 14190
}
set N8d57c00 [stack 0]
OFXuk.co.thefoundry.keylight.keylight_v201 {
show "Final Result"
unPreMultiply false
screenColour {0 0 0}
screenGain 1
screenBalance 0.5
alphaBias {0.5 0.5 0.5}
despillBias {0.5 0.5 0.5}
gangBiases true
preBlur 0
"Screen Matte" 0
screenClipMin 0
screenClipMax 1
screenClipRollback 0
screenGrowShrink 0
screenSoftness 0
screenDespotBlack 0
screenDespotWhite 0
screenReplaceMethod "Soft Colour"
screenReplaceColour {0.5 0.5 0.5}
Tuning 0
midPoint 0.5
lowGain 1
midGain 1
highGain 1
"Inside Mask" 0
sourceAlphaHandling Ignore
insideReplaceMethod "Soft Colour"
insideReplaceColour {0.5 0.5 0.5}
Crops 0
SourceXMethod Colour
SourceYMethod Colour
SourceEdgeColour 0
SourceCropL 0
SourceCropR 1
SourceCropB 0
SourceCropT 1
balanceSet false
insideComponent None
outsideComponent None
cacheBreaker true
name Keylight2
selected true
xpos -34458
ypos 14406
}
set Naceee800 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle18
tile_color 0xffffffff
selected true
xpos -34325
ypos 14406
}
Grade {
channels rgba
blackpoint 0.0001
whitepoint 0.01
name Grade35
selected true
xpos -34325
ypos 14458
}
push $Naceee800
Saturation {
inputs 1+1
saturation 0.67
name Saturation12
selected true
xpos -34458
ypos 14458
}
Dot {
name Dot55
selected true
xpos -34424
ypos 14746
}
set N8d54400 [stack 0]
push $N8d57c00
Dot {
name Dot60
selected true
xpos -33810
ypos 14190
}
Merge2 {
inputs 2
operation from
name Merge13
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
selected true
xpos -33844
ypos 14742
}
Clamp {
channels rgba
maximum_enable false
name Clamp4
selected true
xpos -33844
ypos 14768
}
Saturation {
saturation 0
name Saturation4
selected true
xpos -33844
ypos 14794
}
Clamp {
channels rgba
maximum_enable false
name Clamp5
selected true
xpos -33844
ypos 14820
}
Shuffle {
green red
blue red
alpha red
name Shuffle6
tile_color 0x93000000
selected true
xpos -33844
ypos 14846
}
Dot {
name Dot157
label "despill\nmatte"
note_font_size 60
selected true
xpos -33810
ypos 14923
}
set N80ab6400 [stack 0]
Dot {
name Dot61
label "despill\nMatte"
note_font_size 60
selected true
xpos -33810
ypos 15120
}
push $N8d54400
Dot {
name Dot159
selected true
xpos -34424
ypos 14922
}
set N80ab5c00 [stack 0]
add_layer {despill despill.red}
Copy {
inputs 2
from0 rgba.red
to0 despill.red
name Copy1
selected true
xpos -34458
ypos 15110
}
Dot {
name Dot62
label "edge\ndespill"
note_font_size 60
selected true
xpos -34424
ypos 15872
}
Multiply {
inputs 1+1
channels despill
value 0
name Multiply2
label "\[value value]"
selected true
xpos -34458
ypos 16014
}
Keymix {
inputs 3
channels rgb
name Keymix3
selected true
xpos -34458
ypos 16145
}
add_layer {despill_RGB despill_RGB.red despill_RGB.green despill_RGB.blue despill_RGB.alpha}
Shuffle {
black red
white green
red2 blue
green2 black
out2 despill_RGB
name Shuffle7
label "\[value in] → \[value out2]"
selected true
xpos -34458
ypos 16218
}
Copy {
inputs 2
channels all
name Copy2
selected true
xpos -34458
ypos 16705
}
CopyBBox {
inputs 2
name CopyBBox2
selected true
xpos -34458
ypos 16767
}
Copy {
inputs 2
from0 rgba.alpha
to0 rgba.alpha
bbox B
name Copy3
selected true
xpos -34458
ypos 17022
}
Copy {
inputs 2
channels cleanplate
bbox B
name Copy4
selected true
xpos -34458
ypos 17378
}
Dot {
name Dot63
note_font_size 41
selected true
xpos -34424
ypos 17782
}
Dot {
name Dot162
note_font_size 41
selected true
xpos -34424
ypos 18243
}
Dot {
name Dot163
note_font_size 41
selected true
xpos -34424
ypos 18569
}
Dot {
name Dot64
note_font_size 41
selected true
xpos -34424
ypos 19091
}
set N80a4a400 [stack 0]
Dot {
name Dot68
note_font_size 41
selected true
xpos -34160
ypos 19091
}
set N80a4a000 [stack 0]
Dot {
name Dot69
note_font_size 41
selected true
xpos -33969
ypos 19091
}
set N80a49c00 [stack 0]
Shuffle {
in despill
name Shuffle8
label "\[value in]"
selected true
xpos -34003
ypos 19135
}
Remove {
operation keep
channels rgba
name Remove19
selected true
xpos -34003
ypos 19173
}
NoOp {
name Anchor_30be3b7c1
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
knobChanged stamps.anchorKnobChanged()
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0xffffff01
note_font_size 20
selected true
xpos -34003
ypos 19224
addUserKnob {20 anchor_tab l "Anchor Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "despill Mask"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T Despill}
addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_30be3b7c88}
addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
tags 2D,
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
NoOp {
name Stamp3
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
knobChanged "import stamps; stamps.wiredKnobChanged()"
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0x1000001
note_font "Bitstream Vera Sans"
note_font_size 20
selected true
xpos -34080
ypos 19618
hide_input true
addUserKnob {20 wired_tab l "Wired Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "despill Mask"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "despill Mask"}
addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." T "<i>Advanced Keying Template</i>"}
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 anchor_label l Anchor: T " "}
addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
addUserKnob {26 space_1 l "" +STARTLINE T " "}
addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
addUserKnob {26 space_2 l "" +STARTLINE T " "}
addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
addUserKnob {1 anchor l Anchor}
anchor Anchor_30be3b7c88
addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Grade {
channels rgba
multiply 4
black_clamp false
name Grade7
selected true
xpos -34080
ypos 19695
}
set N80a48800 [stack 0]
Dot {
name Dot70
label "despill\nmatte"
note_font_size 41
selected true
xpos -34046
ypos 19831
}
set N80a48400 [stack 0]
Dot {
name Dot71
note_font_size 41
selected true
xpos -34279
ypos 19829
}
Dot {
name Dot72
note_font_size 41
selected true
xpos -34279
ypos 20139
}
push $N79bba800
NoOp {
name Stamp4
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
knobChanged "import stamps; stamps.wiredKnobChanged()"
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0x1000001
note_font "Bitstream Vera Sans"
note_font_size 20
selected true
xpos -33376
ypos 19585
hide_input true
addUserKnob {20 wired_tab l "Wired Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "BG Before Key"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "BG Before Key"}
addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." +HIDDEN T " "}
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 anchor_label l Anchor: T " "}
addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
addUserKnob {26 space_1 l "" +STARTLINE T " "}
addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
addUserKnob {26 space_2 l "" +STARTLINE T " "}
addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
addUserKnob {1 anchor l Anchor}
anchor Anchor_3cad2b60ea
addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Dot {
name Dot73
note_font_size 41
selected true
xpos -33342
ypos 19660
}
set N3a967000 [stack 0]
Dot {
name Dot74
note_font_size 41
selected true
xpos -33342
ypos 20227
}
Dot {
name Dot75
label BG
note_font_size 101
selected true
xpos -33947
ypos 20227
}
push $N3a967000
Dot {
name Dot76
note_font_size 41
selected true
xpos -33740
ypos 19660
}
Dot {
name Dot77
label BG
note_font_size 101
selected true
xpos -33740
ypos 19748
}
Grade {
blackpoint 0.008
whitepoint 0.225
black_clamp false
name Grade12
label "BG Prep"
selected true
xpos -33774
ypos 19827
}
Dot {
name Dot78
selected true
xpos -33740
ypos 19916
}
push $N80a48400
Merge2 {
inputs 2
operation multiply
name Merge14
selected true
xpos -34080
ypos 19914
}
Shuffle {
alpha black
name Shuffle9
label "\[value in]"
selected true
xpos -34080
ypos 19987
}
push $N80a48800
Shuffle {
green red
blue red
alpha red
name Shuffle19
label "\[value in]"
selected true
xpos -34289
ypos 19691
}
Grade {
channels rgba
whitepoint 0.5
black_clamp false
white_clamp true
name Grade13
selected true
xpos -34289
ypos 19745
}
push $N80a4a400
Remove {
operation keep
channels rgba
channels2 GS_Plate
name Remove20
selected true
xpos -34458
ypos 19182
}
Saturation {
inputs 1+1
saturation 0.5
name Saturation5
label "change if necessary"
selected true
xpos -34458
ypos 19741
}
Merge2 {
inputs 2
operation plus
bbox B
output {rgba.red rgba.green rgba.blue -rgba.alpha}
name Merge15
selected true
xpos -34458
ypos 19991
}
Group {
inputs 3
name BlacksMatch2
help "Choose a black point color or plug an image /constant you wish to be your blackpoint into BlackColor input.\n\nUse Mult Range to control how far above the blackpoint color to affect the lows\n\nUse the RollOff gamma to add fall off to the bottom of the curve\n\nTurn on the preview Plotscan and move the sampler over a region to see what your settings are doing to a linear 0-1 ramp.  This will help you see if you have weird curves, clamping or other funky problems as you adjust settings"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"inputChange\":\n    nsd = nuke.toNode(\"SwitchDefault\")\n    n\[\"defaultBlack\"].setEnabled(nsd\[\"which\"].getValue()==1)\n\nif k.name() == \"previewPlotScan\":\n    p = n.knob(\"previewPlotScan\").value()\n    if p == True:\n        n.knob(\"plotscanSampler\").setVisible(True)\n    else:\n        n.knob(\"plotscanSampler\").setVisible(False)"
tile_color 0x1c1c1cff
note_font "Helvetica Bold"
selected true
xpos -34458
ypos 20224
addUserKnob {20 BlacksMatch}
addUserKnob {6 default_black_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 premultInput l "Premultiplied Input" +STARTLINE}
addUserKnob {4 mergeOp l Operation: t "Plus and Screen do the same thing with our operation, so I only included a hypot between plus/screen and hypot.  Hypot raises the mult by x2 because I thought that gave more pleasising results.  It will probably be a harsher curve (more towards clamp) than the plus/screen result)." M {Plus/Screen Hypot "" ""}}
addUserKnob {18 defaultBlack l "Default Black" +DISABLED}
defaultBlack {0.05 0.05 0.05}
addUserKnob {6 defaultBlack_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 defaultBlack_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {26 ""}
addUserKnob {7 multBase l "Mult Low Range" t "This is the Multiplier for the top of the \"toe\" curve.  It is multiplying the BlackPoint color by this number and setting it as the highest point weird the curve will influence the midtones and the highlights" R 1.5 10}
multBase 4
addUserKnob {7 rolloffGamma l "Rolloff Gamma" t "This controls the bottom of the curve, the falloff to where it is bending toward the \"cut off point\" which is out black color.  A lower value will act more like a clamp and a higher value will act more like a plus." R 0.1 1}
rolloffGamma 0.35
addUserKnob {4 minVal l "Min Value is:" M {"Toe Result" "Clamp Result" "" ""}}
addUserKnob {6 previewPlotScan l "Preview PlotScan" t "Click to overlay a plotscan graph to show you how your black color is influenced by your settings." +STARTLINE}
addUserKnob {12 plotscanSampler l "PlotScan Sampler" +HIDDEN}
plotscanSampler {200 200}
addUserKnob {6 color_rgb_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
addUserKnob {26 ""}
addUserKnob {41 maskChannelMask l mask -STARTLINE T MergeKeymix.maskChannelMask}
addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
addUserKnob {41 mix T MergeKeymix.mix}
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Name: T BlacksMatch}
addUserKnob {26 ver l Version: T v10}
}
BackdropNode {
inputs 0
name BackdropNode1
tile_color 0x556a5000
label "This Creates a \nPer Channel Key\nBased on the Blackpoint"
note_font_size 30
note_font_color 0xffffffff
xpos 991
ypos -77
bdwidth 314
bdheight 421
}
StickyNote {
inputs 0
name StickyNote2
tile_color 0xff
label green
note_font_size 41
note_font_color 0xffffffff
xpos 177
ypos 466
}
StickyNote {
inputs 0
name StickyNote1
tile_color 0xff
label red
note_font_size 41
note_font_color 0xffffffff
xpos 188
ypos 350
}
StickyNote {
inputs 0
name StickyNote3
tile_color 0xff
label blue
note_font_size 41
note_font_color 0xffffffff
xpos 186
ypos 570
}
StickyNote {
inputs 0
name StickyNote4
tile_color 0xff
label "min will be \nblack color"
note_font_size 31
note_font_color 0xffffffff
xpos 143
ypos 733
}
Input {
inputs 0
name Inputimg
xpos 322
ypos -550
}
Dot {
name Dot17
xpos 356
ypos -418
}
set N3a915c00 [stack 0]
AddChannels {
channels rgba
color 1
name AddChannels1
xpos 322
ypos -365
}
Dot {
name Dot5
note_font_size 41
xpos 356
ypos -288
}
set N3a915400 [stack 0]
Grade {
channels rgba
white 0
multiply 0
add {{defaultBlack.r} {defaultBlack.g} {defaultBlack.b} 0}
black_clamp false
name Grade1
label color
xpos 922
ypos -295
}
Input {
inputs 0
name InputBlackColor
xpos 1138
ypos -569
number 1
}
Switch {
inputs 2
which {{"!\[exists parent.input1]"}}
name SwitchDefault
xpos 1138
ypos -291
}
Dot {
name Dot26
label "Black Color"
note_font_size 41
xpos 1172
ypos -212
}
Dot {
name Dot4
note_font_size 41
xpos 1172
ypos -151
}
set N8128fc00 [stack 0]
Dot {
name Dot36
note_font_size 41
xpos 1631
ypos -151
}
set N8128f800 [stack 0]
Dot {
name Dot16
note_font_size 41
xpos 2140
ypos -151
}
set N8128f400 [stack 0]
Crop {
box {{plotscanSampler.x-2} {plotscanSampler.y-2} {plotscanSampler.x+2} {plotscanSampler.x+2}}
reformat true
crop false
name Crop1
xpos 2432
ypos -154
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
addUserKnob {22 cropToBbox_1 l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
Blur {
channels rgb
size 16
name Blur1
label "\[value size]"
xpos 2432
ypos -130
}
Reformat {
format "512 512 0 0 512 512 1 square_512"
name Reformat4
xpos 2432
ypos -92
}
Dot {
name Dot12
note_font_size 41
xpos 2466
ypos -43
}
set N8128e000 [stack 0]
Dot {
name Dot47
note_font_size 41
xpos 2917
ypos -43
}
set N8128dc00 [stack 0]
Dot {
name Dot42
label "Black Color"
note_font_size 41
xpos 2917
ypos 286
}
Dot {
name Dot43
note_font_size 41
xpos 2917
ypos 366
}
set N8128d400 [stack 0]
Dot {
name Dot44
note_font_size 41
xpos 2917
ypos 480
}
set N8128d000 [stack 0]
Dot {
name Dot45
note_font_size 41
xpos 2917
ypos 588
}
set N8128cc00 [stack 0]
Dot {
name Dot31
note_font_size 41
xpos 2917
ypos 656
}
set N8128c800 [stack 0]
push $N8128c800
push $N8128dc00
Dot {
name Dot11
label "Black Color"
note_font_size 41
xpos 3426
ypos -43
}
Multiply {
channels rgb
value 2
name Multiply6
label "mult black color"
xpos 3392
ypos 77
}
Reformat {
inputs 0
format "512 512 0 0 512 512 1 square_512"
pbb true
name Reformat1
xpos 2711
ypos 61
}
Ramp {
p0 {0 0}
p1 {512 0}
name Ramp1
xpos 2711
ypos 93
}
Dot {
name Dot1
note_font_size 41
xpos 2745
ypos 154
}
set N8124ec00 [stack 0]
Dot {
name Dot7
note_font_size 41
xpos 3138
ypos 154
}
set N8124e800 [stack 0]
MergeExpression {
inputs 2
expr0 Br/Ar
expr1 Bg/Ag
expr2 Bb/Ab
name MergeDivide2
xpos 3392
ypos 151
}
Invert {
channels rgb
name Invert5
xpos 3392
ypos 175
}
Clamp {
channels rgb
name Clamp4
xpos 3392
ypos 199
}
Gamma {
channels rgb
value 0.5
name Gamma4
xpos 3392
ypos 223
}
Dot {
name Dot39
xpos 3426
ypos 366
}
set N8124d400 [stack 0]
Dot {
name Dot40
xpos 3426
ypos 480
}
set N8124d000 [stack 0]
Dot {
name Dot41
xpos 3426
ypos 588
}
Shuffle {
red blue
green blue
alpha blue
name Shuffle11
tile_color 0x3fbfff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 3277
ypos 581
}
push $N8128cc00
push $N8124d000
Shuffle {
red green
blue green
alpha green
name Shuffle12
tile_color 0xbf00ff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 3276
ypos 473
}
push $N8128d000
push $N8124d400
Shuffle {
green red
blue red
alpha red
name Shuffle13
tile_color 0xbf0000ff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 3270
ypos 359
}
push $N8128d400
push $N8124e800
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
output {rgba.red -rgba.green -rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge14
label red
xpos 3104
ypos 359
}
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
Bchannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
output {-rgba.red rgba.green -rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge15
label green
xpos 3104
ypos 473
}
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
Bchannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
output {-rgba.red -rgba.green rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge16
label blue
xpos 3104
ypos 581
}
Merge2 {
inputs 2
operation max
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge18
label "Set Min Color\nto Blackpoint"
xpos 3104
ypos 644
}
Dot {
name Dot46
note_font_size 41
xpos 3138
ypos 742
}
Switch {
inputs 2
which {{minVal}}
name SwitchMinColor1
xpos 2883
ypos 739
}
push $N8128e000
Multiply {
channels rgb
value {{multBase}}
name Multiply3
label "mult black color"
xpos 2432
ypos 63
}
Multiply {
channels rgb
value 2
name Multiply4
label "hypot Extra Mult\n"
xpos 2432
ypos 95
disable {{"mergeOp == 1 ? 0 : 1"}}
}
push $N8124ec00
MergeExpression {
inputs 2
expr0 Br/Ar
expr1 Bg/Ag
expr2 Bb/Ab
name MergeDivide1
xpos 2432
ypos 151
}
Invert {
channels rgb
name Invert2
xpos 2432
ypos 175
}
Clamp {
channels rgb
name Clamp2
xpos 2432
ypos 199
}
Gamma {
channels rgb
value {{rolloffGamma}}
name Gamma2
xpos 2432
ypos 223
}
Dot {
name Dot6
xpos 2466
ypos 366
}
set N811f4800 [stack 0]
Dot {
name Dot9
xpos 2466
ypos 480
}
set N811f4400 [stack 0]
Dot {
name Dot10
xpos 2466
ypos 588
}
Shuffle {
red blue
green blue
alpha blue
name Shuffle4
tile_color 0x3fbfff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 2511
ypos 581
}
push $N8128cc00
push $N811f4400
Shuffle {
red green
blue green
alpha green
name Shuffle5
tile_color 0xbf00ff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 2511
ypos 473
}
push $N8128d000
push $N811f4800
Shuffle {
green red
blue red
alpha red
name Shuffle6
tile_color 0xbf0000ff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 2517
ypos 359
}
push $N8128d400
push $N8124ec00
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
output {rgba.red -rgba.green -rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge2
label red
xpos 2711
ypos 359
}
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
Bchannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
output {-rgba.red rgba.green -rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge6
label green
xpos 2711
ypos 473
}
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
Bchannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
output {-rgba.red -rgba.green rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge7
label blue
xpos 2711
ypos 581
}
Merge2 {
inputs 2
operation max
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge8
label "Set Min Color\nto Blackpoint"
xpos 2711
ypos 730
}
Group {
name PlotScanline
tile_color 0x9c0000ff
xpos 2711
ypos 805
addUserKnob {20 Controls}
addUserKnob {4 mode l "Sampling method" M {"Slice Per Pixel (faster)" "Slice Area (slower)" "Full Scanline" "" "" ""}}
mode "Full Scanline"
addUserKnob {6 add2image l "Add to original" +STARTLINE}
addUserKnob {6 Normalize -STARTLINE}
addUserKnob {6 tonemap l "Tone Map (HDRI)" -STARTLINE}
addUserKnob {6 curve l "Plot as curve" +STARTLINE}
curve true
addUserKnob {3 curveFat l "Curve Thickness" -STARTLINE}
addUserKnob {3 sa l "Sample Area" t "Disabled when using pr pixel method."}
sa 1
addUserKnob {7 lift l Lift R -1 1}
addUserKnob {7 scale l Scale R 0 5}
scale 1
addUserKnob {26 ""}
addUserKnob {12 p1 l "Start Point"}
p1 {376 418}
addUserKnob {12 p2 l "End Point" -STARTLINE}
p2 {428.5 425.5}
addUserKnob {26 ""}
addUserKnob {26 "" l "About " T "Plot Scanline v0.4 | theo@euqahuba.com\nUse P1 to select your scanline and/or you start slice."}
}
Input {
inputs 0
name Input1
xpos -480
ypos 62
}
set N56151c00 [stack 0]
Expression {
temp_name0 length
temp_expr0 sqrt(r*r+g*g+b*b)
expr0 r/length
expr1 g/length
expr2 b/length
name Normalize
xpos -480
ypos 108
disable {{1-parent.Normalize i}}
}
Expression {
expr0 r/(r+1)
expr1 g/(g+1)
expr2 b/(b+1)
name tonamap
xpos -480
ypos 134
disable {{1-parent.tonemap i}}
}
set N56151400 [stack 0]
Expression {
temp_name0 rExpr
temp_expr0 "min(max(0,\r\nceil(r(x,parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
temp_name1 gExpr
temp_expr1 "min(max(0,\r\nceil(g(x,parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
temp_name2 bExpr
temp_expr2 "min(max(0,\r\nceil(b(x,parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
expr0 rExpr
expr1 gExpr
expr2 bExpr
expr3 0
name scanline
xpos -302
ypos 193
addUserKnob {20 User}
}
push $N56151400
Expression {
temp_name0 rExpr
temp_expr0 "min(max(0,\r\nceil(r((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y,parent.sa,parent.sa)-((y/height+parent.lift)*parent.scale))),1)"
temp_name1 gExpr
temp_expr1 "min(max(0,\r\nceil(g((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y,parent.sa,parent.sa)-((y/height+parent.lift)*parent.scale))),1)"
temp_name2 bExpr
temp_expr2 "min(max(0,\r\nceil(b((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y,parent.sa,parent.sa)-((y/height+parent.lift)*parent.scale))),1)"
expr0 rExpr
expr1 gExpr
expr2 bExpr
expr3 0
name Expression_highQuality
xpos -515
ypos 197
addUserKnob {20 User}
}
push $N56151400
Expression {
temp_name0 rExpr
temp_expr0 "min(max(0,\r\nceil(r((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
temp_name1 gExpr
temp_expr1 "min(max(0,\r\nceil(g((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
temp_name2 bExpr
temp_expr2 "min(max(0,\r\nceil(b((x/width)*(parent.p2.x-parent.p1.x)+parent.p1.x,(x/width)*(parent.p2.y-parent.p1.y)+parent.p1.y)-((y/height+parent.lift)*parent.scale))),1)"
expr0 rExpr
expr1 gExpr
expr2 bExpr
expr3 0
name perPixel
xpos -419
ypos 201
addUserKnob {20 User}
}
Switch {
inputs 3
which {{parent.mode i}}
name Switch2
xpos -480
ypos 253
}
Matrix {
matrix {
    {0 1 0}
    {1 -4 1}
    {0 1 0}
  }
name Matrix2
xpos -480
ypos 284
disable {{-1+parent.curve i x70 1}}
}
Dilate {
size {{parent.curveFat}}
name Dilate1
xpos -480
ypos 326
disable {{-1+parent.curve.main}}
}
Clamp {
name Clamp1
xpos -480
ypos 383
}
set Na447f400 [stack 0]
push $N56151c00
Dot {
name Dot1
xpos -556
ypos 66
}
Clamp {
maximum 331
name Clamp2
xpos -590
ypos 352
}
Merge2 {
inputs 2
operation plus
bbox intersection
name Merge1
xpos -590
ypos 394
}
Dot {
name Dot2
xpos -556
ypos 433
}
push $Na447f400
Switch {
inputs 2
which {{parent.add2image i}}
name Switch1
xpos -480
ypos 430
}
Output {
name Output1
xpos -480
ypos 470
}
end_group
Dot {
name Dot15
note_font_size 41
xpos 2745
ypos 857
}
set Na447d800 [stack 0]
Shuffle {
red white
green white
blue white
alpha white
name Shuffle7
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 2821
ypos 850
}
BlackOutside {
name BlackOutside1
xpos 2821
ypos 882
}
Dilate {
channels rgba
size -2
name Dilate1
xpos 2821
ypos 910
}
Invert {
name Invert3
xpos 2821
ypos 934
}
push $Na447d800
Merge2 {
inputs 2
name Merge9
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 2711
ypos 938
}
Group {
name BinaryAlpha
tile_color 0x2a2a2aff
label "(\[value an] --> \[value output1])"
note_font Verdana
note_font_color 0xfffff9ff
xpos 2711
ypos 983
addUserKnob {20 BinaryAlpha}
addUserKnob {4 an l Analyze: M {rgb rgba alpha "" "" ""}}
addUserKnob {4 output1 l Output: M {rgba alpha "" "" "" ""}}
output1 alpha
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "Analyzes channel input and creates a binary result 0 or 1 and outputs it into output channel" T BinaryAlpha}
addUserKnob {26 ver l Version: T v03}
}
Input {
inputs 0
name Input
xpos -398
ypos 275
}
Expression {
temp_name0 rgb_an
temp_expr0 "r !=0 || g!=0 || b!=0?1:0"
temp_name1 rgba_an
temp_expr1 "r!=0 || g!=0 || b!=0 || a!=0?1:0"
temp_name2 alpha_an
temp_expr2 a!=0?1:0
expr3 "parent.an == 0 ? rgb_an : parent.an == 1 ? rgba_an : alpha_an"
name Expression
xpos -398
ypos 341
}
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle
label "\[value in]"
xpos -398
ypos 367
disable {{parent.output1}}
}
Output {
name Output1
xpos -398
ypos 456
}
end_group
Reformat {
type "to box"
box_height {{"\[exists parent.input0] ? parent.input.height : root.format.height"}}
resize height
filter impulse
pbb true
name Reformat2
xpos 2711
ypos 1041
}
Reformat {
type "to box"
box_width {{"\[exists parent.input0] ? parent.input.width : root.format.width"}}
box_height {{input.height}}
resize none
filter impulse
black_outside true
pbb true
name Reformat3
xpos 2711
ypos 1081
}
Dilate {
channels rgba
size 1
name Dilate2
xpos 2711
ypos 1121
}
Dot {
name Dot14
note_font_size 41
xpos 2745
ypos 1192
}
Input {
inputs 0
name Inputmask
xpos 864
ypos 878
number 2
}
Dot {
name Dot29
xpos 898
ypos 1015
}
push $N8128f800
Dot {
name Dot33
label "Black Color"
note_font_size 41
xpos 1631
ypos 295
}
Dot {
name Dot37
note_font_size 41
xpos 1631
ypos 360
}
set Na4414800 [stack 0]
Dot {
name Dot34
note_font_size 41
xpos 1631
ypos 474
}
set Na4414400 [stack 0]
Dot {
name Dot35
note_font_size 41
xpos 1631
ypos 582
}
set N18693c00 [stack 0]
Dot {
name Dot13
note_font_size 41
xpos 1631
ypos 674
}
set N18693800 [stack 0]
push $N18693800
push $N8128f400
Multiply {
channels rgb
value 2
name Multiply7
label "mult black color"
xpos 2106
ypos 87
}
push $N3a915400
Unpremult {
name Unpremult1
xpos 322
ypos -16
disable {{"! premultInput"}}
}
Dot {
name Dot18
xpos 356
ypos 145
}
set N18692c00 [stack 0]
Dot {
name Dot22
note_font_size 41
xpos 1028
ypos 145
}
set N18692800 [stack 0]
Dot {
name Dot32
note_font_size 41
xpos 1852
ypos 145
}
set N18692400 [stack 0]
MergeExpression {
inputs 2
expr0 Br/Ar
expr1 Bg/Ag
expr2 Bb/Ab
name MergeDivide3
xpos 2106
ypos 142
}
Invert {
channels rgb
name Invert4
xpos 2106
ypos 166
}
Clamp {
channels rgb
name Clamp3
xpos 2106
ypos 190
}
Gamma {
channels rgb
value 0.51
name Gamma3
xpos 2106
ypos 214
}
Dot {
name Dot24
xpos 2140
ypos 360
}
set N18691000 [stack 0]
Dot {
name Dot25
xpos 2140
ypos 474
}
set N18690c00 [stack 0]
Dot {
name Dot27
xpos 2140
ypos 582
}
Shuffle {
red blue
green blue
alpha blue
name Shuffle8
tile_color 0x3fbfff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 1990
ypos 575
}
push $N18693c00
push $N18690c00
Shuffle {
red green
blue green
alpha green
name Shuffle9
tile_color 0xbf00ff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 1990
ypos 467
}
push $Na4414400
push $N18691000
Shuffle {
green red
blue red
alpha red
name Shuffle10
tile_color 0xbf0000ff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 1984
ypos 353
}
push $Na4414800
push $N18692400
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
output {rgba.red -rgba.green -rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge11
label red
xpos 1818
ypos 353
}
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
Bchannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
output {-rgba.red rgba.green -rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge12
label green
xpos 1818
ypos 467
}
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
Bchannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
output {-rgba.red -rgba.green rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge13
label blue
xpos 1818
ypos 575
}
Merge2 {
inputs 2
operation max
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge17
label "Set Min Color\nto Blackpoint"
xpos 1818
ypos 662
}
Dot {
name Dot38
note_font_size 41
xpos 1852
ypos 760
}
Switch {
inputs 2
which {{minVal}}
name SwitchMinColor
xpos 1597
ypos 757
}
push $N8128fc00
Multiply {
channels rgb
value {{multBase}}
name Multiply1
label "mult black color"
xpos 1138
ypos 52
}
Multiply {
channels rgb
value 2
name Multiply2
label "hypot Extra Mult\n"
xpos 1138
ypos 84
disable {{"mergeOp == 1 ? 0 : 1"}}
}
push $N18692800
MergeExpression {
inputs 2
expr0 Br/Ar
expr1 Bg/Ag
expr2 Bb/Ab
name MergeDivide
xpos 1138
ypos 194
}
Invert {
channels rgb
name Invert1
xpos 1138
ypos 239
}
Clamp {
channels rgb
name Clamp1
xpos 1138
ypos 263
}
Gamma {
channels rgb
value {{rolloffGamma}}
name Gamma1
xpos 1138
ypos 287
}
Dot {
name Dot19
xpos 1172
ypos 364
}
set N1863c400 [stack 0]
Dot {
name Dot20
xpos 1172
ypos 478
}
set Nc268fc00 [stack 0]
Dot {
name Dot21
xpos 1172
ypos 586
}
Shuffle {
red blue
green blue
alpha blue
name Shuffle3
tile_color 0x3fbfff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 1022
ypos 579
}
push $N8128fc00
Dot {
name Dot23
xpos 706
ypos -151
}
Dot {
name Dot8
label "Black Color"
note_font_size 41
xpos 706
ypos 293
}
set Nc268ec00 [stack 0]
Dot {
name Dot2
note_font_size 41
xpos 706
ypos 404
}
set Nc268e800 [stack 0]
Dot {
name Dot3
note_font_size 41
xpos 706
ypos 523
}
push $Nc268fc00
Shuffle {
red green
blue green
alpha green
name Shuffle2
tile_color 0xbf00ff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 1022
ypos 471
}
push $Nc268e800
push $N1863c400
Shuffle {
green red
blue red
alpha red
name Shuffle1
tile_color 0xbf0000ff
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat --> \[value out2]] \}]"
xpos 1016
ypos 357
}
push $Nc268ec00
push $N18692c00
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
Bchannels {rgba.red -rgba.green -rgba.blue -rgba.alpha}
output {rgba.red -rgba.green -rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge3
label red
xpos 322
ypos 357
}
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
Bchannels {-rgba.red rgba.green -rgba.blue -rgba.alpha}
output {-rgba.red rgba.green -rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge4
label green
xpos 322
ypos 471
}
Merge2 {
inputs 2+1
operation {{parent.Settings.mergeOpNum}}
bbox B
Achannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
Bchannels {-rgba.red -rgba.green rgba.blue -rgba.alpha}
output {-rgba.red -rgba.green rgba.blue -rgba.alpha}
maskChannelInput -rgba.red
name Merge5
label blue
xpos 322
ypos 579
}
Merge2 {
inputs 2
operation max
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge1
label "Set Min Color\nto Blackpoint"
xpos 322
ypos 748
}
Premult {
name Premult4
xpos 322
ypos 881
disable {{"! premultInput"}}
}
push $N3a915c00
Dot {
name Dot28
xpos -146
ypos -418
}
Dot {
name Dot30
xpos -146
ypos 1015
}
Merge2 {
inputs 2+1
operation copy
bbox B
Achannels {rgba.red rgba.green rgba.blue -rgba.alpha}
Bchannels {rgba.red rgba.green rgba.blue -rgba.alpha}
output {rgba.red rgba.green rgba.blue -rgba.alpha}
mix 0.8
name MergeKeymix
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 322
ypos 1012
}
Merge2 {
inputs 2
name Merge10
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 322
ypos 1189
disable {{!previewPlotScan}}
}
Output {
name Output1
xpos 322
ypos 1395
}
NoOp {
inputs 0
name Settings
note_font_size 51
xpos 2494
ypos -414
addUserKnob {20 User}
addUserKnob {7 mergeOpNum l "Merge Op Num"}
mergeOpNum {{"mergeOp == 0 ? 24 : 13"}}
}
end_group
Premult {
name Premult7
selected true
xpos -34458
ypos 20668
}
Group {
inputs 2
name LightWrapPro2
help "Adds exponentially blurred lightwrap\n\nAdds a bright highlight wrap and an overall wrap"
tile_color 0x1e252eff
label "(\[value outputView])"
note_font "DejaVu Sans Bold"
note_font_color 0xb7e6ffff
selected true
xpos -34458
ypos 21120
disable true
mapsize {0.15 0.15}
addUserKnob {20 LightWrapPro}
addUserKnob {4 outputView l "Output View" t "Chose one to view while adjusting" M {"Final Output" "Highlight Key" "Highlight Wrap" "OverAll Wrap" "Effect Only" "" "" "" "" "" "" "" "" ""}}
addUserKnob {6 premultiplied l "FG premultiplied" -STARTLINE}
premultiplied true
addUserKnob {26 highlightKeyTitle l "<b><font color = skyblue>HighLight Key"}
addUserKnob {7 blackPt l Black R 0 4}
blackPt 1
addUserKnob {7 whitePt l White R 0 4}
whitePt 2
addUserKnob {26 wrapHighlightsTitle l "<b><font color = skyblue>HighLight Wrap"}
addUserKnob {6 Mult_Flare_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
addUserKnob {41 steps l " Steps" T ExponGlowWrapHighlight.steps}
addUserKnob {41 falloffType l Falloff -STARTLINE T ExponGlowWrapHighlight.falloffType}
addUserKnob {41 size l Size T ExponGlowWrapHighlight.size}
addUserKnob {7 wrapHighlightAmount l Amount R 0 4}
wrapHighlightAmount 1
addUserKnob {26 WrapAllTitle l "<b><font color=skyblue>Overall Wrap "}
addUserKnob {6 WrapAllMult_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
addUserKnob {41 steps_1 l " Steps" T ExponGlowWrapAll.steps}
addUserKnob {41 falloffType_1 l Falloff -STARTLINE T ExponGlowWrapAll.falloffType}
addUserKnob {41 size_1 l Size T ExponGlowWrapAll.size}
addUserKnob {7 wrapAllAmount l Amount R 0 4}
wrapAllAmount 1
addUserKnob {6 removeHighlights l "Dim Highlights" +STARTLINE}
removeHighlights true
addUserKnob {7 dimHighlightsAmount l "" -STARTLINE R 0 3}
dimHighlightsAmount 1
addUserKnob {26 blendEdgesTitle l "<b><font color=skyblue>Blend Edges"}
addUserKnob {7 blendEdgesAmount l Amount}
addUserKnob {6 ColorBleedMult_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
addUserKnob {26 bleedColorTitle l "<b><font color=skyblue>Bleed Color"}
addUserKnob {7 bleedColorAmount l Amount}
addUserKnob {7 bleedColorSize l Size R 0.1 4}
bleedColorSize 1
addUserKnob {7 bleedColorFalloff_2 l Falloff R 0.2 2}
bleedColorFalloff_2 0.5
addUserKnob {26 ""}
addUserKnob {7 globalAmount l "<b><font color=skyblue>Global Amount"}
globalAmount 1
addUserKnob {26 _1 l mask T ""}
addUserKnob {41 maskChannelInput l "" -STARTLINE T MergeCopyLightWrapPro.maskChannelInput}
addUserKnob {41 inject -STARTLINE T MergeCopyLightWrapPro.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T MergeCopyLightWrapPro.invert_mask}
addUserKnob {41 fringe -STARTLINE T MergeCopyLightWrapPro.fringe}
addUserKnob {41 mix T MergeCopyLightWrapPro.mix}
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "\n\n" T LightWrapPro}
addUserKnob {26 ver l Version: T v06}
}
BackdropNode {
inputs 0
name BackdropNode1
tile_color 0x402f27ff
label "Bleed Color"
note_font_size 60
note_font_color 0xffffffff
xpos -683
ypos 2273
bdwidth 1316
bdheight 787
}
BackdropNode {
inputs 0
name BackdropNode2
tile_color 0x39464200
label "highlight key"
note_font_size 40
note_font_color 0xffffffff
xpos 1630
ypos 113
bdwidth 272
bdheight 393
}
Input {
inputs 0
name Inputmask
xpos 1887
ypos 3580
number 2
}
Input {
inputs 0
name FG
xpos -413
ypos -318
}
AddChannels {
channels rgba
name AddChannels1
xpos -413
ypos -150
}
Dot {
name Dot1
xpos -379
ypos 375
}
set Nc2641000 [stack 0]
Dot {
name Dot7
xpos -825
ypos 375
}
Dot {
name Dot46
xpos -825
ypos 3104
}
set Nc2640800 [stack 0]
Dot {
name Dot15
xpos 915
ypos 3107
}
set Nc2640400 [stack 0]
Dot {
name Dot26
note_font_size 41
xpos 915
ypos 3224
}
set N5e277c00 [stack 0]
Dot {
name Dot32
note_font_size 41
xpos 915
ypos 3277
}
push $Nc2641000
Dot {
name Dot8
note_font_size 41
xpos 717
ypos 378
}
set N5e277400 [stack 0]
Dot {
name Dot11
note_font_size 41
xpos 717
ypos 550
}
Input {
inputs 0
name BG
label "\n"
xpos 1702
ypos -276
number 1
}
AddChannels {
channels rgba
name AddChannels2
xpos 1702
ypos -145
}
Remove {
operation keep
channels rgba
name Remove2
xpos 1702
ypos -68
}
Dot {
name Dot3
xpos 1736
ypos 177
}
set N5e276000 [stack 0]
Keyer {
operation "luminance key"
range {{parent.blackPt} {parent.whitePt} {range.B} {range.B}}
name Keyer2
xpos 1702
ypos 303
}
Dot {
name Dot4
note_font_size 41
xpos 1736
ypos 397
}
set N5e275800 [stack 0]
Premult {
name Premult1
xpos 1702
ypos 452
}
Multiply {
inputs 1+1
channels rgba
value 0
name Multiply1
label "\[value value]"
xpos 1702
ypos 543
}
Dot {
name Dot30
note_font_size 41
xpos 1734
ypos 746
}
Group {
name ExponGlowWrapHighlight
onCreate "n = nuke.thisNode()\nn.knob('size').setRange(0, 50)\n#n.knob('exp').setRange(1, 4)\nnuke.thisNode().knob('steps').setFlag(0x02000000)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n\n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n\nelif k.name() == \"steps\":\n\n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        m1    = nuke.toNode(\"Multiply1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n\n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n\n        m1x   = m1.xpos()\n        m1y   = m1.ypos()\n        m1n   = m1.name()\n\n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('exp').getValue()\n\n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, m1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            m = nuke.nodes.Multiply()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression( \"((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(\{\}**2))\".format(str(i+1)), 0 )\n            b\[\"size\"].setExpression( \"((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(\{\}**2))\".format(str(i+1)), 1 )\n            b\[\"label\"].setValue('')\n            blurAbove = b.name()\n\n            m.setXYpos(m1x+i*100,m1y)\n            m.setInput(0, nuke.toNode(blurAbove))\n            m\[\"channels\"].setValue(\"all\")\n            m\[\"value\"].setValue(1,1,1,1)\n            j = 1-(i/steps)\n            m\[\"value\"].setExpression('falloffType == 0 ? \{\} :falloffType == 1 ? pow(\{\}, 3) : falloffType == 2 ? \{\}*\{\}*(3-2*\{\}) : falloffType == 3 ? \{\}*\{\}*(2 - \{\}) : falloffType == 4 ? \{\}*(1 + \{\}*(1 - \{\})) : 0'.format(j,j,j,j,j,j,j,j,j,j,j))\n            m\[\"mix\"].setExpression(\"falloff\")\n            m\[\"label\"].setValue('')\n\n            merge.setInput(i if i<2 else i+1, m)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n\n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n\nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n\n"
tile_color 0xcc804eff
label "(\[value output2])"
note_font "Verdana Bold"
note_font_color 0xffffffff
xpos 1700
ypos 1012
addUserKnob {20 ExponBlurSimple}
addUserKnob {41 channels T Remove1.channels}
addUserKnob {26 ""}
addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
output2 Over
addUserKnob {3 steps l "  Steps" -STARTLINE}
steps 6
addUserKnob {26 text l " " T " "}
addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
AvgMaxOriginal true
addUserKnob {14 size l Size R 0 50}
size 4
addUserKnob {14 exp l Exponent +INVISIBLE R 1 4}
exp 3
addUserKnob {6 color_rgba_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
addUserKnob {7 falloff l Falloff}
falloff 1
addUserKnob {4 falloffType l "Falloff Type" M {Linear pLinear smooth smooth0 smooth1 ""}}
falloffType smooth1
addUserKnob {14 postBlur l "Post Blur" R 0 100}
addUserKnob {26 ""}
addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
addUserKnob {41 mix T MergeKeymix.mix}
addUserKnob {14 safeBBoxPixels l "" +STARTLINE +HIDDEN R 0 400}
safeBBoxPixels 100
addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
adjustBBoxPercent 1
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "Tony Lyons"}
addUserKnob {26 desc l Description: t "Add description and tooltip for gizmo" T ExponBlurSimple}
addUserKnob {26 ver l Version: T v02}
}
Input {
inputs 0
name Inputmask
xpos 346
ypos 596
number 1
}
Dot {
name Dot19
label Mask
note_font_size 41
xpos 380
ypos 662
}
Dot {
name Dot10
note_font_size 41
xpos 380
ypos 899
}
Input {
inputs 0
name Inputimg
xpos -221
ypos -1229
}
Dot {
name Dot16
note_font_size 41
xpos -187
ypos -1062
}
set N5e23b400 [stack 0]
Dot {
name Dot1
note_font_size 41
xpos 461
ypos -1058
}
Remove {
operation keep
channels rgba
name Remove1
xpos 427
ypos -980
}
NoOp {
name aspectCalc
xpos 427
ypos -939
addUserKnob {20 User}
addUserKnob {14 aspect R 0 100}
aspect {{parent.size.w} {parent.size.h/format.pixel_aspect/height*width}}
}
Dot {
name Dot21
note_font_size 41
xpos 461
ypos -853
}
set N5e23a400 [stack 0]
Invert {
name Invert1
xpos 864
ypos -860
disable {{"parent.size < 0 ? 0 : 1"}}
}
set N5e23a000 [stack 0]
Dot {
name Dot4
note_font_size 41
xpos 540
ypos -604
}
NoOp {
name Original
xpos 506
ypos -327
}
Dot {
name Dot5
note_font_size 41
xpos 540
ypos 100
}
push $N5e23a000
NoOp {
name Start
xpos 864
ypos -706
}
set N5e239000 [stack 0]
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(6**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(6**2))}}
crop false
name Blur6
xpos 1364
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.166666666667 :falloffType == 1 ? pow(0.166666666667, 3) : falloffType == 2 ? 0.166666666667*0.166666666667*(3-2*0.166666666667) : falloffType == 3 ? 0.166666666667*0.166666666667*(2 - 0.166666666667) : falloffType == 4 ? 0.166666666667*(1 + 0.166666666667*(1 - 0.166666666667)) : 0"} {"falloffType == 0 ? 0.166666666667 :falloffType == 1 ? pow(0.166666666667, 3) : falloffType == 2 ? 0.166666666667*0.166666666667*(3-2*0.166666666667) : falloffType == 3 ? 0.166666666667*0.166666666667*(2 - 0.166666666667) : falloffType == 4 ? 0.166666666667*(1 + 0.166666666667*(1 - 0.166666666667)) : 0"} {"falloffType == 0 ? 0.166666666667 :falloffType == 1 ? pow(0.166666666667, 3) : falloffType == 2 ? 0.166666666667*0.166666666667*(3-2*0.166666666667) : falloffType == 3 ? 0.166666666667*0.166666666667*(2 - 0.166666666667) : falloffType == 4 ? 0.166666666667*(1 + 0.166666666667*(1 - 0.166666666667)) : 0"} {"falloffType == 0 ? 0.166666666667 :falloffType == 1 ? pow(0.166666666667, 3) : falloffType == 2 ? 0.166666666667*0.166666666667*(3-2*0.166666666667) : falloffType == 3 ? 0.166666666667*0.166666666667*(2 - 0.166666666667) : falloffType == 4 ? 0.166666666667*(1 + 0.166666666667*(1 - 0.166666666667)) : 0"}}
mix {{falloff}}
name Multiply6
xpos 1364
ypos -477
}
push $N5e239000
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(5**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(5**2))}}
crop false
name Blur5
xpos 1264
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.333333333333 :falloffType == 1 ? pow(0.333333333333, 3) : falloffType == 2 ? 0.333333333333*0.333333333333*(3-2*0.333333333333) : falloffType == 3 ? 0.333333333333*0.333333333333*(2 - 0.333333333333) : falloffType == 4 ? 0.333333333333*(1 + 0.333333333333*(1 - 0.333333333333)) : 0"} {"falloffType == 0 ? 0.333333333333 :falloffType == 1 ? pow(0.333333333333, 3) : falloffType == 2 ? 0.333333333333*0.333333333333*(3-2*0.333333333333) : falloffType == 3 ? 0.333333333333*0.333333333333*(2 - 0.333333333333) : falloffType == 4 ? 0.333333333333*(1 + 0.333333333333*(1 - 0.333333333333)) : 0"} {"falloffType == 0 ? 0.333333333333 :falloffType == 1 ? pow(0.333333333333, 3) : falloffType == 2 ? 0.333333333333*0.333333333333*(3-2*0.333333333333) : falloffType == 3 ? 0.333333333333*0.333333333333*(2 - 0.333333333333) : falloffType == 4 ? 0.333333333333*(1 + 0.333333333333*(1 - 0.333333333333)) : 0"} {"falloffType == 0 ? 0.333333333333 :falloffType == 1 ? pow(0.333333333333, 3) : falloffType == 2 ? 0.333333333333*0.333333333333*(3-2*0.333333333333) : falloffType == 3 ? 0.333333333333*0.333333333333*(2 - 0.333333333333) : falloffType == 4 ? 0.333333333333*(1 + 0.333333333333*(1 - 0.333333333333)) : 0"}}
mix {{falloff}}
name Multiply5
xpos 1264
ypos -477
}
push $N5e239000
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(4**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(4**2))}}
crop false
name Blur4
xpos 1164
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"}}
mix {{falloff}}
name Multiply4
xpos 1164
ypos -477
}
push $N5e239000
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(3**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(3**2))}}
crop false
name Blur3
xpos 1064
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.666666666667 :falloffType == 1 ? pow(0.666666666667, 3) : falloffType == 2 ? 0.666666666667*0.666666666667*(3-2*0.666666666667) : falloffType == 3 ? 0.666666666667*0.666666666667*(2 - 0.666666666667) : falloffType == 4 ? 0.666666666667*(1 + 0.666666666667*(1 - 0.666666666667)) : 0"} {"falloffType == 0 ? 0.666666666667 :falloffType == 1 ? pow(0.666666666667, 3) : falloffType == 2 ? 0.666666666667*0.666666666667*(3-2*0.666666666667) : falloffType == 3 ? 0.666666666667*0.666666666667*(2 - 0.666666666667) : falloffType == 4 ? 0.666666666667*(1 + 0.666666666667*(1 - 0.666666666667)) : 0"} {"falloffType == 0 ? 0.666666666667 :falloffType == 1 ? pow(0.666666666667, 3) : falloffType == 2 ? 0.666666666667*0.666666666667*(3-2*0.666666666667) : falloffType == 3 ? 0.666666666667*0.666666666667*(2 - 0.666666666667) : falloffType == 4 ? 0.666666666667*(1 + 0.666666666667*(1 - 0.666666666667)) : 0"} {"falloffType == 0 ? 0.666666666667 :falloffType == 1 ? pow(0.666666666667, 3) : falloffType == 2 ? 0.666666666667*0.666666666667*(3-2*0.666666666667) : falloffType == 3 ? 0.666666666667*0.666666666667*(2 - 0.666666666667) : falloffType == 4 ? 0.666666666667*(1 + 0.666666666667*(1 - 0.666666666667)) : 0"}}
mix {{falloff}}
name Multiply3
xpos 1064
ypos -477
}
push 0
push $N5e239000
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(2**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(2**2))}}
crop false
name Blur2
xpos 964
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.833333333333 :falloffType == 1 ? pow(0.833333333333, 3) : falloffType == 2 ? 0.833333333333*0.833333333333*(3-2*0.833333333333) : falloffType == 3 ? 0.833333333333*0.833333333333*(2 - 0.833333333333) : falloffType == 4 ? 0.833333333333*(1 + 0.833333333333*(1 - 0.833333333333)) : 0"} {"falloffType == 0 ? 0.833333333333 :falloffType == 1 ? pow(0.833333333333, 3) : falloffType == 2 ? 0.833333333333*0.833333333333*(3-2*0.833333333333) : falloffType == 3 ? 0.833333333333*0.833333333333*(2 - 0.833333333333) : falloffType == 4 ? 0.833333333333*(1 + 0.833333333333*(1 - 0.833333333333)) : 0"} {"falloffType == 0 ? 0.833333333333 :falloffType == 1 ? pow(0.833333333333, 3) : falloffType == 2 ? 0.833333333333*0.833333333333*(3-2*0.833333333333) : falloffType == 3 ? 0.833333333333*0.833333333333*(2 - 0.833333333333) : falloffType == 4 ? 0.833333333333*(1 + 0.833333333333*(1 - 0.833333333333)) : 0"} {"falloffType == 0 ? 0.833333333333 :falloffType == 1 ? pow(0.833333333333, 3) : falloffType == 2 ? 0.833333333333*0.833333333333*(3-2*0.833333333333) : falloffType == 3 ? 0.833333333333*0.833333333333*(2 - 0.833333333333) : falloffType == 4 ? 0.833333333333*(1 + 0.833333333333*(1 - 0.833333333333)) : 0"}}
mix {{falloff}}
name Multiply2
xpos 964
ypos -477
}
push $N5e239000
Blur {
size {{(width/100*parent.size*(aspectCalc.aspect.w/100))} {(height/100*parent.size*(aspectCalc.aspect.h/100))}}
crop false
name Blur1
selected true
xpos 864
ypos -554
}
Multiply {
value {1 1 1 1}
mix {{falloff}}
name Multiply1
xpos 864
ypos -477
}
Merge2 {
inputs 6+1
operation {{MergeNumber.mergeNumber}}
also_merge all
name Merge1
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 864
ypos -327
}
NoOp {
name End
xpos 864
ypos -279
}
Grade {
channels all
whitepoint 6
black_clamp false
name AverageMult
xpos 864
ypos 49
disable {{"output2 == 4 ? 0 : 1"}}
}
Merge2 {
inputs 2
operation max
also_merge all
name Merge2
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 864
ypos 96
disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
}
Blur {
size {{postBlur} {postBlur}}
name BlurOriginal
xpos 864
ypos 155
}
Invert {
name Invert2
xpos 864
ypos 283
disable {{"parent.size < 0 ? 0 : 1"}}
}
push $N5e23a400
Switch {
inputs 2
which {{"parent.size == 0 ? 0 : 1"}}
name Switch1
label "\[value which]"
xpos 427
ypos 283
}
Crop {
inputs 0
box {{input.format.x} {input.format.y} {input.format.r} {input.format.t}}
reformat true
crop false
name Crop1
xpos 96
ypos -931
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
AddChannels {
channels rgba
name AddChannels2
xpos 96
ypos -891
}
push $N5e23b400
Merge2 {
inputs 2
name Merge3
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -60
ypos -891
}
set N71533000 [stack 0]
Group {
name BBoxToFormat
onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\nif k.name() == \"overscanType\":\n    if n.knob(\"overscanType\").getValue() == 1:\n        n.knob(\"overscanPercent\").setVisible(True)\n        n.knob(\"overscan\").setVisible(False)\n    else:\n        n.knob(\"overscanPercent\").setVisible(False)\n        n.knob(\"overscan\").setVisible(True)"
tile_color 0xa57aaaff
note_font "Verdana Bold"
note_font_color 0xffffffff
xpos 29
ypos -812
addUserKnob {20 CropBBox}
addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
addUserKnob {41 intersect T Crop6.intersect}
addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
overscanType Percentage
addUserKnob {14 overscan l Overscan +HIDDEN R 0 400}
addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
overscanPercent 1.2
addUserKnob {20 inputBbox l "BBox Data" n 1}
addUserKnob {15 inputFormat l "Input Format"}
inputFormat {0 0 {input.width} {input.height}}
addUserKnob {15 inputBBox l "Input BBox"}
inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
addUserKnob {15 outputBBox l "Output BBox"}
outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
addUserKnob {20 endGroup n -1}
addUserKnob {20 info_1 l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
addUserKnob {26 ver l Version: T v02}
}
Input {
inputs 0
name Input
xpos 261
ypos 394
}
Dot {
name Dot2
note_font_size 41
xpos 295
ypos 462
}
set N71532800 [stack 0]
Dot {
name Dot1
note_font_size 41
xpos -160
ypos 462
}
set N71532400 [stack 0]
push $N71532800
Crop {
box {{curve} {curve} {input.width} {input.height}}
crop {{parent.blackOutside}}
name Crop6
xpos 261
ypos 510
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
set N71532000 [stack 0]
Remove {
operation keep
channels none
name Remove1
xpos 120
ypos 504
}
set N71531c00 [stack 0]
Transform {
scale {{parent.overscanPercent} {parent.overscanPercent}}
center {{input.bbox.r/2} {input.bbox.t/2}}
shutteroffset centred
name Transform1
xpos 120
ypos 555
}
push $N71531c00
AdjBBox {
numpixels {{parent.overscan} {parent.overscan}}
name AdjBBox1
xpos -5
ypos 510
}
Switch {
inputs 2
which {{overscanType}}
name Switch2
label "\[value which]"
xpos -5
ypos 549
}
Merge2 {
inputs 2
bbox intersection
Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
name Merge1
xpos -5
ypos 647
disable {{!parent.Crop6.intersect}}
}
push $N71532400
CopyBBox {
inputs 2
name CopyBBox1
xpos -194
ypos 653
}
BlackOutside {
name BlackOutside1
xpos -194
ypos 692
disable {{!parent.blackOutside}}
}
Dot {
name Dot4
note_font_size 41
xpos -160
ypos 769
}
push $N71532000
Switch {
inputs 2
which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
name Switch1
label "\[value which]"
xpos 261
ypos 759
}
set Ncb5ab800 [stack 0]
Output {
name Output1
xpos 261
ypos 921
}
push $Ncb5ab800
NoOp {
name OutputBBox1
selected true
xpos 378
ypos 821
addUserKnob {20 User}
addUserKnob {15 OutputBBox l "Output BBox"}
OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
}
end_group
push $N71533000
Merge2 {
inputs 2
name Merge4
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -60
ypos -748
}
push $N5e23b400
CopyBBox {
inputs 2
name CopyBBox1
xpos -221
ypos -748
}
Dot {
name Dot22
note_font_size 41
xpos -187
ypos 198
}
Merge2 {
inputs 2
operation copy
bbox B
Achannels none
Bchannels none
output none
also_merge {{{parent.Remove1.channels}}}
name Merge5
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -221
ypos 283
}
Dot {
name Dot17
label A
note_font_size 41
xpos -187
ypos 675
}
Dot {
name Dot7
note_font_size 41
xpos -187
ypos 805
}
push $N5e23b400
Dot {
name Dot2
note_font_size 41
xpos -588
ypos -1062
}
Dot {
name Dot18
label B
note_font_size 41
xpos -588
ypos 654
}
Dot {
name Dot3
note_font_size 41
xpos -588
ypos 895
}
Merge2 {
inputs 2+1
operation copy
Achannels none
Bchannels none
output none
also_merge all
name MergeKeymix
xpos -221
ypos 888
}
Output {
name Output1
xpos -221
ypos 1202
}
NoOp {
inputs 0
name MergeNumber
xpos 202
ypos -1145
addUserKnob {20 User}
addUserKnob {3 mergeNumber}
mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
}
end_group
Grade {
channels all
white {{wrapHighlightAmount/10}}
name FlareAmount
xpos 1702
ypos 1393
}
Multiply {
channels rgba
value {{globalAmount}}
name MultiplyGlobal3
label "\[value value]"
xpos 1702
ypos 1577
}
Dot {
name Dot25
label "LIGHT FLARE"
note_font_size 61
xpos 1736
ypos 1801
}
set Ncb563000 [stack 0]
Dot {
name Dot31
note_font_size 41
xpos 1738
ypos 2915
}
set Ncb562c00 [stack 0]
push $N5e277400
push $N5e276000
Dot {
name Dot20
xpos 1059
ypos 179
}
Shuffle {
alpha white
name Shuffle1
label "\[value in] \[ expr \{ \[value out2] == \"none\" ? \" \" : \[concat -> \[value out2]] \}]"
note_font_size 21
note_font_color 0xffffffff
xpos 1025
ypos 238
}
Multiply {
inputs 1+1
channels rgba
value 0
name Multiply2
label "\[value value]"
xpos 1025
ypos 366
}
Dot {
name Dot9
xpos 1059
ypos 725
}
set Ncb561c00 [stack 0]
Dot {
name Dot28
note_font_size 41
xpos 1343
ypos 725
}
Keyer {
operation "luminance key"
name Keyer1
xpos 1309
ypos 823
}
push $Ncb561c00
Colorspace {
colorspace_out CIE-Yxy
name Colorspace4
xpos 1188
ypos 786
}
Expression {
inputs 1+1
expr0 "(r*(1+(r/((parent.dimHighlightsAmount+1)**2))) ) / (1+r)"
channel1 {-rgba.red -rgba.green -rgba.blue none}
expr1 "(g*(1+(g/((parent.dimHighlightsAmount+1)**2))) ) / (1+g)"
channel2 {-rgba.red -rgba.green -rgba.blue none}
expr2 "(b*(1+(b/((parent.dimHighlightsAmount+1)**2))) ) / (1+b)"
expr3 a
name Tonemap_whitepoint
xpos 1188
ypos 827
}
Colorspace {
colorspace_in CIE-Yxy
name Colorspace3
xpos 1188
ypos 867
}
push $Ncb561c00
Switch {
inputs 2
which {{removeHighlights}}
name Switch4
xpos 1025
ypos 867
}
Group {
name ExponGlowWrapAll
onCreate "n = nuke.thisNode()\nn.knob('size').setRange(0, 50)\n#n.knob('exp').setRange(1, 4)\nnuke.thisNode().knob('steps').setFlag(0x02000000)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == \"includeOriginal\":\n    if n.knob('includeOriginal').getValue() == 1:\n        merge = nuke.toNode(\"Merge1\")\n        original = nuke.toNode('Original')\n        AvgMult = nuke.toNode(\"AverageMult\")\n        steps = int(n.knob('steps').getValue())\n        merge.setInput(steps+1, original)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n\n    else:\n        merge.setInput(steps+1, None)\n        AvgMult\['whitepoint'].setValue(2 if steps<2 else steps)\n\nelif k.name() == \"steps\":\n\n    s = int(k.value())\n    if s<1:\n        k.setValue(1)\n    else:\n        start = nuke.toNode(\"Start\")\n        end   = nuke.toNode(\"End\")\n        b1    = nuke.toNode(\"Blur1\")\n        m1    = nuke.toNode(\"Multiply1\")\n        merge = nuke.toNode(\"Merge1\")\n        AvgMult = nuke.toNode(\"AverageMult\")\n\n        b1x   = b1.xpos()\n        b1y   = b1.ypos()\n        b1n   = b1.name()\n\n        m1x   = m1.xpos()\n        m1y   = m1.ypos()\n        m1n   = m1.name()\n\n        steps = int(n.knob('steps').getValue())\n        size  = n.knob('size').getValue()\n        mult  = n.knob('exp').getValue()\n\n        #b1.setInput(0, start)\n        for i in range(1,merge.inputs()):\n            merge.setInput(i,None)\n        merge.setInput(0, m1)\n        \[nuke.delete(i) for i in nuke.allNodes() if i.xpos()>start.xpos()]\n        for i in range(1,steps):\n            # Blur\n            b = nuke.nodes.Blur()\n            m = nuke.nodes.Multiply()\n            b.setXYpos(b1x+i*100,b1y)\n            b.setInput(0,start)\n            b\[\"channels\"].setValue(\"all\")\n            b\[\"crop\"].setValue(0)\n            b\[\"size\"].setValue(0, 1)\n            b\[\"size\"].setExpression( \"((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(\{\}**2))\".format(str(i+1)), 0 )\n            b\[\"size\"].setExpression( \"((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(\{\}**2))\".format(str(i+1)), 1 )\n            b\[\"label\"].setValue('')\n            blurAbove = b.name()\n\n            m.setXYpos(m1x+i*100,m1y)\n            m.setInput(0, nuke.toNode(blurAbove))\n            m\[\"channels\"].setValue(\"all\")\n            m\[\"value\"].setValue(1,1,1,1)\n            j = 1-(i/steps)\n            m\[\"value\"].setExpression('falloffType == 0 ? \{\} :falloffType == 1 ? pow(\{\}, 3) : falloffType == 2 ? \{\}*\{\}*(3-2*\{\}) : falloffType == 3 ? \{\}*\{\}*(2 - \{\}) : falloffType == 4 ? \{\}*(1 + \{\}*(1 - \{\})) : 0'.format(j,j,j,j,j,j,j,j,j,j,j))\n            m\[\"mix\"].setExpression(\"falloff\")\n            m\[\"label\"].setValue('')\n\n            merge.setInput(i if i<2 else i+1, m)\n            AvgMult\['whitepoint'].setValue(i if i<2 else i+1)\n\n        if n.knob('includeOriginal').getValue() == 1:\n            merge = nuke.toNode(\"Merge1\")\n            original = nuke.toNode('Original')\n            AvgMult = nuke.toNode(\"AverageMult\")\n            steps = int(n.knob('steps').getValue())\n            merge.setInput(steps+1, original)\n            AvgMult\['whitepoint'].setValue(2 if steps<2 else steps+1)\n\nelif k.name() == \"output2\":\n    if n.knob(\"output2\").getValue() == 4:\n        n.knob('AvgMaxOriginal').setVisible(True)\n    else:\n        n.knob('AvgMaxOriginal').setVisible(False)\n\n"
tile_color 0xcc804eff
label "(\[value output2])"
note_font "Verdana Bold"
note_font_color 0xffffffff
xpos 1025
ypos 995
addUserKnob {20 ExponBlurSimple}
addUserKnob {41 channels T Remove1.channels}
addUserKnob {26 ""}
addUserKnob {4 output2 l Operation: M {Screen Plus Over Hypot Average Max Min "" "" "" "" ""}}
output2 Over
addUserKnob {3 steps l "  Steps" -STARTLINE}
steps 8
addUserKnob {26 text l " " T " "}
addUserKnob {6 includeOriginal l "Include Original?" -STARTLINE}
addUserKnob {6 AvgMaxOriginal l "Use Max of Average and Original" +HIDDEN +STARTLINE}
AvgMaxOriginal true
addUserKnob {14 size l Size R 0 50}
size 10
addUserKnob {14 exp l Exponent +INVISIBLE R 1 4}
exp 3
addUserKnob {6 color_rgba_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
addUserKnob {7 falloff l Falloff}
falloff 1
addUserKnob {4 falloffType l "Falloff Type" M {Linear pLinear smooth smooth0 smooth1 ""}}
falloffType pLinear
addUserKnob {14 postBlur l "Post Blur" R 0 100}
addUserKnob {26 ""}
addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
addUserKnob {41 mix T MergeKeymix.mix}
addUserKnob {14 safeBBoxPixels l "" +STARTLINE +HIDDEN R 0 400}
safeBBoxPixels 100
addUserKnob {14 adjustBBoxPercent l "" -STARTLINE +HIDDEN R 1 2}
adjustBBoxPercent 1
addUserKnob {20 info l Info}
addUserKnob {26 creator l Creator: T "Tony Lyons"}
addUserKnob {26 desc l Description: t "Add description and tooltip for gizmo" T ExponBlurSimple}
addUserKnob {26 ver l Version: T v02}
}
Input {
inputs 0
name Inputmask
xpos 346
ypos 596
number 1
}
Dot {
name Dot19
label Mask
note_font_size 41
xpos 380
ypos 662
}
Dot {
name Dot10
note_font_size 41
xpos 380
ypos 899
}
Input {
inputs 0
name Inputimg
xpos -221
ypos -1229
}
Dot {
name Dot16
note_font_size 41
xpos -187
ypos -1062
}
set Ncb502c00 [stack 0]
Dot {
name Dot1
note_font_size 41
xpos 461
ypos -1058
}
Remove {
operation keep
channels rgba
name Remove1
xpos 427
ypos -980
}
NoOp {
name aspectCalc
xpos 427
ypos -939
addUserKnob {20 User}
addUserKnob {14 aspect R 0 100}
aspect {{parent.size.w} {parent.size.h/format.pixel_aspect/height*width}}
}
Dot {
name Dot21
note_font_size 41
xpos 461
ypos -853
}
set Ncb501c00 [stack 0]
Invert {
name Invert1
xpos 864
ypos -860
disable {{"parent.size < 0 ? 0 : 1"}}
}
set Ncb501800 [stack 0]
Dot {
name Dot4
note_font_size 41
xpos 540
ypos -604
}
NoOp {
name Original
xpos 506
ypos -327
}
Dot {
name Dot5
note_font_size 41
xpos 540
ypos 100
}
push $Ncb501800
NoOp {
name Start
xpos 864
ypos -706
}
set Ncb500800 [stack 0]
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(8**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(8**2))}}
crop false
name Blur8
xpos 1564
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.125 :falloffType == 1 ? pow(0.125, 3) : falloffType == 2 ? 0.125*0.125*(3-2*0.125) : falloffType == 3 ? 0.125*0.125*(2 - 0.125) : falloffType == 4 ? 0.125*(1 + 0.125*(1 - 0.125)) : 0"} {"falloffType == 0 ? 0.125 :falloffType == 1 ? pow(0.125, 3) : falloffType == 2 ? 0.125*0.125*(3-2*0.125) : falloffType == 3 ? 0.125*0.125*(2 - 0.125) : falloffType == 4 ? 0.125*(1 + 0.125*(1 - 0.125)) : 0"} {"falloffType == 0 ? 0.125 :falloffType == 1 ? pow(0.125, 3) : falloffType == 2 ? 0.125*0.125*(3-2*0.125) : falloffType == 3 ? 0.125*0.125*(2 - 0.125) : falloffType == 4 ? 0.125*(1 + 0.125*(1 - 0.125)) : 0"} {"falloffType == 0 ? 0.125 :falloffType == 1 ? pow(0.125, 3) : falloffType == 2 ? 0.125*0.125*(3-2*0.125) : falloffType == 3 ? 0.125*0.125*(2 - 0.125) : falloffType == 4 ? 0.125*(1 + 0.125*(1 - 0.125)) : 0"}}
mix {{falloff}}
name Multiply8
xpos 1564
ypos -477
}
push $Ncb500800
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(7**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(7**2))}}
crop false
name Blur7
xpos 1464
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.25 :falloffType == 1 ? pow(0.25, 3) : falloffType == 2 ? 0.25*0.25*(3-2*0.25) : falloffType == 3 ? 0.25*0.25*(2 - 0.25) : falloffType == 4 ? 0.25*(1 + 0.25*(1 - 0.25)) : 0"} {"falloffType == 0 ? 0.25 :falloffType == 1 ? pow(0.25, 3) : falloffType == 2 ? 0.25*0.25*(3-2*0.25) : falloffType == 3 ? 0.25*0.25*(2 - 0.25) : falloffType == 4 ? 0.25*(1 + 0.25*(1 - 0.25)) : 0"} {"falloffType == 0 ? 0.25 :falloffType == 1 ? pow(0.25, 3) : falloffType == 2 ? 0.25*0.25*(3-2*0.25) : falloffType == 3 ? 0.25*0.25*(2 - 0.25) : falloffType == 4 ? 0.25*(1 + 0.25*(1 - 0.25)) : 0"} {"falloffType == 0 ? 0.25 :falloffType == 1 ? pow(0.25, 3) : falloffType == 2 ? 0.25*0.25*(3-2*0.25) : falloffType == 3 ? 0.25*0.25*(2 - 0.25) : falloffType == 4 ? 0.25*(1 + 0.25*(1 - 0.25)) : 0"}}
mix {{falloff}}
name Multiply7
xpos 1464
ypos -477
}
push $Ncb500800
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(6**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(6**2))}}
crop false
name Blur6
xpos 1364
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.375 :falloffType == 1 ? pow(0.375, 3) : falloffType == 2 ? 0.375*0.375*(3-2*0.375) : falloffType == 3 ? 0.375*0.375*(2 - 0.375) : falloffType == 4 ? 0.375*(1 + 0.375*(1 - 0.375)) : 0"} {"falloffType == 0 ? 0.375 :falloffType == 1 ? pow(0.375, 3) : falloffType == 2 ? 0.375*0.375*(3-2*0.375) : falloffType == 3 ? 0.375*0.375*(2 - 0.375) : falloffType == 4 ? 0.375*(1 + 0.375*(1 - 0.375)) : 0"} {"falloffType == 0 ? 0.375 :falloffType == 1 ? pow(0.375, 3) : falloffType == 2 ? 0.375*0.375*(3-2*0.375) : falloffType == 3 ? 0.375*0.375*(2 - 0.375) : falloffType == 4 ? 0.375*(1 + 0.375*(1 - 0.375)) : 0"} {"falloffType == 0 ? 0.375 :falloffType == 1 ? pow(0.375, 3) : falloffType == 2 ? 0.375*0.375*(3-2*0.375) : falloffType == 3 ? 0.375*0.375*(2 - 0.375) : falloffType == 4 ? 0.375*(1 + 0.375*(1 - 0.375)) : 0"}}
mix {{falloff}}
name Multiply6
xpos 1364
ypos -477
}
push $Ncb500800
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(5**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(5**2))}}
crop false
name Blur5
xpos 1264
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"} {"falloffType == 0 ? 0.5 :falloffType == 1 ? pow(0.5, 3) : falloffType == 2 ? 0.5*0.5*(3-2*0.5) : falloffType == 3 ? 0.5*0.5*(2 - 0.5) : falloffType == 4 ? 0.5*(1 + 0.5*(1 - 0.5)) : 0"}}
mix {{falloff}}
name Multiply5
xpos 1264
ypos -477
}
push $Ncb500800
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(4**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(4**2))}}
crop false
name Blur4
xpos 1164
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.625 :falloffType == 1 ? pow(0.625, 3) : falloffType == 2 ? 0.625*0.625*(3-2*0.625) : falloffType == 3 ? 0.625*0.625*(2 - 0.625) : falloffType == 4 ? 0.625*(1 + 0.625*(1 - 0.625)) : 0"} {"falloffType == 0 ? 0.625 :falloffType == 1 ? pow(0.625, 3) : falloffType == 2 ? 0.625*0.625*(3-2*0.625) : falloffType == 3 ? 0.625*0.625*(2 - 0.625) : falloffType == 4 ? 0.625*(1 + 0.625*(1 - 0.625)) : 0"} {"falloffType == 0 ? 0.625 :falloffType == 1 ? pow(0.625, 3) : falloffType == 2 ? 0.625*0.625*(3-2*0.625) : falloffType == 3 ? 0.625*0.625*(2 - 0.625) : falloffType == 4 ? 0.625*(1 + 0.625*(1 - 0.625)) : 0"} {"falloffType == 0 ? 0.625 :falloffType == 1 ? pow(0.625, 3) : falloffType == 2 ? 0.625*0.625*(3-2*0.625) : falloffType == 3 ? 0.625*0.625*(2 - 0.625) : falloffType == 4 ? 0.625*(1 + 0.625*(1 - 0.625)) : 0"}}
mix {{falloff}}
name Multiply4
xpos 1164
ypos -477
}
push $Ncb500800
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(3**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(3**2))}}
crop false
name Blur3
xpos 1064
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.75 :falloffType == 1 ? pow(0.75, 3) : falloffType == 2 ? 0.75*0.75*(3-2*0.75) : falloffType == 3 ? 0.75*0.75*(2 - 0.75) : falloffType == 4 ? 0.75*(1 + 0.75*(1 - 0.75)) : 0"} {"falloffType == 0 ? 0.75 :falloffType == 1 ? pow(0.75, 3) : falloffType == 2 ? 0.75*0.75*(3-2*0.75) : falloffType == 3 ? 0.75*0.75*(2 - 0.75) : falloffType == 4 ? 0.75*(1 + 0.75*(1 - 0.75)) : 0"} {"falloffType == 0 ? 0.75 :falloffType == 1 ? pow(0.75, 3) : falloffType == 2 ? 0.75*0.75*(3-2*0.75) : falloffType == 3 ? 0.75*0.75*(2 - 0.75) : falloffType == 4 ? 0.75*(1 + 0.75*(1 - 0.75)) : 0"} {"falloffType == 0 ? 0.75 :falloffType == 1 ? pow(0.75, 3) : falloffType == 2 ? 0.75*0.75*(3-2*0.75) : falloffType == 3 ? 0.75*0.75*(2 - 0.75) : falloffType == 4 ? 0.75*(1 + 0.75*(1 - 0.75)) : 0"}}
mix {{falloff}}
name Multiply3
xpos 1064
ypos -477
}
push 0
push $Ncb500800
Blur {
size {{((width/100*parent.size.w)*(aspectCalc.aspect.w/100)*(2**2))} {((height/100*parent.size.h)*(aspectCalc.aspect.h/100)*(2**2))}}
crop false
name Blur2
xpos 964
ypos -554
}
Multiply {
value {{"falloffType == 0 ? 0.875 :falloffType == 1 ? pow(0.875, 3) : falloffType == 2 ? 0.875*0.875*(3-2*0.875) : falloffType == 3 ? 0.875*0.875*(2 - 0.875) : falloffType == 4 ? 0.875*(1 + 0.875*(1 - 0.875)) : 0"} {"falloffType == 0 ? 0.875 :falloffType == 1 ? pow(0.875, 3) : falloffType == 2 ? 0.875*0.875*(3-2*0.875) : falloffType == 3 ? 0.875*0.875*(2 - 0.875) : falloffType == 4 ? 0.875*(1 + 0.875*(1 - 0.875)) : 0"} {"falloffType == 0 ? 0.875 :falloffType == 1 ? pow(0.875, 3) : falloffType == 2 ? 0.875*0.875*(3-2*0.875) : falloffType == 3 ? 0.875*0.875*(2 - 0.875) : falloffType == 4 ? 0.875*(1 + 0.875*(1 - 0.875)) : 0"} {"falloffType == 0 ? 0.875 :falloffType == 1 ? pow(0.875, 3) : falloffType == 2 ? 0.875*0.875*(3-2*0.875) : falloffType == 3 ? 0.875*0.875*(2 - 0.875) : falloffType == 4 ? 0.875*(1 + 0.875*(1 - 0.875)) : 0"}}
mix {{falloff}}
name Multiply2
xpos 964
ypos -477
}
push $Ncb500800
Blur {
size {{(width/100*parent.size*(aspectCalc.aspect.w/100))} {(height/100*parent.size*(aspectCalc.aspect.h/100))}}
crop false
name Blur1
xpos 864
ypos -554
}
Multiply {
value {1 1 1 1}
mix {{falloff}}
name Multiply1
xpos 864
ypos -477
}
Merge2 {
inputs 8+1
operation {{MergeNumber.mergeNumber}}
also_merge all
name Merge1
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 864
ypos -327
}
NoOp {
name End
xpos 864
ypos -279
}
Grade {
channels all
whitepoint 8
black_clamp false
name AverageMult
xpos 864
ypos 49
disable {{"output2 == 4 ? 0 : 1"}}
}
Merge2 {
inputs 2
operation max
also_merge all
name Merge2
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 864
ypos 96
disable {{"output2 == 4 && includeOriginal == 1 && AvgMaxOriginal == 1 ? 0 : 1"}}
}
Blur {
size {{postBlur} {postBlur}}
name BlurOriginal
xpos 864
ypos 155
}
Invert {
name Invert2
xpos 864
ypos 283
disable {{"parent.size < 0 ? 0 : 1"}}
}
push $Ncb501c00
Switch {
inputs 2
which {{"parent.size == 0 ? 0 : 1"}}
name Switch1
label "\[value which]"
xpos 427
ypos 283
}
Crop {
inputs 0
box {{input.format.x} {input.format.y} {input.format.r} {input.format.t}}
reformat true
crop false
name Crop1
xpos 96
ypos -931
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
AddChannels {
channels rgba
name AddChannels2
xpos 96
ypos -891
}
push $Ncb502c00
Merge2 {
inputs 2
name Merge3
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -60
ypos -891
}
set Nf39b5800 [stack 0]
Group {
name BBoxToFormat
onCreate "n = nuke.thisNode()\ninputFormat = n.knob(\"inputFormat\")\ninputBBox = n.knob(\"inputBBox\")\ncrop = nuke.toNode(\"Crop6\")\ncropb = crop.knob('box')\noutputBBox = n.knob('outputBBox')\noutputBBoxCenter = n.knob(\"outputBBoxCenter\")\n\ninputFormat.setFlag(0x0000000000008000)\ninputBBox.setFlag(0x0000000000008000)\ncropb.setFlag(0x0000000000008000)\noutputBBox.setFlag(0x0000000000008000)\noutputBBoxCenter.setFlag(0x0000000000008000)\n\nn = nuke.thisNode()\nn.knob(\"overscan\").setRange(0,400)\nn.knob(\"overscanPercent\").setRange(1,4)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\nif k.name() == \"overscanType\":\n    if n.knob(\"overscanType\").getValue() == 1:\n        n.knob(\"overscanPercent\").setVisible(True)\n        n.knob(\"overscan\").setVisible(False)\n    else:\n        n.knob(\"overscanPercent\").setVisible(False)\n        n.knob(\"overscan\").setVisible(True)"
tile_color 0xa57aaaff
note_font "Verdana Bold"
note_font_color 0xffffffff
xpos 29
ypos -812
addUserKnob {20 CropBBox}
addUserKnob {4 type l Type +INVISIBLE M {"To Format" "To BBox"}}
addUserKnob {41 intersect T Crop6.intersect}
addUserKnob {6 blackOutside l "Black Outside" -STARTLINE}
addUserKnob {4 overscanType l "Overscan Type:" M {Pixels Percentage}}
overscanType Percentage
addUserKnob {14 overscan l Overscan +HIDDEN R 0 400}
addUserKnob {14 overscanPercent l "Overscan Percent" R 1 4}
overscanPercent 1.2
addUserKnob {20 inputBbox l "BBox Data" n 1}
addUserKnob {15 inputFormat l "Input Format"}
inputFormat {0 0 {input.width} {input.height}}
addUserKnob {15 inputBBox l "Input BBox"}
inputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {12 outputBBoxCenter l OutputBBoxCenter}
outputBBoxCenter {{OutputBBox1.outputBBoxCenter.w} {OutputBBox1.outputBBoxCenter.h}}
addUserKnob {15 outputBBox l "Output BBox"}
outputBBox {{OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox} {OutputBBox1.OutputBBox}}
addUserKnob {20 endGroup n -1}
addUserKnob {20 info_1 l Info}
addUserKnob {26 creator l Creator: T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "crop to inputformat\n\ndisplays values of input bbox" T CropBBox}
addUserKnob {26 ver l Version: T v02}
}
Input {
inputs 0
name Input
xpos 261
ypos 394
}
Dot {
name Dot2
note_font_size 41
xpos 295
ypos 462
}
set Nf39b5000 [stack 0]
Dot {
name Dot1
note_font_size 41
xpos -160
ypos 462
}
set Nf39b4c00 [stack 0]
push $Nf39b5000
Crop {
box {{curve} {curve} {input.width} {input.height}}
crop {{parent.blackOutside}}
name Crop6
xpos 261
ypos 510
addUserKnob {20 User}
addUserKnob {22 cropToBbox l "Crop to Bounding Box" -STARTLINE T codeBBox()}
}
set Nf39b4800 [stack 0]
Remove {
operation keep
channels none
name Remove1
xpos 120
ypos 504
}
set Nf39b4400 [stack 0]
Transform {
scale {{parent.overscanPercent} {parent.overscanPercent}}
center {{input.bbox.r/2} {input.bbox.t/2}}
shutteroffset centred
name Transform1
xpos 120
ypos 555
}
push $Nf39b4400
AdjBBox {
numpixels {{parent.overscan} {parent.overscan}}
name AdjBBox1
xpos -5
ypos 510
}
Switch {
inputs 2
which {{overscanType}}
name Switch2
label "\[value which]"
xpos -5
ypos 549
}
Merge2 {
inputs 2
bbox intersection
Achannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
Bchannels {-rgba.red -rgba.green -rgba.blue rgba.alpha}
output {-rgba.red -rgba.green -rgba.blue rgba.alpha}
name Merge1
xpos -5
ypos 647
disable {{!parent.Crop6.intersect}}
}
push $Nf39b4c00
CopyBBox {
inputs 2
name CopyBBox1
xpos -194
ypos 653
}
BlackOutside {
name BlackOutside1
xpos -194
ypos 692
disable {{!parent.blackOutside}}
}
Dot {
name Dot4
note_font_size 41
xpos -160
ypos 769
}
push $Nf39b4800
Switch {
inputs 2
which {{"overscanType == 0 ? overscan.w != 0 || overscan.h != 0 : overscanPercent.w != 1 || overscanPercent.h != 1 ? 1 : 0"}}
name Switch1
label "\[value which]"
xpos 261
ypos 759
}
set Nd051a000 [stack 0]
Output {
name Output1
xpos 261
ypos 921
}
push $Nd051a000
NoOp {
name OutputBBox1
selected true
xpos 378
ypos 821
addUserKnob {20 User}
addUserKnob {15 OutputBBox l "Output BBox"}
OutputBBox {{input.bbox.x} {input.bbox.y} {input.bbox.r} {input.bbox.t}}
addUserKnob {14 outputBBoxCenter l "Output BBox Center" R 0 100}
outputBBoxCenter {{OutputBBox.x+(OutputBBox.r-OutputBBox.x)/2} {OutputBBox.y+(OutputBBox.t-OutputBBox.y)/2}}
}
end_group
push $Nf39b5800
Merge2 {
inputs 2
name Merge4
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -60
ypos -748
}
push $Ncb502c00
CopyBBox {
inputs 2
name CopyBBox1
xpos -221
ypos -748
}
Dot {
name Dot22
note_font_size 41
xpos -187
ypos 198
}
Merge2 {
inputs 2
operation copy
bbox B
Achannels none
Bchannels none
output none
also_merge {{{parent.Remove1.channels}}}
name Merge5
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -221
ypos 283
}
Dot {
name Dot17
label A
note_font_size 41
xpos -187
ypos 675
}
Dot {
name Dot7
note_font_size 41
xpos -187
ypos 805
}
push $Ncb502c00
Dot {
name Dot2
note_font_size 41
xpos -588
ypos -1062
}
Dot {
name Dot18
label B
note_font_size 41
xpos -588
ypos 654
}
Dot {
name Dot3
note_font_size 41
xpos -588
ypos 895
}
Merge2 {
inputs 2+1
operation copy
Achannels none
Bchannels none
output none
also_merge all
name MergeKeymix
xpos -221
ypos 888
}
Output {
name Output1
xpos -221
ypos 1202
}
NoOp {
inputs 0
name MergeNumber
xpos 202
ypos -1145
addUserKnob {20 User}
addUserKnob {3 mergeNumber}
mergeNumber {{"output2 == 0 ? 25 : output2 == 1 ? 24 : output2 == 2 ? 22 : output2 == 3 ? 13 : output2 == 4 ? 24 : output2 == 5 ? 17 : 18"}}
}
end_group
Dot {
name Dot40
note_font_size 41
xpos 1059
ypos 1277
}
set Nd04c6000 [stack 0]
Grade {
channels all
white {{wrapAllAmount/10}}
name GradeBgWrapAmount
xpos 1025
ypos 1399
}
Multiply {
channels rgba
value {{globalAmount}}
name MultiplyGlobal1
label "\[value value]"
xpos 1025
ypos 1566
}
Dot {
name Dot37
label "WRAP ALL"
note_font_size 61
xpos 1059
ypos 1692
}
set Nd04c5400 [stack 0]
Dot {
name Dot27
note_font_size 41
xpos 1059
ypos 3062
}
set Nd04c5000 [stack 0]
Merge2 {
inputs 2
name Merge1
xpos 1530
ypos 3168
}
Shuffle {
alpha white
name Shuffle5
tile_color 0xffffffff
note_font_color 0xffffffff
xpos 1530
ypos 3216
}
Merge2 {
inputs 2
operation mask
name Merge14
xpos 1530
ypos 3274
}
push $N5e277c00
push $Nd04c5000
Shuffle {
alpha white
name Shuffle2
tile_color 0xffffffff
note_font_color 0xffffffff
xpos 1025
ypos 3158
}
Merge2 {
inputs 2
operation mask
name Merge7
xpos 1025
ypos 3221
}
push $Nc2640400
push $Ncb562c00
Shuffle {
alpha white
name Shuffle4
tile_color 0xffffffff
note_font_color 0xffffffff
xpos 1708
ypos 3020
}
Merge2 {
inputs 2
operation mask
name Merge13
xpos 1708
ypos 3104
}
push $N5e275800
Dot {
name Dot21
xpos 2349
ypos 397
}
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle3
tile_color 0xffffffff
label alpha
note_font_size 21
note_font_color 0xffffffff
xpos 2315
ypos 496
}
Dot {
name Dot23
xpos 2349
ypos 3399
}
push $Nd04c6000
Dot {
name Dot29
note_font_size 41
xpos 757
ypos 1277
}
set N7fc62000 [stack 0]
Grade {
channels rgba
gamma {{parent.bleedColorFalloff_2}}
name Grade1
selected true
xpos 724
ypos 2638
}
Dot {
name Dot33
note_font_size 41
xpos 758
ypos 2835
}
Multiply {
channels rgba
value {{globalAmount}}
name MultiplyGlobal2
label "\[value value]"
xpos 297
ypos 2828
}
push $Ncb561c00
Dot {
name Dot38
note_font_size 41
xpos 438
ypos 725
}
set N7fc61000 [stack 0]
Dot {
name Dot2
note_font_size 41
xpos 439
ypos 802
}
set N7fc60c00 [stack 0]
Dot {
name Dot17
note_font_size 41
xpos 334
ypos 802
}
Dot {
name Dot16
note_font_size 41
xpos 334
ypos 1201
}
push $N7fc60c00
Blur {
size {{(width/13*parent.bleedColorSize*16*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/13*parent.bleedColorSize*16*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
crop false
name Blur6
xpos 856
ypos 874
}
push $N7fc60c00
Blur {
size {{(width/13*parent.bleedColorSize*8*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/13*parent.bleedColorSize*8*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
crop false
name Blur4
xpos 743
ypos 873
}
push $N7fc60c00
Blur {
size {{(width/15*parent.bleedColorSize*4*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/15*parent.bleedColorSize*4*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
crop false
name Blur3
xpos 627
ypos 874
}
push $N7fc60c00
Blur {
size {{(width/20*parent.bleedColorSize*2*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/20*parent.bleedColorSize*2*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
crop false
name Blur2
xpos 515
ypos 872
}
push $N7fc60c00
Blur {
size {{(width/25*parent.bleedColorSize*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/25*parent.bleedColorSize*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
crop false
name Blur1
xpos 404
ypos 871
}
Merge2 {
inputs 2
operation under
bbox B
name Merge2
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 404
ypos 941
}
Merge2 {
inputs 2
operation under
bbox B
name Merge4
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 404
ypos 999
}
Merge2 {
inputs 2
operation under
bbox B
name Merge8
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 404
ypos 1049
}
Merge2 {
inputs 2
operation under
bbox B
name Merge12
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 404
ypos 1087
}
Unpremult {
name Unpremult2
xpos 404
ypos 1111
}
Blur {
size {{(width/50*parent.bleedColorSize*10*(ExponGlowWrapAll.aspectCalc.aspect.w/100))} {(height/50*parent.bleedColorSize*10*(ExponGlowWrapAll.aspectCalc.aspect.h/100))}}
crop false
name Blur5
xpos 404
ypos 1151
}
CopyBBox {
inputs 2
name CopyBBox1
xpos 404
ypos 1198
}
Unpremult {
name Unpremult5
xpos 404
ypos 2385
}
Colorspace {
channels all
colorspace_out HSV
name Colorspace1
xpos 404
ypos 2456
}
Multiply {
value {1 1 0 1}
name Multiply5
label "\[value value]"
xpos 404
ypos 2532
}
push $Ncb563000
push $Nd04c5400
push $N7fc61000
Dot {
name Dot10
xpos 201
ypos 725
}
Clamp {
minimum 0.001
maximum 100
name Clamp1
xpos 167
ypos 996
}
Dot {
name Dot24
xpos 201
ypos 1517
}
Multiply {
channels rgba
value {{globalAmount}}
name MultiplyGlobal
label "\[value value]"
xpos 19
ypos 1507
}
push $N7fc62000
Colorspace {
channels all
colorspace_out HSV
name Colorspace6
xpos -13
ypos 1267
}
Multiply {
value {1 1 0 1}
name Multiply4
label "\[value value]"
xpos -123
ypos 1262
}
push $Nc2641000
Remove {
operation keep
channels rgba
name Remove1
xpos -413
ypos 594
}
Unpremult {
channels all
name Unpremult1
xpos -407
ypos 1094
disable {{premultiplied*-1+1 x1 1}}
}
set Nc9732000 [stack 0]
Dot {
name Dot12
xpos -226
ypos 1101
}
Colorspace {
channels all
colorspace_out HSV
name Colorspace5
xpos -260
ypos 1140
}
Multiply {
value {0 0 1 1}
name Multiply3
label "\[value value]"
xpos -260
ypos 1188
}
Merge2 {
inputs 2
operation plus
Achannels none
Bchannels none
output none
also_merge all
name Merge3
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -260
ypos 1267
}
Colorspace {
channels all
colorspace_in HSV
name Colorspace7
xpos -260
ypos 1327
}
Dot {
name Dot36
label "BLEND EDGES"
note_font_size 45
xpos -226
ypos 1408
}
push $Nc9732000
Dot {
name Dot18
note_font_size 41
xpos -373
ypos 1514
}
set Nc9730400 [stack 0]
Merge2 {
inputs 2+1
operation copy
bbox B
Achannels none
Bchannels none
output none
also_merge all
mix {{blendEdgesAmount}}
name Merge10
xpos -260
ypos 1507
}
Dot {
name Dot22
note_font_size 41
xpos -226
ypos 1588
}
push $Nc9730400
Switch {
inputs 2
which {{"blendEdgesAmount == 0 ? 0 : 1"}}
name Switch3
xpos -407
ypos 1585
}
Merge2 {
inputs 2
bbox B
Achannels none
Bchannels none
output none
also_merge all
name Merge5
xpos -407
ypos 1685
}
Merge2 {
inputs 2
bbox B
Achannels none
Bchannels none
output none
also_merge all
name Merge6
xpos -407
ypos 1791
}
Dot {
name Dot34
note_font_size 41
xpos -373
ypos 2417
}
set N33c9e800 [stack 0]
Colorspace {
channels all
colorspace_out HSV
name Colorspace2
xpos -81
ypos 2410
}
Multiply {
value {0 0 1 1}
name Multiply6
label "\[value value]"
xpos -81
ypos 2458
}
Merge2 {
inputs 2
operation plus
Achannels none
Bchannels none
output none
also_merge all
name Merge11
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -81
ypos 2537
}
Colorspace {
channels all
colorspace_in HSV
name Colorspace8
xpos -81
ypos 2606
}
push $Nc9732000
Dot {
name Dot13
xpos -579
ypos 1101
}
Dot {
name Dot14
xpos -579
ypos 2559
}
push $N33c9e800
Copy {
inputs 2
from0 rgba.alpha
to0 rgba.alpha
name Copy1
xpos -407
ypos 2552
}
Dot {
name Dot6
note_font_size 41
xpos -373
ypos 2649
}
set N33c9c800 [stack 0]
Merge2 {
inputs 2+1
operation copy
output {rgba.red rgba.green rgba.blue -rgba.alpha}
mix {{bleedColorAmount}}
name Merge9
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -81
ypos 2828
}
push $N33c9c800
Switch {
inputs 2
which {{"parent.bleedColorAmount== 0 ? 0 : 1"}}
name Switch2
xpos -407
ypos 2832
}
Premult {
name Premult3
xpos -407
ypos 2983
disable {{premultiplied*-1+1 i}}
}
Dot {
name Dot19
xpos -373
ypos 3396
}
Switch {
inputs 5
which {{"\[value ls parent.outputView]"}}
name Switch1
xpos 1708
ypos 3395
}
push $Nc2640800
Dot {
name Dot5
note_font_size 41
xpos -825
ypos 3581
}
Merge2 {
inputs 2+1
operation copy
also_merge all
name MergeCopyLightWrapPro
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 1708
ypos 3580
}
Output {
name Output1
xpos 1708
ypos 3898
}
end_group
Dot {
name Dot79
selected true
xpos -34424
ypos 21911
}
Dot {
name Dot80
note_font_size 41
selected true
xpos -27540
ypos 21911
}
set N33c49c00 [stack 0]
Remove {
operation keep
channels rgba
name Remove21
selected true
xpos -27430
ypos 21907
}
push $N80a49c00
Dot {
name Dot81
note_font_size 41
selected true
xpos -33810
ypos 19091
}
set N33c49400 [stack 0]
Dot {
name Dot82
note_font_size 41
selected true
xpos -33662
ypos 19091
}
Shuffle {
in GS_Plate
name Shuffle20
label "\[value in]"
selected true
xpos -33696
ypos 19134
}
Remove {
operation keep
channels rgba
name Remove22
selected true
xpos -33696
ypos 19172
}
NoOp {
name Anchor_2bcb55a0c1
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
knobChanged stamps.anchorKnobChanged()
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0xffffff01
note_font_size 20
selected true
xpos -33696
ypos 19228
addUserKnob {20 anchor_tab l "Anchor Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "GS Plate"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "GS Plate"}
addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_2bcb55a0c8}
addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
tags 2D,
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
NoOp {
name Stamp34
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
knobChanged "import stamps; stamps.wiredKnobChanged()"
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0x1000001
note_font "Bitstream Vera Sans"
note_font_size 20
selected true
xpos -27362
ypos 21474
hide_input true
addUserKnob {20 wired_tab l "Wired Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "GS Plate"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "GS Plate"}
addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." T "<i>Advanced Keying Template</i>"}
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 anchor_label l Anchor: T " "}
addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
addUserKnob {26 space_1 l "" +STARTLINE T " "}
addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
addUserKnob {26 space_2 l "" +STARTLINE T " "}
addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
addUserKnob {1 anchor l Anchor}
anchor Anchor_2bcb55a0c8
addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Dot {
name Dot325
note_font_size 41
selected true
xpos -27328
ypos 21547
}
push $N33c49400
Shuffle {
in cleanplate
name Shuffle21
label "\[value in]"
selected true
xpos -33844
ypos 19135
}
Remove {
operation keep
channels rgba
name Remove23
selected true
xpos -33844
ypos 19173
}
NoOp {
name Anchor_3d5fc4c58e1
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
knobChanged stamps.anchorKnobChanged()
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0xffffff01
note_font_size 20
selected true
xpos -33844
ypos 19225
addUserKnob {20 anchor_tab l "Anchor Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "GS cleanplate"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T cleanplate}
addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_3d5fc4c58e}
addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
tags 2D,
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
NoOp {
name Stamp33
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.wiredOnCreate()\n    except:\n        pass\n"
knobChanged "import stamps; stamps.wiredKnobChanged()"
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0x1000001
note_font "Bitstream Vera Sans"
note_font_size 20
selected true
xpos -27488
ypos 21475
hide_input true
addUserKnob {20 wired_tab l "Wired Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T wired}
addUserKnob {3 lockCallbacks l "" +STARTLINE +HIDDEN}
addUserKnob {6 toReconnect -STARTLINE +HIDDEN}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "GS cleanplate"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "GS cleanplate"}
addUserKnob {26 tags l Tags: t "Tags of this stamp's Anchor, for information purpose only.\nClick \"show anchor\" to change them." T <i>2D</i>}
addUserKnob {26 backdrops l Backdrops: t "Labels of backdrop nodes which contain this stamp's Anchor." T "<i>Advanced Keying Template</i>"}
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 anchor_label l Anchor: T " "}
addUserKnob {22 show_anchor l " show anchor " t "Show the properties panel for this Stamp's Anchor." -STARTLINE T stamps.wiredShowAnchor()}
addUserKnob {22 zoom_anchor l "zoom anchor" t "Navigate to this Stamp's Anchor on the Node Graph." -STARTLINE T stamps.wiredZoomAnchor()}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 zoomNext l " zoom next " t "Navigate to this Stamp's next sibling on the Node Graph." -STARTLINE T stamps.wiredZoomNext()}
addUserKnob {22 selectSimilar l " select similar " t "Select all similar Stamps to this one on the Node Graph." -STARTLINE T stamps.wiredSelectSimilar()}
addUserKnob {26 space_1 l "" +STARTLINE T " "}
addUserKnob {26 reconnect_label l Reconnect: t "Reconnect by the stored Anchor name." T " "}
addUserKnob {22 reconnect_this l this t "Reconnect this Stamp to its Anchor, by its stored Anchor name." -STARTLINE T "n = nuke.thisNode()\ntry:\n    n.setInput(0,nuke.toNode(n.knob(\"anchor\").value()))\nexcept:\n    nuke.message(\"Unable to reconnect.\")\ntry:\n    import stamps\n    stamps.wiredGetStyle(n)\nexcept:\n    pass\n"}
addUserKnob {22 reconnect_similar l similar t "Reconnect this Stamp and similar ones to their Anchor, by their stored anchor name." -STARTLINE T stamps.wiredReconnectSimilar()}
addUserKnob {22 reconnect_all l all t "Reconnect all the Stamps to their Anchors, by their stored anchor names." -STARTLINE T stamps.wiredReconnectAll()}
addUserKnob {26 space_2 l "" +STARTLINE T " "}
addUserKnob {20 advanced_reconnection l "Advanced Reconnection" n 2}
addUserKnob {26 reconnect_by_title_label l "<font color=gold>By Title:" t "Reconnect by searching for a matching title." T " "}
addUserKnob {22 reconnect_by_title_this l this t "Look for an Anchor that shares this Stamp's title, and connect this Stamp to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitle()}
addUserKnob {22 reconnect_by_title_similar l similar t "Look for an Anchor that shares this Stamp's title, and connect this Stamp and similar ones to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSimilar()}
addUserKnob {22 reconnect_by_title_selected l selected t "For each Stamp selected, look for an Anchor that shares its title, and connect to it.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectByTitleSelected()}
addUserKnob {26 reconnect_by_selection_label l "<font color=orangered>By Selection:" t "Force reconnect to a selected Anchor." T " "}
addUserKnob {22 reconnect_by_selection_this l this t "Force reconnect this Stamp to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelection()}
addUserKnob {22 reconnect_by_selection_similar l similar t "Force reconnect this Stamp and similar ones to a selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSimilar()}
addUserKnob {22 reconnect_by_selection_selected l selected t "Force reconnect all selected Stamps to an also selected Anchor, whatever its name or title.\nIMPORTANT: Use this carefully, and only when the normal reconnection doesn't work." -STARTLINE T stamps.wiredReconnectBySelectionSelected()}
addUserKnob {1 anchor l Anchor}
anchor Anchor_3d5fc4c58e
addUserKnob {6 auto_reconnect_by_title l "<font color=#ED9977>&nbsp; auto-reconnect by title" t "When creating this stamp again (like on copy-paste), auto-reconnect it by title instead of doing it by the saved anchor's name, and auto-turn this off immediately.\nIMPORTANT: Should be off by default. Only use this for setting up templates." +STARTLINE}
addUserKnob {20 advanced_reconnection_1 l "Advanced Reconnection" +INVISIBLE n -1}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
Dot {
name Dot180
note_font_size 41
selected true
xpos -27454
ypos 21594
}
push $N79bbac00
Dot {
name Dot181
note_font_size 41
selected true
xpos -27214
ypos 21420
}
Group {
inputs 3
name AdditiveKeyerPro1
tile_color 0x5200ff
note_font "Verdana Bold"
note_font_color 0xffffffff
selected true
xpos -27248
ypos 21591
disable true
addUserKnob {20 AdditiveKeyer}
addUserKnob {6 useSC l "Use Screen Color as CleanPlate" +STARTLINE}
addUserKnob {41 screenColor l "Screen Color" T Keylight1.screenColour}
addUserKnob {6 despillSat l "Despill Screen Color from Saturation?" +STARTLINE}
despillSat true
addUserKnob {26 ""}
addUserKnob {7 DarkValue l "Dark Value" R 0 5}
DarkValue 1
addUserKnob {7 satDarks l "Saturate Darks"}
satDarks 0.2
addUserKnob {18 darkTint l "Dark Tint"}
darkTint 1
addUserKnob {6 darkTint_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 darkTint_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {26 ""}
addUserKnob {6 lightTint_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
addUserKnob {7 ExtraLightValue l "Light Value Plus" R 0 2}
ExtraLightValue 1
addUserKnob {7 satLights l "Saturate Lights"}
satLights 0.2
addUserKnob {18 lightTint l "Light Tint"}
lightTint 1
addUserKnob {6 lightTint_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {6 lightTint_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
addUserKnob {7 LightValue l "Light Value BG Mult" R 0 5}
LightValue 0.25
addUserKnob {26 ""}
addUserKnob {6 darkTint_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" +HIDDEN +STARTLINE}
addUserKnob {6 lightTint_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" +HIDDEN +STARTLINE}
addUserKnob {6 compositeSwitch l "Output Difference to RGB" +STARTLINE}
addUserKnob {6 outputDiffAlpha l "Output Difference Matte to Alpha" +STARTLINE}
addUserKnob {26 ""}
addUserKnob {41 maskChannelMask l mask T MergeKeymix.maskChannelMask}
addUserKnob {41 inject -STARTLINE T MergeKeymix.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T MergeKeymix.invert_mask}
addUserKnob {41 fringe -STARTLINE T MergeKeymix.fringe}
addUserKnob {41 mix T MergeKeymix.mix}
addUserKnob {20 info l Info}
addUserKnob {26 creator l "Modified By:" T "<b><big>Tony Lyons"}
addUserKnob {26 desc l Description: t "adds the difference between cleanplate and key plate to the BG\n\nGood for hair details and shadows and sensitive edge treatment" T AdditiveKeyer}
addUserKnob {26 ver l Version: T v04}
}
Input {
inputs 0
name Inputmask
xpos 685
ypos 1141
number 3
}
Dot {
name Dot10
label Mask
note_font_size 41
xpos 719
ypos 1883
}
Dot {
name Dot11
note_font_size 41
xpos 719
ypos 1983
}
Input {
inputs 0
name fg
label "\[value number]"
xpos -500
ypos -221
number 1
}
Remove {
channels alpha
name Remove2
xpos -500
ypos -147
}
AddChannels {
channels rgba
name AddChannels2
xpos -500
ypos -109
}
Dot {
name Dot26
note_font_size 41
xpos -466
ypos 5
}
set N33bfc400 [stack 0]
OFXuk.co.thefoundry.keylight.keylight_v201 {
show "Final Result"
unPreMultiply false
screenColour {0 0 0}
screenGain 1
screenBalance 0.5
alphaBias {0.5 0.5 0.5}
despillBias {0.5 0.5 0.5}
gangBiases true
preBlur 0
"Screen Matte" 0
screenClipMin 0
screenClipMax 1
screenClipRollback 0
screenGrowShrink 0
screenSoftness 0
screenDespotBlack 0
screenDespotWhite 0
screenReplaceMethod "Soft Colour"
screenReplaceColour {0.5 0.5 0.5}
Tuning 0
midPoint 0.5
lowGain 1
midGain 1
highGain 1
"Inside Mask" 0
sourceAlphaHandling Ignore
insideReplaceMethod "Soft Colour"
insideReplaceColour {0.5 0.5 0.5}
Crops 0
SourceXMethod Colour
SourceYMethod Colour
SourceEdgeColour 0
SourceCropL 0
SourceCropR 1
SourceCropB 0
SourceCropT 1
balanceSet false
insideComponent None
outsideComponent None
cacheBreaker true
name Keylight1
xpos -500
ypos 73
}
set Nb955fc00 [stack 0]
push $N33bfc400
Dot {
name Dot27
note_font_size 41
xpos -356
ypos 5
}
Merge2 {
inputs 2
operation from
name Merge3
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -390
ypos 73
}
Clamp {
channels rgba
name Clamp1
xpos -390
ypos 99
}
Saturation {
saturation 0
name Saturation4
xpos -390
ypos 125
}
push $Nb955fc00
Merge2 {
inputs 2
operation plus
name Merge7
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -500
ypos 125
}
push $N33bfc400
Dot {
name Dot30
note_font_size 41
xpos -598
ypos 5
}
Dot {
name Dot31
note_font_size 41
xpos -598
ypos 218
}
Switch {
inputs 2
which {{parent.despillSat}}
name DespillSwitch1
label "\[value which]"
xpos -500
ypos 208
}
Dot {
name Dot8
xpos -466
ypos 373
}
set Nb955d800 [stack 0]
Input {
inputs 0
name clean
label "\[value number]"
xpos 126
ypos -175
number 2
}
Remove {
channels alpha
name Remove3
xpos 126
ypos -101
}
AddChannels {
channels rgba
name AddChannels1
xpos 126
ypos -63
}
Grade {
multiply 0
add {{parent.Keylight1.screenColour} {parent.Keylight1.screenColour} {parent.Keylight1.screenColour} {parent.Keylight1.screenColour}}
name ScreenColor
xpos 126
ypos -14
disable {{!parent.useSC}}
}
Dot {
name Dot28
note_font_size 41
xpos 160
ypos 50
}
set Nb955c400 [stack 0]
OFXuk.co.thefoundry.keylight.keylight_v201 {
show "Final Result"
unPreMultiply false
screenColour {{parent.Keylight1.screenColour x1 0} {parent.Keylight1.screenColour x1 0} {parent.Keylight1.screenColour x1 0}}
screenGain 1
screenBalance 0.5
alphaBias {0.5 0.5 0.5}
despillBias {0.5 0.5 0.5}
gangBiases true
preBlur 0
"Screen Matte" 0
screenClipMin 0
screenClipMax 1
screenClipRollback 0
screenGrowShrink 0
screenSoftness 0
screenDespotBlack 0
screenDespotWhite 0
screenReplaceMethod "Soft Colour"
screenReplaceColour {0.5 0.5 0.5}
Tuning 0
midPoint 0.5
lowGain 1
midGain 1
highGain 1
"Inside Mask" 0
sourceAlphaHandling Ignore
insideReplaceMethod "Soft Colour"
insideReplaceColour {0.5 0.5 0.5}
Crops 0
SourceXMethod Colour
SourceYMethod Colour
SourceEdgeColour 0
SourceCropL 0
SourceCropR 1
SourceCropB 0
SourceCropT 1
balanceSet false
insideComponent None
outsideComponent None
cacheBreaker true
name Keylight2
xpos 126
ypos 118
}
set Nb94f3c00 [stack 0]
push $Nb955c400
Dot {
name Dot29
note_font_size 41
xpos 270
ypos 50
}
Merge2 {
inputs 2
operation from
name Merge8
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 236
ypos 118
}
Clamp {
channels rgba
name Clamp2
xpos 236
ypos 144
}
Saturation {
saturation 0
name Saturation5
xpos 236
ypos 170
}
push $Nb94f3c00
Merge2 {
inputs 2
operation plus
name Merge9
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 126
ypos 170
}
push $Nb955c400
Dot {
name Dot33
note_font_size 41
xpos 28
ypos 50
}
Dot {
name Dot34
note_font_size 41
xpos 28
ypos 230
}
Switch {
inputs 2
which {{parent.despillSat}}
name DespillSwitch2
label "\[value which]"
xpos 126
ypos 223
}
Dot {
name Dot35
note_font_size 41
xpos 160
ypos 320
}
set Nb94f1800 [stack 0]
Dot {
name Dot6
xpos 412
ypos 320
}
Merge2 {
inputs 2
operation difference
Achannels rgb
Bchannels rgb
name Merge6
xpos 378
ypos 370
}
Group {
name ChannelControl_v3
label "\[value channel_selector.in]"
note_font "Bitstream Vera Sans"
xpos 378
ypos 440
mapsize {0.15 0.15}
addUserKnob {20 channelControl}
addUserKnob {41 Channel_Selection T channel_selector.in}
addUserKnob {26 Description l "" +STARTLINE T ":Channel Control:\n\nChannel math with choice of merge operation"}
addUserKnob {26 ""}
addUserKnob {7 redGain}
redGain 0.3
addUserKnob {7 greenGain}
greenGain 0.59
addUserKnob {7 blueGain}
blueGain 0.11
addUserKnob {7 alphaGain}
addUserKnob {41 operation T Merge1.operation}
}
Input {
inputs 0
name Input1
xpos 558
ypos -694
}
Shuffle {
name channel_selector
label "\[value in]"
xpos 558
ypos -668
}
set Nb94f0800 [stack 0]
Shuffle {
green red
blue red
alpha red
name Shuffle1
xpos 386
ypos -536
}
Grade {
channels rgba
white {{parent.redGain i}}
name Grade12
xpos 386
ypos -492
}
push $Nb94f0800
Shuffle {
red green
blue green
alpha green
name Shuffle2
xpos 499
ypos -534
}
Grade {
channels rgba
white {{parent.greenGain i}}
name Grade13
xpos 499
ypos -493
}
Merge2 {
inputs 2
operation plus
name Merge1
xpos 411
ypos -428
}
set Cf3e17000 [stack 0]
push $Nb94f0800
Shuffle {
red blue
green blue
alpha blue
name Shuffle3
xpos 610
ypos -538
}
Grade {
channels rgba
white {{parent.blueGain i}}
name Grade14
xpos 610
ypos -494
}
clone $Cf3e17000 {
inputs 2
xpos 486
ypos -369
selected false
}
push $Nb94f0800
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle4
selected true
xpos 725
ypos -535
}
Grade {
channels rgba
white {{parent.alphaGain i}}
name Grade15
xpos 725
ypos -494
}
clone $Cf3e17000 {
inputs 2
xpos 580
ypos -307
selected false
}
Output {
name Output1
xpos 600
ypos -210
}
end_group
Dot {
name Dot14
note_font_size 41
xpos 412
ypos 1768
}
Input {
inputs 0
name bg
label "\[value number]"
xpos -845
ypos -242
}
AddChannels {
channels rgba
name AddChannels3
xpos -845
ypos -151
}
Dot {
name Dot9
note_font_size 41
xpos -811
ypos -78
}
Dot {
name Dot4
xpos -811
ypos 1449
}
set Ncea5bc00 [stack 0]
Dot {
name Dot13
note_font_size 41
xpos -811
ypos 1688
}
set Ncea5b800 [stack 0]
push $Nb955d800
Dot {
name Dot2
note_font_size 41
xpos -466
ypos 421
}
set Ncea5b400 [stack 0]
Saturation {
saturation {{parent.satDarks}}
name Saturation9
xpos -378
ypos 418
}
push $Nb94f1800
Saturation {
saturation {{parent.satDarks}}
name Saturation8
xpos -215
ypos 317
}
Merge2 {
inputs 2
operation divide
name Merge5
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -215
ypos 418
}
Dot {
name Dot38
note_font_size 41
xpos -181
ypos 674
}
Clamp {
channels rgba
minimum 1
minimum_enable false
name Clamp4
xpos -215
ypos 786
}
Add {
channels rgba
value -1
name Add3
xpos -215
ypos 840
}
Multiply {
channels rgb
value {{parent.DarkValue} {parent.DarkValue} {parent.DarkValue} 0}
name DARK_VALUE
xpos -215
ypos 892
}
Grade {
multiply {{parent.darkTint} {parent.darkTint} {parent.darkTint} {parent.darkTint}}
reverse true
black_clamp false
name DARK_TINT
xpos -215
ypos 931
}
Add {
channels rgba
value 1
name Add4
xpos -215
ypos 988
}
Clamp {
channels rgb
name Clamp5
xpos -215
ypos 1065
}
Dot {
name Dot39
note_font_size 41
xpos -181
ypos 1257
}
push $Ncea5b400
Dot {
name Dot36
note_font_size 41
xpos -466
ypos 577
}
Saturation {
saturation {{parent.satLights}}
name Saturation1
xpos -101
ypos 574
}
set Ncea07c00 [stack 0]
push $Nb94f1800
Saturation {
saturation {{parent.satLights}}
name Saturation6
xpos 126
ypos 500
}
set Ncea07800 [stack 0]
Merge2 {
inputs 2
operation divide
also_merge all
name Merge10
label all
xpos 126
ypos 568
}
Clamp {
channels rgba
minimum 1
maximum_enable false
name Clamp3
xpos 126
ypos 780
}
Add {
channels rgba
value -1
name Add1
xpos 126
ypos 838
}
Multiply {
channels rgb
value {{parent.LightValue} {parent.LightValue} {parent.LightValue} 0}
name LIGHT_VALUE
xpos 126
ypos 961
}
Multiply {
channels rgb
value {{parent.lightTint.r} {parent.lightTint.g} {parent.lightTint.b} 0}
name LIGHT_TINT
xpos 126
ypos 1039
}
Add {
channels rgba
value 1
name Add2
xpos 126
ypos 1120
}
Merge2 {
inputs 2
operation multiply
Achannels rgb
Bchannels rgb
output rgb
name __CONSTRAIN_DARKS__
xpos 128
ypos 1253
}
Dot {
name Dot19
note_font_size 41
xpos 162
ypos 1354
}
set Ncea05800 [stack 0]
Dot {
name Dot3
xpos -8
ypos 1354
}
Dot {
name Dot16
note_font_size 41
xpos -8
ypos 1611
}
push $Ncea07800
Dot {
name Dot7
note_font_size 41
xpos 310
ypos 503
}
push $Ncea07c00
Dot {
name Dot5
note_font_size 41
xpos -67
ypos 691
}
Merge2 {
inputs 2
operation from
name Merge1
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 276
ypos 688
}
Clamp {
channels rgba
maximum_enable false
name Clamp6
xpos 276
ypos 781
}
Multiply {
channels rgba
value {{parent.ExtraLightValue}}
name Multiply1
label "\[value value]"
xpos 276
ypos 899
}
Multiply {
channels rgb
value {{parent.lightTint.r} {parent.lightTint.g} {parent.lightTint.b} 0}
name LIGHT_TINT1
xpos 276
ypos 1036
}
Dot {
name Dot15
note_font_size 41
xpos 310
ypos 1513
}
push $Ncea05800
Dot {
name Dot1
note_font_size 41
xpos 162
ypos 1449
}
push $Ncea5bc00
Merge2 {
inputs 2
operation multiply
Achannels rgb
Bchannels rgb
output rgb
name CONSTRAIN_LIGHTS
xpos 128
ypos 1446
}
Merge2 {
inputs 2
operation plus
output rgb
name Merge2
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 128
ypos 1510
}
Switch {
inputs 2
which {{parent.compositeSwitch}}
name Switch1
label "\[value which]"
xpos 128
ypos 1604
}
Copy {
inputs 2
from0 rgba.alpha
to0 rgba.alpha
name Copy1
xpos 128
ypos 1678
disable {{parent.outputDiffAlpha}}
}
Copy {
inputs 2
from0 rgba.blue
to0 rgba.alpha
name __LUMA_INTO_ALPHA__
xpos 128
ypos 1758
disable {{!parent.outputDiffAlpha}}
}
Dot {
name Dot17
label A
note_font_size 41
xpos 162
ypos 1910
}
push $Ncea5b800
Dot {
name Dot18
label B
note_font_size 41
xpos -811
ypos 1895
}
Dot {
name Dot12
note_font_size 41
xpos -811
ypos 1986
}
Merge2 {
inputs 2+1
operation copy
bbox B
Achannels none
Bchannels none
output none
also_merge rgba
name MergeKeymix
xpos 128
ypos 1973
}
Output {
name Output1
xpos 128
ypos 2235
}
end_group
Merge2 {
inputs 2
bbox B
name Merge16
selected true
xpos -27248
ypos 21907
}
Dot {
name Dot182
selected true
xpos -27214
ypos 22431
}
push $N80ab6400
push $N80ab5c00
Merge2 {
inputs 2
operation plus
name Merge83
label "test lunimance match"
selected true
xpos -34156
ypos 14913
}
Dot {
name Dot183
label test
note_font_size 31
selected true
xpos -34122
ypos 15042
}
push $N80a4a000
Shuffle {
in despill_RGB
name Shuffle22
label "\[value in]"
selected true
xpos -34194
ypos 19135
}
Remove {
operation keep
channels rgba
name Remove24
selected true
xpos -34194
ypos 19173
}
NoOp {
name Anchor_35df1
help "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019"
onCreate "if nuke.GUI:\n    try:\n        import stamps; stamps.anchorOnCreate()\n    except:\n        pass"
knobChanged stamps.anchorKnobChanged()
autolabel "nuke.thisNode().knob(\"title\").value()"
tile_color 0xffffff01
note_font_size 20
selected true
xpos -34194
ypos 19228
addUserKnob {20 anchor_tab l "Anchor Stamp"}
addUserKnob {26 identifier -STARTLINE +HIDDEN T anchor}
addUserKnob {1 title l Title: t "Displayed name on the Node Graph for this Stamp and its Anchor.\nIMPORTANT: This is only for display purposes, and is different from the real/internal name of the Stamps."}
title "despill RGB"
addUserKnob {26 prev_title l "" +STARTLINE +HIDDEN T "despill RGB"}
addUserKnob {26 prev_name l "" +STARTLINE +HIDDEN T Anchor_35df505785}
addUserKnob {3 showing l "" +STARTLINE +HIDDEN}
addUserKnob {1 tags l Tags t "Comma-separated tags you can define for each Anchor, that will help you find it when invoking the Stamp Selector by pressing the Stamps shortkey with nothing selected."}
tags 2D,
addUserKnob {26 line1 l "" +STARTLINE}
addUserKnob {26 stamps_label l Stamps: T " "}
addUserKnob {22 createStamp l new t "Create a new Stamp for this Anchor." -STARTLINE T stamps.stampCreateWired(nuke.thisNode())}
addUserKnob {22 selectStamps l select t "Reconnect all of this Anchor's Stamps." -STARTLINE T stamps.wiredSelectSimilar(nuke.thisNode().name())}
addUserKnob {22 reconnectStamps l reconnect -STARTLINE T stamps.anchorReconnectWired()}
addUserKnob {22 zoomNext l "zoom next" t "Navigate to this Anchor's next Stamp on the Node Graph." -STARTLINE T stamps.wiredZoomNext(nuke.thisNode().name())}
addUserKnob {26 line2 l "" +STARTLINE}
addUserKnob {22 buttonHelp l Help -STARTLINE T stamps.showHelp()}
addUserKnob {26 version l " " t "Stamps by Adrian Pueyo and Alexey Kuchinski.\nUpdated Sep 27 2019." -STARTLINE T "<a href=\"http://www.nukepedia.com/gizmos/other/stamps\" style=\"color:#666;text-decoration: none;\"><span style=\"color:#666\"> <big>Stamps v1.0</big></b></a>"}
}
StickyNote {
inputs 0
name StickyNote21
tile_color 0xff
label "Make or Generate\ncleanplate if you can"
note_font_size 41
note_font_color 0xffffffff
selected true
xpos -29824
ypos 14698
}
StickyNote {
inputs 0
name StickyNote2
tile_color 0xff
label "<-- adjust \nblackpoint/\nwhitepoint"
note_font_size 41
note_font_color 0xffffffff
selected true
xpos -33652
ypos 19816
}
push $N33c49c00
Shuffle {
in GS_Plate
name Shuffle24
label "\[value in]"
selected true
xpos -27574
ypos 22116
}
push $N79b73400
Dot {
name Dot83
selected true
xpos -29874
ypos 13720
}
Remove {
operation keep
channels rgb
name Remove25
selected true
xpos -29908
ypos 13848
}
Dot {
name Dot185
note_font_size 41
selected true
xpos -29874
ypos 14196
}
Premult {
inputs 0
name Premult2
selected true
xpos -31758
ypos 13012
}
Blur {
size 45
name Blur7
selected true
xpos -31751
ypos 13055
}
Unpremult {
name Unpremult1
selected true
xpos -31746
ypos 13121
}
Premult {
name Premult3
selected true
xpos -31746
ypos 13200
}
Blur {
size 67
name Blur9
selected true
xpos -31744
ypos 13243
}
Unpremult {
name Unpremult5
selected true
xpos -31744
ypos 13308
}
Premult {
name Premult4
selected true
xpos -31744
ypos 13365
}
Blur {
size 200
name Blur10
selected true
xpos -31742
ypos 13406
}
Unpremult {
name Unpremult7
selected true
xpos -31742
ypos 13442
}
Premult {
name Premult5
selected true
xpos -31742
ypos 13494
}
Blur {
size 500
name Blur11
selected true
xpos -31742
ypos 13534
}
Unpremult {
name Unpremult8
selected true
xpos -31742
ypos 13570
}
Group {
inputs 0
name IBK_Colour_Plus1
help "This node provides IBKGizmo a colour reference in which to base its keying algorithm on a per pixel basis.\nThe idea is to remove the foreground image and only leave the shades and hues of the original blue/greenscreen.\nAttach the output of this node to the 'c' input of a default IBKGizmo. Attach the input of this node along with the 'fg' input of the IBKGizmo to the original screen.\nPick which colour your screen type is in both nodes and then while viewing the alpha output from the IBKGizmo lower the darks.b (if a bluescreen - adjust darks.g if a greenscreen) in this node \nuntil you see a change in the garbage area of the matte. Once you see a change then you have gone too far -back off a step. If you are still left with discoloured edges you can use the other colours in the lights and darks to eliminate them. Remember the idea is \nto be left with the original shades of the screen and the foreground blacked out. While swapping between viewing the matte from the IBKGizmo and the rgb output of this IBKColour adjust the other colours \nuntil you see a change in the garbage area of the matte. Simple rule of thumb - if you have a light red discoloured area increase the lights.r - if you have a dark green discoloured area increase darks.g. If your screen does not have a very saturated hue you may still be left\n with areas of discolouration after the above process. The 'erode' slider can help with this - while viewing the rgb output adjust the erode until those areas disappear.\nThe 'patch black' slider allows you to fill in the black areas with screen colour. This is not always necessary but if you see blue squares in your composite increase this value and it'll fix it.\nThe above is the only real workflow for this node - working from the top parameter to the bottom parameter- going back to tweak darks/lights with 'erode' and 'patch black' activated isn't really gonna work. "
tile_color 0x990000
selected true
xpos -31483
ypos 13229
addUserKnob {20 "" l Parameters}
addUserKnob {16 Size l size t "size of colour expansion" R 0 100}
Size 1
addUserKnob {7 erode t "increase this value if you still see traces of the foreground edge colour in the output" R 0 5}
erode 8
addUserKnob {7 multi l "patch black" t "increase this to optionally remove the black from the output.\nThis should only be used once the the above darks/lights have been set" R 0 5}
multi 12
addUserKnob {26 ""}
addUserKnob {20 Help}
addUserKnob {26 ""}
addUserKnob {26 how_to l "" +STARTLINE T "Works like the IBK_Colour, howecer you can use a Primatte to generate the matte for the blue/green screen.\nThe standard IBK_Colour will soften your result plus any change in 'size' will soften it more, relative to the value. \n\nIBK_Colour_Plus will keep the sharpness, it will cascade multiple iterations without interfereing with previous iterations, and withoutrendering a new key each time. "}
addUserKnob {26 ""}
addUserKnob {26 credit l "" +STARTLINE T "IBK_Colour_Plus - Gabriel Reichle - 2015\n               updated - Dustin Cumming - 2017"}
}
Input {
inputs 0
name External_Key
xpos -101
ypos -11
number 1
}
Invert {
channels alpha
name Invert1
tile_color 0x7aa9ff00
xpos -101
ypos 147
}
Erode {
size {{erode}}
name Erode1
xpos -101
ypos 185
}
set Nf0655000 [stack 0]
Dot {
name Dot3
tile_color 0x9597bf00
xpos -67
ypos 3927
}
push $Nf0655000
Input {
inputs 0
name Input1
xpos 92
ypos -12
}
Copy {
inputs 2
from0 rgba.alpha
to0 rgba.alpha
channels alpha
name Copy3
tile_color 0x9e3c6300
xpos 92
ypos 179
}
set Nf0654400 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle1
xpos 360
ypos 199
}
Unpremult {
name Unpremult12
xpos 360
ypos 225
}
Dot {
name Dot43
selected true
xpos 1147
ypos 229
}
set Nf060b400 [stack 0]
push $Nf0654400
Premult {
name Premult3
xpos 92
ypos 274
}
Unpremult {
name Unpremult4
xpos 92
ypos 300
}
Dot {
name Dot2
xpos 1027
ypos 304
}
Dot {
name Dot4
xpos 1027
ypos 387
}
set Nf060a400 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy1
xpos 1113
ypos 377
}
Blur {
channels rgba
size 3
name Blur1
xpos 1113
ypos 440
}
Unpremult {
name Unpremult1
xpos 1113
ypos 462
}
set Nf0609800 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle2
xpos 1113
ypos 650
}
Unpremult {
name Unpremult13
xpos 1113
ypos 681
}
set Nf0609000 [stack 0]
push $Nf060b400
Dot {
name Dot42
xpos 1269
ypos 229
}
Dot {
name Dot5
xpos 1269
ypos 304
}
push $Nf0609800
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy2
xpos 1235
ypos 460
}
Invert {
channels alpha
name Invert2
xpos 1235
ypos 538
}
FilterErode {
channels alpha
size -1.6
filter gaussian
name FilterErode1
xpos 1235
ypos 580
}
Premult {
name Premult1
xpos 1240
ypos 622
}
push $Nf060a400
Merge {
inputs 2
name Merge1
xpos 993
ypos 622
}
set Nf05bb000 [stack 0]
Dot {
name Dot6
xpos 1027
ypos 648
}
Dot {
name Dot8
xpos 1027
ypos 752
}
set Nf05ba800 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy4
xpos 1113
ypos 742
}
Blur {
channels rgba
size 6
name Blur2
xpos 1113
ypos 784
}
Unpremult {
name Unpremult2
xpos 1113
ypos 810
}
set Nf05b9c00 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle3
xpos 1113
ypos 994
}
Unpremult {
name Unpremult14
xpos 1113
ypos 1025
}
set Nf05b9400 [stack 0]
push $Nf0609000
Dot {
name Dot7
xpos 1269
ypos 685
}
push $Nf05b9c00
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy5
xpos 1235
ypos 804
}
Invert {
channels alpha
name Invert3
xpos 1235
ypos 890
}
FilterErode {
channels alpha
size -1.6
filter gaussian
name FilterErode2
xpos 1235
ypos 928
}
Premult {
name Premult2
xpos 1235
ypos 966
}
push $Nf05ba800
Merge {
inputs 2
name Merge2
xpos 993
ypos 966
}
set Ncc75f800 [stack 0]
Dot {
name Dot9
xpos 1027
ypos 992
}
Dot {
name Dot11
xpos 1027
ypos 1075
}
set Ncc75f000 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy6
xpos 1113
ypos 1065
}
Blur {
channels rgba
size 12
name Blur3
xpos 1113
ypos 1128
}
Unpremult {
name Unpremult3
xpos 1113
ypos 1154
}
set Ncc75e400 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle4
xpos 1113
ypos 1333
}
Unpremult {
name Unpremult15
xpos 1113
ypos 1366
}
set Ncc75dc00 [stack 0]
push $Nf05b9400
Dot {
name Dot10
xpos 1269
ypos 1029
}
push $Ncc75e400
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy7
xpos 1235
ypos 1148
}
Invert {
channels alpha
name Invert4
xpos 1235
ypos 1186
}
FilterErode {
channels alpha
size -3
filter gaussian
name FilterErode4
xpos 1235
ypos 1224
}
Gamma {
channels alpha
value 4
name Gamma1
xpos 1235
ypos 1262
}
Premult {
name Premult4
xpos 1235
ypos 1310
}
push $Ncc75f000
Merge {
inputs 2
name Merge3
xpos 993
ypos 1310
}
set Ncc707c00 [stack 0]
Dot {
name Dot1
xpos 1027
ypos 1336
}
Dot {
name Dot13
xpos 1027
ypos 1419
}
set Ncc707400 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy8
xpos 1113
ypos 1409
}
Blur {
channels rgba
size 24
name Blur5
xpos 1113
ypos 1472
}
Unpremult {
name Unpremult5
xpos 1113
ypos 1498
}
set Ncc706800 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle5
xpos 1113
ypos 1683
}
Unpremult {
name Unpremult16
xpos 1113
ypos 1709
}
set Ncc706000 [stack 0]
push $Ncc75dc00
Dot {
name Dot12
xpos 1269
ypos 1370
}
push $Ncc706800
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy9
xpos 1235
ypos 1492
}
Invert {
channels alpha
name Invert5
xpos 1235
ypos 1530
}
FilterErode {
channels alpha
size -5
filter gaussian
name FilterErode10
xpos 1235
ypos 1568
}
Gamma {
channels alpha
value 4
name Gamma2
xpos 1235
ypos 1606
}
Premult {
name Premult5
xpos 1235
ypos 1654
}
push $Ncc707400
Merge {
inputs 2
name Merge4
xpos 993
ypos 1654
}
set Ncc704400 [stack 0]
Dot {
name Dot14
xpos 1027
ypos 1680
}
Dot {
name Dot18
xpos 1027
ypos 1763
}
set Nb1143800 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy10
xpos 1113
ypos 1753
}
Blur {
channels rgba
size 48
name Blur6
xpos 1113
ypos 1816
}
Unpremult {
name Unpremult6
xpos 1113
ypos 1842
}
set Nb1142c00 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle6
xpos 1113
ypos 2017
}
Unpremult {
name Unpremult17
xpos 1113
ypos 2048
}
set Nb1142400 [stack 0]
push $Ncc706000
Dot {
name Dot15
xpos 1269
ypos 1713
}
push $Nb1142c00
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy11
xpos 1235
ypos 1836
}
Invert {
channels alpha
name Invert6
xpos 1235
ypos 1874
}
FilterErode {
channels alpha
size -10
filter gaussian
name FilterErode5
xpos 1235
ypos 1912
}
Gamma {
channels alpha
value 4
name Gamma3
xpos 1235
ypos 1950
}
Premult {
name Premult6
xpos 1235
ypos 1998
}
push $Nb1143800
Merge {
inputs 2
name Merge5
xpos 993
ypos 1998
}
set Nb1140800 [stack 0]
Dot {
name Dot19
xpos 1027
ypos 2024
}
Dot {
name Dot21
xpos 1027
ypos 2107
}
set Na1eafc00 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy12
xpos 1113
ypos 2097
}
Blur {
channels rgba
size 96
name Blur7
xpos 1113
ypos 2160
}
Unpremult {
name Unpremult7
xpos 1113
ypos 2186
}
set Na1eaf000 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle7
xpos 1113
ypos 2362
}
Unpremult {
name Unpremult18
xpos 1113
ypos 2392
}
set Na1eae800 [stack 0]
push $Nb1142400
Dot {
name Dot20
xpos 1269
ypos 2052
}
push $Na1eaf000
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy13
xpos 1235
ypos 2180
}
Invert {
channels alpha
name Invert7
xpos 1235
ypos 2218
}
FilterErode {
channels alpha
size -18
filter gaussian
name FilterErode6
xpos 1235
ypos 2256
}
Gamma {
channels alpha
value 4
name Gamma4
xpos 1235
ypos 2294
}
Premult {
name Premult7
xpos 1235
ypos 2342
}
push $Na1eafc00
Merge {
inputs 2
name Merge6
xpos 993
ypos 2342
}
set Na1eacc00 [stack 0]
Dot {
name Dot22
xpos 1027
ypos 2368
}
Dot {
name Dot24
xpos 1027
ypos 2451
}
set Na1eac400 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy14
xpos 1113
ypos 2441
}
Blur {
channels rgba
size 192
name Blur8
xpos 1113
ypos 2504
}
Unpremult {
name Unpremult8
xpos 1113
ypos 2530
}
set Na1e63400 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle8
xpos 1113
ypos 2711
}
Unpremult {
name Unpremult19
xpos 1113
ypos 2741
}
set Na1e62c00 [stack 0]
push $Na1eae800
Dot {
name Dot23
xpos 1269
ypos 2396
}
push $Na1e63400
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy15
xpos 1235
ypos 2524
}
Invert {
channels alpha
name Invert8
xpos 1235
ypos 2562
}
FilterErode {
channels alpha
size -25
filter gaussian
name FilterErode7
xpos 1235
ypos 2600
}
Gamma {
channels alpha
value 4
name Gamma5
xpos 1235
ypos 2638
}
Premult {
name Premult8
xpos 1235
ypos 2686
}
push $Na1eac400
Merge {
inputs 2
name Merge7
xpos 993
ypos 2686
}
set Na1e61000 [stack 0]
Dot {
name Dot25
xpos 1027
ypos 2712
}
Dot {
name Dot27
xpos 1027
ypos 2795
}
set Na1e60800 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy16
xpos 1113
ypos 2785
}
Blur {
channels rgba
size 384
name Blur9
xpos 1113
ypos 2848
}
Unpremult {
name Unpremult9
xpos 1113
ypos 2874
}
set Nce17b800 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle9
xpos 1113
ypos 3054
}
Unpremult {
name Unpremult20
xpos 1113
ypos 3084
}
set Nce17b000 [stack 0]
push $Na1e62c00
Dot {
name Dot26
xpos 1269
ypos 2745
}
push $Nce17b800
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy17
xpos 1235
ypos 2868
}
Invert {
channels alpha
name Invert9
xpos 1235
ypos 2906
}
FilterErode {
channels alpha
size -50
filter gaussian
name FilterErode8
xpos 1235
ypos 2944
}
Gamma {
channels alpha
value 4
name Gamma6
xpos 1235
ypos 2982
}
Premult {
name Premult9
xpos 1235
ypos 3030
}
push $Na1e60800
Merge {
inputs 2
name Merge8
xpos 993
ypos 3030
}
set Nce179400 [stack 0]
Dot {
name Dot16
xpos 1027
ypos 3056
}
Dot {
name Dot37
xpos 1027
ypos 3139
}
set Nce178c00 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy18
xpos 1113
ypos 3129
}
Blur {
channels rgba
size 768
name Blur4
xpos 1113
ypos 3192
}
Unpremult {
name Unpremult10
xpos 1113
ypos 3218
}
set Nce117c00 [stack 0]
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle10
xpos 1113
ypos 3406
}
Unpremult {
name Unpremult21
xpos 1113
ypos 3436
}
set Nce117400 [stack 0]
Dot {
name Dot39
xpos 1269
ypos 3440
}
push $Nce117400
push $Nce17b000
Dot {
name Dot17
xpos 1269
ypos 3088
}
push $Nce117c00
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy19
xpos 1235
ypos 3212
}
Invert {
channels alpha
name Invert10
xpos 1235
ypos 3250
}
FilterErode {
channels alpha
size -100
filter gaussian
name FilterErode3
xpos 1235
ypos 3288
}
Gamma {
channels alpha
value 4
name Gamma7
xpos 1235
ypos 3326
}
Premult {
name Premult10
xpos 1235
ypos 3374
}
push $Nce178c00
Merge {
inputs 2
name Merge9
xpos 993
ypos 3374
}
set Nce115400 [stack 0]
Dot {
name Dot38
xpos 1027
ypos 3400
}
Dot {
name Dot40
xpos 1027
ypos 3483
}
set Nce114c00 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy20
xpos 1113
ypos 3473
}
Blur {
channels rgba
size 1536
name Blur10
xpos 1113
ypos 3536
}
Unpremult {
name Unpremult11
xpos 1113
ypos 3562
}
Copy {
inputs 2
from0 rgba.red
to0 rgba.alpha
name Copy21
xpos 1235
ypos 3556
}
Invert {
channels alpha
name Invert11
xpos 1235
ypos 3594
}
FilterErode {
channels alpha
size -200
filter gaussian
name FilterErode9
xpos 1235
ypos 3632
}
Gamma {
channels alpha
value 4
name Gamma8
xpos 1235
ypos 3670
}
Premult {
name Premult11
xpos 1235
ypos 3718
}
push $Nce114c00
Merge {
inputs 2
name Merge10
xpos 993
ypos 3718
}
Dot {
name Dot45
xpos 765
ypos 3722
}
push $Nce115400
Dot {
name Dot41
xpos 764
ypos 3378
}
push $Nce179400
Dot {
name Dot36
xpos 764
ypos 3034
}
push $Na1e61000
Dot {
name Dot35
xpos 764
ypos 2690
}
push $Na1eacc00
Dot {
name Dot34
xpos 764
ypos 2346
}
push $Nb1140800
Dot {
name Dot33
xpos 764
ypos 2002
}
push $Ncc704400
Dot {
name Dot32
xpos 764
ypos 1658
}
push $Ncc707c00
Dot {
name Dot31
xpos 764
ypos 1314
}
push $Ncc75f800
Dot {
name Dot30
xpos 764
ypos 970
}
push $Nf05bb000
Dot {
name Dot29
xpos 764
ypos 626
}
push $Nf060a400
Dot {
name Dot28
xpos 761
ypos 387
}
Switch {
inputs 11
which {{multi}}
name Switch1
xpos 92
ypos 3718
}
Copy {
inputs 2
from0 rgba.alpha
to0 rgba.alpha
name ChannelCopy2
tile_color 0x9e3c6300
xpos 92
ypos 3917
}
Output {
name Output1
xpos 92
ypos 4005
}
end_group
push $cut_paste_input
Group {
name IBK_Boss2
tile_color 0xa300ff
selected true
xpos -31514
ypos 13395
addUserKnob {20 User l "IBK Colour"}
addUserKnob {68 output l Output M {"Final Key" "Difference Matte" "Clean Plate" ""}}
addUserKnob {26 ""}
addUserKnob {26 ""}
addUserKnob {41 screen_type l "screen type" T IBKColour_master.screen_type}
addUserKnob {41 off l darks T IBKColour_master.off}
addUserKnob {41 mult l lights T IBKColour_master.mult}
addUserKnob {26 ""}
addUserKnob {41 erode T IBKColour_master.erode}
addUserKnob {26 ""}
addUserKnob {20 ExtraControls l "Extra Controls" n 1}
addUserKnob {26 Extrahelp l "" +STARTLINE T "Add value to this slider \nif your clean plate has holes in it. "}
addUserKnob {7 CleanPlateFiller l "Clean Plate Filler" t "Add value to \nthis slider if your clean plate has holes in it. " R 64 512}
CleanPlateFiller 200
addUserKnob {20 endGroup n -1}
addUserKnob {26 ""}
addUserKnob {26 Help l "" +STARTLINE T "Automatically generate a clean \nplate then use IBK to key. \n\nModify the clean plate using rotos or \npaint strokes to \nenhance detail in soft areas like hair or motion blur. "}
addUserKnob {26 ""}
addUserKnob {26 Title l "" +STARTLINE T "IBKBoss by Ben Wotton  - \nben.wotton.vfx@gmail.com"}
addUserKnob {20 KeyControls l "IBK Gizmo"}
addUserKnob {41 st l "screen type" T IBKGizmo.st}
addUserKnob {41 colour l "colour " T IBKGizmo.colour}
addUserKnob {26 ""}
addUserKnob {41 red_weight l "red weight" T IBKGizmo.red_weight}
addUserKnob {41 blue_green_weight l "blue/green weight" T IBKGizmo.blue_green_weight}
addUserKnob {26 ""}
addUserKnob {41 lm_enable l "luminance match" T IBKGizmo.lm_enable}
addUserKnob {41 level l "screen range" T IBKGizmo.level}
addUserKnob {41 luma l "luminance level" T IBKGizmo.luma}
addUserKnob {41 ll_enable l enable T IBKGizmo.ll_enable}
addUserKnob {26 ""}
addUserKnob {41 autolevels T IBKGizmo.autolevels}
addUserKnob {41 yellow T IBKGizmo.yellow}
addUserKnob {41 cyan T IBKGizmo.cyan}
addUserKnob {41 magenta T IBKGizmo.magenta}
addUserKnob {26 ""}
addUserKnob {41 ss l "screen subtraction" T IBKGizmo.ss}
addUserKnob {41 ublu l "use bkg luminance" T IBKGizmo.ublu}
addUserKnob {41 ubcr l "use bkg chroma" T IBKGizmo.ubcr}
}
Input {
inputs 0
name Paint
xpos 1051
ypos -260
number 1
}
Expression {
channel0 rgba
expr0 "red != 0 ? 1 : 0"
name Expression1
xpos 1051
ypos -159
}
Invert {
name Invert1
xpos 1051
ypos -133
}
Input {
inputs 0
name Plate
xpos 1414
ypos -250
}
Dot {
name Dot1
xpos 1448
ypos -168
}
set Ncfe25400 [stack 0]
IBKColourV3 {
name IBKColour_master
xpos 1186
ypos -172
Size 0
erode 30
}
Merge2 {
inputs 2
operation multiply
name Merge1
xpos 1186
ypos -127
}
set Nf718d000 [stack 0]
IBKColourV3 {
name IBKStack_1
xpos 1186
ypos -101
screen_type {{parent.input.input.IBK2.screen_type x74 1 x1018 1}}
Size 1
off {{input.input.off} {input.input.off} {input.input.off}}
mult {{input.input.mult} {input.input.mult} {input.input.mult}}
multi 1
}
IBKColourV3 {
name IBKStack_2
xpos 1186
ypos -75
screen_type {{parent.input.IBK2.screen_type x1018 1}}
Size 1
off {{input.off} {input.off} {input.off}}
mult {{input.mult} {input.mult} {input.mult}}
multi {{input.multi*2}}
}
IBKColourV3 {
name IBKStack_3
xpos 1186
ypos -49
screen_type {{parent.input.IBK2.screen_type x1018 1}}
Size 1
off {{input.off} {input.off} {input.off}}
mult {{input.mult} {input.mult} {input.mult}}
multi {{input.multi*2}}
}
IBKColourV3 {
name IBKStack_4
xpos 1186
ypos -23
screen_type {{parent.input.IBK2.screen_type x1018 1}}
Size 1
off {{input.off} {input.off} {input.off}}
mult {{input.mult} {input.mult} {input.mult}}
multi {{input.multi*2}}
}
IBKColourV3 {
name IBKStack_5
xpos 1186
ypos 3
screen_type {{parent.input.IBK2.screen_type x1018 1}}
Size 1
off {{input.off} {input.off} {input.off}}
mult {{input.mult} {input.mult} {input.mult}}
multi {{input.multi*2}}
}
IBKColourV3 {
name IBKStack_6
xpos 1186
ypos 29
screen_type {{parent.input.IBK2.screen_type x1018 1}}
Size 1
off {{input.off} {input.off} {input.off}}
mult {{input.mult} {input.mult} {input.mult}}
multi {{input.multi*2}}
}
IBKColourV3 {
name IBKStack_7
xpos 1186
ypos 55
screen_type {{parent.input.IBK2.screen_type x1018 1}}
Size 1
off {{input.off} {input.off} {input.off}}
mult {{input.mult} {input.mult} {input.mult}}
multi {{parent.CleanPlateFiller}}
}
set N75caf200 [stack 0]
push $Nf718d000
Input {
inputs 0
name bg
xpos 1639
ypos -252
number 2
}
Dot {
name Dot2
xpos 1673
ypos 59
}
push $N75caf200
push $Ncfe25400
IBKGizmoV3 {
inputs 3
name IBKGizmo
selected false
xpos 1414
ypos 55
lm_enable true
autolevels true
}
Switch {
inputs 3
which {{parent.output}}
name Switch1
xpos 1414
ypos 137
}
Output {
name Output1
xpos 1414
ypos 206
}
end_group
push $cut_paste_input
Group {
name Feather_v02_1
selected true
xpos -32733
ypos 13233
addUserKnob {20 User}
addUserKnob {41 channels T Blur1.channels}
addUserKnob {7 amount R -100 100}
amount 100
addUserKnob {41 filter T Blur1.filter}
addUserKnob {26 ""}
addUserKnob {4 fallOff M {linear smooth smooth0 smooth1 "" "" "" ""}}
fallOff smooth
addUserKnob {41 value l gamma T Gamma1.value}
}
Input {
inputs 0
name InputMask
xpos 655
ypos -80
number 1
}
Invert {
name Invert1
xpos 655
ypos -24
}
AddChannels {
channels rgba
name AddChannels1
selected true
xpos 655
ypos 33
}
Invert {
name Invert2
xpos 655
ypos 95
}
Input {
inputs 0
name Input1
xpos 181
ypos -498
}
Dot {
name Dot5
xpos 215
ypos -433
}
set Ncebff800 [stack 0]
Blur {
channels rgba
size {{parent.amount*2 i}}
name Blur1
label "\[value size]"
xpos 181
ypos -360
}
set Ncebff400 [stack 0]
Grade {
channels {{{parent.Blur1.channels}}}
whitepoint 0.47
white_clamp true
name Grade2
xpos 287
ypos -280
}
push $Ncebff400
Grade {
channels {{{parent.Blur1.channels}}}
blackpoint 0.52
white_clamp true
name Grade1
xpos 181
ypos -280
}
Switch {
inputs 2
which {{"parent.amount < 0 ? 0 : 1" i}}
name Switch1
xpos 181
ypos -234
}
Dot {
name Dot1
xpos 215
ypos -188
}
set Ncebfe400 [stack 0]
Dot {
name Dot4
xpos 310
ypos -188
}
set Ncebfe000 [stack 0]
Dot {
name Dot2
xpos 434
ypos -188
}
set Ncebfdc00 [stack 0]
Dot {
name Dot3
xpos 544
ypos -188
}
ColorLookup {
channels {{{parent.Blur1.channels}}}
lut {master {curve L 0 C k 1 s0}
  red {}
  green {}
  blue {}
  alpha {}}
name ColorLookup2
label smooth1
xpos 510
ypos -147
}
push $Ncebfdc00
ColorLookup {
channels {{{parent.Blur1.channels}}}
lut {master {curve C k 0 s0 L 1}
  red {}
  green {}
  blue {}
  alpha {}}
name ColorLookup1
label smooth0
xpos 400
ypos -148
}
push $Ncebfe000
ColorLookup {
channels {{{parent.Blur1.channels}}}
lut {master {curve C k 0 s0 1 s0}
  red {}
  green {}
  blue {}
  alpha {}}
name ColorLookup3
label smooth
xpos 276
ypos -146
}
push $Ncebfe400
Switch {
inputs 4
which {{parent.fallOff i}}
name Switch2
xpos 181
ypos -75
}
Clamp {
channels {{{parent.Blur1.channels}}}
name Clamp1
xpos 181
ypos -38
}
Gamma {
channels {{{parent.Blur1.channels}}}
name Gamma1
xpos 181
ypos 22
}
push $Ncebff800
Dot {
name Dot6
xpos 53
ypos -433
}
Dot {
name Dot7
xpos 53
ypos 105
}
Keymix {
inputs 3
name Keymix1
xpos 181
ypos 95
}
Output {
name Output1
xpos 181
ypos 258
}
end_group
push $cut_paste_input
Group {
name LumaKeyer1
onCreate "n = nuke.thisNode()\nn.knob('blackpoint').setRange(0, 1)\nn.knob('whitepoint').setRange(0, 1)"
tile_color 0x421010ff
selected true
xpos -32597
ypos 13191
addUserKnob {20 User l lumaKeyer}
addUserKnob {4 output M {Alpha RGBA}}
addUserKnob {41 blackpoint T picker.blackpoint}
addUserKnob {41 whitepoint T picker.whitepoint}
addUserKnob {6 invert +STARTLINE}
addUserKnob {4 smoothing l Smoothing: M {None Smooth Smooth0 Smooth1 ""}}
addUserKnob {26 ""}
addUserKnob {26 "" l mask T ""}
addUserKnob {41 maskChannelInput l "" -STARTLINE T Merge1.maskChannelInput}
addUserKnob {41 inject -STARTLINE T Merge1.inject}
addUserKnob {41 invert_mask l invert -STARTLINE T Merge1.invert_mask}
addUserKnob {41 fringe -STARTLINE T Merge1.fringe}
addUserKnob {41 mix T Merge1.mix}
addUserKnob {20 info}
addUserKnob {22 btn l DerekVFX.ca T "import os\nimport sys\n\ntry:\n    import subprocess\n    def _run(cmd, shell, wait):\n        opener = subprocess.Popen(cmd, shell=shell)\n        if wait:\n            opener.wait()\n        return opener.pid\nexcept ImportError:\n    import popen2\n    def _run(cmd, shell, wait):\n        opener = popen2.Popen3(cmd)\n        if wait:\n            opener.wait()\n        return opener.pid\n\ndef _open(url, wait=0):\n    if sys.platform == \"darwin\":\n        cmd = \[\"open\", url]\n    elif hasattr(os, \"startfile\"):\n        return os.startfile(url)\n    elif os.environ.has_key(\"KDE_FULL_SESSION\") or os.environ.has_key(\"KDE_MULTIHEAD\") or \\\n        os.environ.has_key(\"GNOME_DESKTOP_SESSION_ID\") or os.environ.has_key(\"GNOME_KEYRING_SOCKET\"):\n        cmd = \[\"xdg-open\", url]\n    else:\n        raise OSError, \"Desktop not supported.\"\n\n    return _run(cmd, 0, wait)\n\n_open('http://www.derekvfx.ca/')" +STARTLINE}
addUserKnob {26 versionUpdate l "" -STARTLINE T "<font color = gray> adjusted by Tony Lyons </font color = gray>"}
}
Input {
inputs 0
name Input1
xpos 57
ypos -347
}
set Naceee400 [stack 0]
Colorspace {
colorspace_out HSL
name Colorspace1
xpos -181
ypos -181
}
set Naceee000 [stack 0]
Shuffle {
red blue
green blue
alpha blue
name Shuffle1
tile_color 0x3d3f8e00
xpos -336
ypos -181
}
Grade {
name picker
xpos -336
ypos -139
}
Input {
inputs 0
name Inputmask
xpos 231
ypos 446
number 1
}
push $Naceee400
Dot {
name Dot5
note_font_size 41
xpos 91
ypos 284
}
set Naceed000 [stack 0]
push $Naceee000
Expression {
expr3 smoothstep(parent.picker.blackpoint,parent.picker.whitepoint,b)
name Expression1
xpos -181
ypos -138
}
Dot {
name Dot1
note_font_size 41
xpos -147
ypos -58
}
set Naceec800 [stack 0]
ColorLookup {
channels {{{parent.ColorLookup_smooth.channels}}}
lut {master {curve L 0 C k 1 s0}
  red {}
  green {}
  blue {}
  alpha {}}
name ColorLookup_smooth1
xpos -69
ypos 33
}
push $Naceec800
ColorLookup {
channels {{{parent.ColorLookup_smooth.channels}}}
lut {master {curve L 0 s0 1}
  red {}
  green {}
  blue {}
  alpha {}}
name ColorLookup_smooth0
xpos -181
ypos 32
}
push $Naceec800
ColorLookup {
lut {master {curve L 0 s0 C k 1 s0}
  red {}
  green {}
  blue {}
  alpha {}}
name ColorLookup_smooth
xpos -293
ypos 32
}
push $Naceec800
Dot {
name Dot2
note_font_size 41
xpos -345
ypos -52
}
Dot {
name Dot3
note_font_size 41
xpos -345
ypos 131
}
Switch {
inputs 4
which {{parent.smoothing}}
name Switch1
label "\[value which]"
xpos -181
ypos 121
}
Expression {
expr3 1-a
name Expression2
xpos -181
ypos 191
disable {{"parent.invert == 0"}}
}
Merge2 {
inputs 2
operation copy
Achannels {rgba.red rgba.green rgba.blue -rgba.alpha}
Bchannels {rgba.red rgba.green rgba.blue -rgba.alpha}
output {rgba.red rgba.green rgba.blue -rgba.alpha}
name Merge2
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos -181
ypos 280
}
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle2
tile_color 0xffffffff
xpos -181
ypos 328
disable {{!parent.output}}
}
Dot {
name Dot4
note_font_size 41
xpos -147
ypos 450
}
push $Naceed000
Shuffle {
alpha black
name Shuffle3
label "\[value in]"
xpos 57
ypos 331
}
Shuffle {
red black
green black
blue black
alpha black
name Shuffle4
label "\[value in]"
selected true
xpos 57
ypos 369
disable {{!parent.output}}
}
Merge2 {
inputs 2+1
operation copy
also_merge rgba
name Merge1
label "\[ expr \{ \[value mix] == 1 ? \" \" : \[concat Mix: \[value mix]] \}]"
xpos 57
ypos 446
}
set Ncc53d000 [stack 0]
Output {
name Output1
xpos 57
ypos 602
}
push $Ncc53d000
Viewer {
frame_range 989-1078
name Viewer1
xpos 158
ypos 548
addUserKnob {20 User}
addUserKnob {6 toAddBtn -STARTLINE}
toAddBtn true
addUserKnob {6 toAddBtn_1 l toAddBtn -STARTLINE}
}
end_group
push $cut_paste_input
Group {
name Colour_Smear3
note_font Verdana
selected true
xpos -32706
ypos 13473
addUserKnob {20 User}
addUserKnob {26 smearing l Smearing T ""}
addUserKnob {6 already_premulted l "Input is premultiplied?" t "Click checkbox \"on\" if image is already premulted" +STARTLINE}
already_premulted true
addUserKnob {7 pre_choke l Pre-choke R 0 30}
pre_choke 2.5
addUserKnob {7 pre_contrast l "Pre Contrast" R 0 0.5}
pre_contrast 0.084
addUserKnob {7 pre_blur l Pre-blur R 0 100}
pre_blur 8.5
addUserKnob {7 post_blur l "Post Blur" R 0 100}
post_blur 5.5
addUserKnob {26 ""}
addUserKnob {26 Masking}
addUserKnob {6 xor_edge_detect l "Use XOR edge detect method?" t "XOR edge detect will isolate edge mask to areas that are blurred. Regular edge detect method will apply smear evenly all the way around." +STARTLINE}
addUserKnob {7 dilate_mask l "Dilate Mask" R 0 30}
dilate_mask 2.8
addUserKnob {7 blur_mask l "Blur Mask" R 0 100}
blur_mask 3.5
addUserKnob {6 output_premulted l "Premultiply output" +STARTLINE}
output_premulted true
addUserKnob {26 ""}
addUserKnob {6 outputmask l "Output smear mask?" +STARTLINE}
outputmask true
addUserKnob {26 smearmask_description l " (uses 'smearmask.a' channel - handy for regraining later)" -STARTLINE}
addUserKnob {26 ""}
addUserKnob {26 RestoreDetail l "Restore Detail"}
addUserKnob {7 sharpness l Sharpness R 0 10}
sharpness 10
addUserKnob {7 amount l Amount}
amount 0.1
addUserKnob {26 ""}
addUserKnob {26 credit l "" +STARTLINE T "Colour Smear v2.1 by Richard Frazer - www.richardfrazer.com"}
}
BackdropNode {
inputs 0
name BackdropNode1
tile_color 0x7171c600
label "Restore detail"
note_font Verdana
note_font_size 42
xpos -833
ypos 14
bdwidth 546
bdheight 976
}
BackdropNode {
inputs 0
name BackdropNode18
tile_color 0x7171c600
label "unpremult / blur trick"
note_font Verdana
note_font_size 42
xpos 653
ypos 25
bdwidth 856
bdheight 999
}
BackdropNode {
inputs 0
name BackdropNode19
tile_color 0x7171c600
label "mask to smear back over shot"
note_font Verdana
note_font_size 42
xpos -239
ypos 27
bdwidth 649
bdheight 976
}
BackdropNode {
inputs 0
name BackdropNode20
tile_color 0x7171c600
label "colour smear\n<-- in here goes plate with alpha (unpremulted) "
note_font Verdana
note_font_size 42
xpos -1098
ypos -281
bdwidth 2603
bdheight 277
}
StickyNote {
inputs 0
name StickyNote20
label "bigger blur will smear\ncolour out further\nbut may cause\nbleed\nin areas of high contrast"
note_font Verdana
note_font_size 31
xpos 1122
ypos 405
}
StickyNote {
inputs 0
name StickyNote23
label "xor way \nisolates areas\nwith highest\namounts of blur\n(i.e\nmotion blur)"
note_font Verdana
note_font_size 31
xpos -338
ypos 288
}
StickyNote {
inputs 0
name StickyNote25
label "tweak the \ndilate and \nblur to make\nnice"
note_font Verdana
xpos -1
ypos 581
}
StickyNote {
inputs 0
name StickyNote24
label "choose which works best"
note_font Verdana
note_font_size 31
xpos -115
ypos 774
}
StickyNote {
inputs 0
name StickyNote22
label "this way \nsmears evenly\naround all\nedges"
note_font Verdana
note_font_size 31
xpos 211
ypos 235
}
StickyNote {
inputs 0
name StickyNote27
label "shuffle original alpha back in"
note_font Verdana
note_font_size 31
xpos -1369
ypos 1645
}
StickyNote {
inputs 0
name StickyNote26
label "smear back over edges"
note_font Verdana
note_font_size 31
xpos -1057
ypos 1295
}
StickyNote {
inputs 0
name StickyNote19
label "choke back alpha first\nso that no background\ncolour is bought in"
note_font Verdana
note_font_size 31
xpos 1131
ypos 229
}
StickyNote {
inputs 0
name StickyNote1
label "mask input - \nareas with solid matte\nwill be excluded from \nbeing effected"
note_font Verdana
note_font_size 31
xpos 1716
ypos -149
}
StickyNote {
inputs 0
name StickyNote21
label "just to soften areas\nwith hard edges"
note_font Verdana
note_font_size 31
xpos 682
ypos 670
}
Input {
inputs 0
name IMG
label "Your main image input"
note_font Verdana
xpos -1238
ypos -298
}
set Nedc98400 [stack 0]
Dot {
name Dot29
note_font Verdana
xpos -1204
ypos -109
}
set Ne4439c00 [stack 0]
Dot {
name Dot7
xpos -1204
ypos 1270
}
Dot {
name Dot18
note_font Verdana
xpos -1204
ypos 1564
}
set Ne4439400 [stack 0]
push $Ne4439c00
Unpremult {
name Unpremult2
note_font Verdana
xpos -1073
ypos -108
}
push $Ne4439c00
Switch {
inputs 2
which {{"\[value parent.already_premulted]" i}}
name Switch1
note_font Verdana
xpos -1073
ypos -56
}
Dot {
name Dot30
note_font Verdana
xpos -901
ypos -52
}
set Ne4438800 [stack 0]
Dot {
name Dot5
xpos -562
ypos -52
}
set Ne4438400 [stack 0]
Dot {
name Dot17
note_font Verdana
xpos 42
ypos -52
}
set Nedc73c00 [stack 0]
Dot {
name Dot38
note_font Verdana
xpos 42
ypos 122
}
set Nedc73800 [stack 0]
Dot {
name Dot145
note_font Verdana
xpos -39
ypos 122
}
set Nedc73400 [stack 0]
Dot {
name Dot138
note_font Verdana
xpos -92
ypos 185
}
push $Nedc73400
Dot {
name Dot39
note_font Verdana
xpos 4
ypos 193
}
Merge2 {
inputs 2
operation xor
name Merge14
note_font Verdana
xpos -71
ypos 243
}
Dilate {
channels alpha
size {{"\[value parent.dilate_mask]" i}}
name Dilate2
note_font Verdana
xpos -71
ypos 319
}
Grade {
channels alpha
gamma 2
black_clamp false
name Grade16
note_font Verdana
xpos -71
ypos 394
}
Clamp {
name Clamp2
note_font Verdana
xpos -71
ypos 432
}
Blur {
size {{"\[value parent.blur_mask]" i}}
name Blur13
note_font Verdana
xpos -71
ypos 516
}
Dot {
name Dot156
note_font Verdana
xpos -37
ypos 659
}
push $Nedc73800
Dot {
name Dot20
note_font Verdana
xpos 119
ypos 122
}
Dilate {
channels alpha
size {{"-\[value parent.dilate_mask]" i}}
name Dilate4
note_font Verdana
xpos 85
ypos 271
}
Grade {
channels alpha
blackpoint 0.022
whitepoint 0.69
gamma 0.94
black_clamp false
name Grade18
note_font Verdana
xpos 85
ypos 344
}
Invert {
channels alpha
name Invert4
note_font Verdana
xpos 85
ypos 392
}
Clamp {
name Clamp8
note_font Verdana
xpos 85
ypos 430
}
Blur {
size {{"\[value parent.blur_mask]" i}}
name Blur17
note_font Verdana
xpos 85
ypos 510
}
Dot {
name Dot147
note_font Verdana
xpos 119
ypos 670
}
Switch {
inputs 2
which {{"\[value parent.xor_edge_detect]" i}}
name Switch3
note_font Verdana
xpos 7
ypos 747
}
push $Nedc73c00
Dot {
name Dot71
note_font Verdana
xpos 1045
ypos -52
}
Dot {
name Dot1
note_font Verdana
xpos 1045
ypos 100
}
set Nedc1a800 [stack 0]
push $Nedc1a800
Input {
inputs 0
name OMIT
label "The area to omit from being affected"
note_font Verdana
xpos 1582
ypos -260
number 1
}
Dot {
name Dot2
note_font Verdana
xpos 1616
ypos 50
}
set Nedc1a000 [stack 0]
Merge2 {
inputs 2
operation out
name Merge1
note_font Verdana
xpos 1088
ypos 147
}
Switch {
inputs 2
name Switch4
note_font Verdana
xpos 1011
ypos 209
}
FilterErode {
channels alpha
size {{"\[value parent.pre_choke]" i}}
name FilterErode2
note_font Verdana
xpos 1011
ypos 280
}
Grade {
channels alpha
blackpoint {{"\[value parent.pre_contrast]"}}
whitepoint {{"1-\[value parent.pre_contrast]"}}
black_clamp false
name Grade19
note_font Verdana
xpos 1011
ypos 341
}
Clamp {
channels alpha
name Clamp4
note_font Verdana
xpos 1011
ypos 390
}
Premult {
name Premult3
note_font Verdana
xpos 1011
ypos 471
}
Blur {
size {{"\[value parent.pre_blur]" i}}
name Blur8
note_font Verdana
xpos 1011
ypos 560
}
Unpremult {
name Unpremult1
note_font Verdana
xpos 1011
ypos 643
}
Blur {
size {{"\[value parent.post_blur]" i}}
name Blur20
note_font Verdana
xpos 1011
ypos 704
}
Dot {
name Dot61
note_font Verdana
xpos 1045
ypos 795
}
ShuffleCopy {
inputs 2
name ShuffleCopy1
note_font Verdana
xpos 7
ypos 901
}
Premult {
name Premult4
note_font Verdana
xpos 7
ypos 1045
}
Dot {
name Dot4
note_font Verdana
xpos 41
ypos 1122
}
set N38f4e800 [stack 0]
Merge2 {
inputs 2
operation mask
name Merge5
xpos -498
ypos 1611
}
push $Ne4439400
push $Ne4438400
Dot {
name Dot6
xpos -562
ypos 162
}
set N38f4e000 [stack 0]
push $N38f4e000
Blur {
size {{"\[value parent.sharpness]" i}}
name Blur1
xpos -728
ypos 211
}
Merge2 {
inputs 2
operation divide
name Merge3
xpos -596
ypos 283
}
ColorCorrect {
saturation 0
name ColorCorrect1
xpos -596
ypos 375
}
Dot {
name Dot8
xpos -554
ypos 1268
}
push $N38f4e800
push $N38f4e800
push $Nedc1a000
Dot {
name Dot3
note_font Verdana
xpos 1616
ypos 967
}
Merge2 {
inputs 2
operation out
name Merge2
note_font Verdana
xpos 76
ypos 1192
}
Switch {
inputs 2
name Switch5
note_font Verdana
xpos 7
ypos 1253
}
Unpremult {
name Unpremult3
xpos -471
ypos 1330
}
Merge2 {
inputs 2
operation multiply
output {rgba.red rgba.green rgba.blue -rgba.alpha}
mix {{"\[value parent.amount]"}}
name Merge4
xpos -588
ypos 1352
}
Premult {
name Premult1
xpos -588
ypos 1393
}
push $Ne4438800
Merge2 {
inputs 2
name Merge13
note_font Verdana
xpos -935
ypos 1393
}
ShuffleCopy {
inputs 2
name ShuffleCopy2
note_font Verdana
xpos -1238
ypos 1725
}
set N38ef2c00 [stack 0]
Premult {
name Premult10
note_font Verdana
xpos -1130
ypos 1789
}
push $N38ef2c00
Switch {
inputs 2
which {{"\[value parent.output_premulted]" i}}
name Switch2
note_font Verdana
xpos -1238
ypos 1878
}
Dot {
name Dot9
xpos -1204
ypos 1996
}
set N38ef2000 [stack 0]
add_layer {smearmask smearmask.a}
ShuffleCopy {
inputs 2
alpha alpha2
black alpha
out2 smearmask
name ShuffleCopy3
note_font Verdana
xpos -1140
ypos 2066
}
push $N38ef2000
Switch {
inputs 2
which {{"\[value parent.outputmask]"}}
name Switch6
note_font Verdana
selected true
xpos -1238
ypos 2141
}
set N38ef1800 [stack 0]
Dot {
name Dot19
note_font Verdana
xpos -1204
ypos 2343
}
Output {
name Output1
note_font Verdana
xpos -1238
ypos 2422
}
push $N38ef2000
push 0
push 0
push 0
push 0
push $Nedc98400
push $N38ef1800
Viewer {
inputs 7
frame 1059
frame_range 1001-1368
fps 25
center_fstop 0
input_process false
name Viewer1
note_font Verdana
xpos -2639
ypos 1011
}
end_group
push $cut_paste_input
Saturation {
saturation 3
name VIEWER_INPUT
selected true
xpos -32734
ypos 13397
}
Group {
inputs 0
name PA_EdgeMatte1
tile_color 0xff5f00ff
note_font "Bitstream Vera Sans Bold"
selected true
xpos -32725
ypos 13302
addUserKnob {20 User}
addUserKnob {4 Style l Filter M {Blur Box Triangle Quadractic Gaussian ""}}
addUserKnob {26 ""}
addUserKnob {7 GrowOut l "Grow Out" R -100 -1}
GrowOut -1
addUserKnob {41 size l "Grow Out Blur" T Blur1.size}
addUserKnob {26 ""}
addUserKnob {7 GrowIn l "Grow In" R 1 100}
GrowIn 1
addUserKnob {41 size_1 l "Grow In Blur" T Blur2.size}
addUserKnob {26 ""}
addUserKnob {26 Author l "" +STARTLINE T "EdgeMatte v2.0\nCreated by Pedro Andrade\n-2014-"}
addUserKnob {26 ""}
addUserKnob {22 Link l "How It Works" T "import os\nimport sys\n\ntry:\n    import subprocess\n    def _run(cmd, shell, wait):\n        opener = subprocess.Popen(cmd, shell=shell)\n        if wait:\n            opener.wait()\n        return opener.pid\nexcept ImportError:\n    import popen2\n    def _run(cmd, shell, wait):\n        opener = popen2.Popen3(cmd)\n        if wait:\n            opener.wait()\n        return opener.pid\n\ndef _open(url, wait=0):\n    if sys.platform == \"darwin\":\n        cmd = \[\"open\", url]\n    elif hasattr(os, \"startfile\"):\n        return os.startfile(url)\n    elif os.environ.has_key(\"KDE_FULL_SESSION\") or os.environ.has_key(\"KDE_MULTIHEAD\") or \\\n        os.environ.has_key(\"GNOME_DESKTOP_SESSION_ID\") or os.environ.has_key(\"GNOME_KEYRING_SOCKET\"):\n        cmd = \[\"xdg-open\", url]\n    else:\n        raise OSError, \"Desktop not supported.\"\n\n    return _run(cmd, 0, wait)\n\n_open('http://youtu.be/2dNT_Rasrek')" +STARTLINE}
}
StickyNote {
inputs 0
name StickyNote1
label blur
note_font "Bitstream Vera Sans Bold"
xpos -932
ypos 588
}
StickyNote {
inputs 0
name StickyNote2
label box
note_font "Bitstream Vera Sans Bold"
xpos -576
ypos 588
}
StickyNote {
inputs 0
name StickyNote3
label triangle
note_font "Bitstream Vera Sans Bold"
xpos -136
ypos 588
}
StickyNote {
inputs 0
name StickyNote4
label quadractic
note_font "Bitstream Vera Sans Bold"
xpos 291
ypos 588
}
StickyNote {
inputs 0
name StickyNote5
label gaussian
note_font "Bitstream Vera Sans Bold"
xpos 680
ypos 588
}
Input {
inputs 0
name img
xpos 694
ypos -416
}
Dot {
name Dot27
xpos 728
ypos -308
}
Dot {
name Dot26
xpos 740
ypos 12
}
set Na864c800 [stack 0]
FilterErode {
size {{parent.Erode2.size}}
filter gaussian
name FilterErode9
label "\[value filter]"
xpos 779
ypos 162
}
Blur {
name Blur2
xpos 779
ypos 264
}
set Ca861bc00 [stack 0]
push $Na864c800
FilterErode {
size {{parent.Erode1.size}}
filter gaussian
name FilterErode10
label "\[value filter]"
xpos 624
ypos 162
}
Blur {
name Blur1
xpos 647
ypos 264
}
set Ca861b400 [stack 0]
Merge2 {
inputs 2
operation stencil
name Merge18
xpos 692
ypos 388
}
Shuffle {
in alpha
name Shuffle5
label "\[value in]"
xpos 692
ypos 502
}
push $Na864c800
Dot {
name Dot25
xpos 338
ypos 12
}
set Na861a800 [stack 0]
FilterErode {
size {{parent.Erode2.size}}
filter quadratic
name FilterErode7
label "\[value filter]"
xpos 383
ypos 178
}
clone $Ca861bc00 {
xpos 383
ypos 264
selected false
}
push $Na861a800
FilterErode {
size {{parent.Erode1.size}}
filter quadratic
name FilterErode8
label "\[value filter]"
xpos 234
ypos 178
}
clone $Ca861b400 {
xpos 255
ypos 264
selected false
}
Merge2 {
inputs 2
operation stencil
name Merge17
xpos 294
ypos 388
}
Shuffle {
in alpha
name Shuffle6
label "\[value in]"
xpos 294
ypos 502
}
push $Na861a800
Dot {
name Dot22
xpos -100
ypos 12
}
set Na8618c00 [stack 0]
FilterErode {
size {{parent.Erode2.size}}
filter triangle
name FilterErode5
label "\[value filter]"
xpos -72
ypos 178
}
clone $Ca861bc00 {
xpos -72
ypos 264
selected false
}
push $Na8618c00
FilterErode {
size {{parent.Erode1.size}}
filter triangle
name FilterErode6
label "\[value filter]"
xpos -218
ypos 178
}
clone $Ca861b400 {
xpos -199
ypos 264
selected false
}
Merge2 {
inputs 2
operation stencil
name Merge15
xpos -148
ypos 388
}
Shuffle {
in alpha
name Shuffle7
label "\[value in]"
xpos -148
ypos 502
}
push $Na8618c00
Dot {
name Dot24
xpos -524
ypos 12
}
set Nacf5ec00 [stack 0]
FilterErode {
size {{parent.Erode2.size}}
name FilterErode4
label "\[value filter]"
xpos -489
ypos 178
}
clone $Ca861bc00 {
xpos -489
ypos 264
selected false
}
push $Nacf5ec00
FilterErode {
size {{parent.Erode1.size}}
name FilterErode3
label "\[value filter]"
xpos -640
ypos 178
}
clone $Ca861b400 {
xpos -612
ypos 264
selected false
}
Merge2 {
inputs 2
operation stencil
name Merge12
xpos -573
ypos 388
}
Shuffle {
in alpha
name Shuffle8
label "\[value in]"
xpos -573
ypos 502
}
push $Nacf5ec00
Dot {
name Dot21
xpos -873
ypos 12
}
set Nacf5d000 [stack 0]
Erode {
size {{parent.GrowIn}}
name Erode2
label blur
xpos -864
ypos 178
}
clone $Ca861bc00 {
xpos -864
ypos 264
selected false
}
push $Nacf5d000
Erode {
size {{parent.GrowOut}}
name Erode1
label blur
selected true
xpos -1000
ypos 178
}
clone $Ca861b400 {
xpos -1000
ypos 264
selected false
}
Merge2 {
inputs 2
operation stencil
name Merge11
xpos -932
ypos 388
}
Shuffle {
in alpha
name Shuffle4
label "\[value in]"
xpos -932
ypos 502
}
Switch {
inputs 5
which {{parent.Style}}
name Switch1
xpos -148
ypos 910
}
Output {
name Output1
xpos -148
ypos 1010
}
end_group
push $cut_paste_input
Group {
name DasGrain
help "DasGrain makes regraining as simple as clicking a few buttons.\n\nFollow the steps in the Help tab and you'll have a perfect regrain in no time!"
onCreate "import random\n\ntestimonials = \[\n    \"Such an elegant solution, love it!\",\n    \"Your gizmo is beyond expectation\",\n    \"Totally awesome!\",\n    \"DasGrain is officially the best thing ever\",\n    \"It's really working!\",\n    \"Das bringt Tr&auml;nen in meine Augen\",\n    \"DasGrain is the salvation we waited for\",\n    \"I save a lot of time, and definitely my nerves :)\",\n    \"It's alright\",\n    \"My new favourite node, thanks!<br>Having said that, ...\"\n    ]\n\nnode = nuke.thisNode()\nnode\['testimonial'].setValue('<br><br><br><i>&laquo;%s&raquo;</i><br>&mdash; anonymous<br><br>' % random.choice(testimonials))\nnode\['box'].setFlag(nuke.NO_ANIMATION)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\n\nif k.name() == 'box':\n    this_frame = nuke.frame()\n    n\['sample_frame'].setValue(this_frame)\n\nif k.name() == 'scatter':\n    n\['divider04'].setVisible(k.value() == False)\n    n\['divider05'].setVisible(k.value() == True)"
tile_color 0x7f7f7fff
label "v1.8 | 2021-03-07"
selected true
xpos -32566
ypos 13287
addUserKnob {20 DasGrain_tab l DasGrain}
addUserKnob {41 output t "<strong>regrained comp</strong> it is what it sais\n<strong>plate grain</strong> plate minus degrained plate\n<strong>normalised grain</strong> check if the normalization worked. It should be as even as possible. This is what you want to output if you want to prerender a grain plate. Later you can plug it into the <i>external grain</i> input of another DasGrain\n<strong>adapted grain</strong> check if the adaptation worked. Output this if you want to further manipulate the grain (who knows what the sup is gonna come up with...). After, simply plus it to your comp (at that point the comp has to be in the <i>camera</i> colorspace, as set in the <i>Analyze</i> tab).\n<strong>grain QC</strong> check if voronoi seams are visible (&#8594; edgeblend), or the scattered grain looks different to the original plate grain (&#8594; maybe bad sample area or wrong luminance degrain amount)" T Output.output}
addUserKnob {4 meta l "metadata from" t "Chances are you want to use the metadata from the plate, but who am I to assume :)" M {COMP PLATE}}
addUserKnob {26 spacer01_1 l " " T " "}
addUserKnob {20 GrainGroupBegin l "" +STARTLINE n -2}
addUserKnob {20 Analyze_tab l Analyze}
addUserKnob {26 text l <strong>Colorspace}
addUserKnob {41 project_colorspace l project t "set this to the project color space" T OCIOColorSpace1.in_colorspace}
addUserKnob {22 python_button l "What's this all about?" -STARTLINE T "nuke.message(\"Regraining in other color spaces than the camera native linear space can lead to unexpected behaviour.\\n\\nFor example converting Alexa plates to ACEScg might introduce negative values due to ACEScg's smaller gamut. In that case converting back to ARRI Linear ALEXA Wide Gamut will probably help.\\nJust set <i>project</i> to ACEScg and <i>camera</i> to ARRI Linear ALEXA Wide Gamut.\\n\\nThis might be transferable to other cameras, but I've only tested with Alexas.\\n---------\\nBypass by setting both knobs to the same value.\")"}
addUserKnob {41 camera_colorspace l camera t "set this to the camera native linear space" T OCIOColorSpace1.out_colorspace}
addUserKnob {26 text_2 l " " T " "}
addUserKnob {26 level l "<strong>Degrain amount"}
addUserKnob {78 luminance t "Leave this at 1 if you're working on a completely degrained plate.\n\nIn case you decided to leave some luminance grain in the degrained plate (use the DegrainHelper node for this!), set this to the same value as in the DegrainHelper in order to compensate.\n\nIf the luminance degrain amount was set to 0.8, this needs to be set to 0.8 as well.\n\nYou need to select a mask of all elements that cover the plate, otherwise the grain of whole comp will be too strong " n 1}
luminance 1
addUserKnob {26 divider01 l " "}
addUserKnob {41 degrain_amount_mask l "degrain amount mask" t "Use this channel from the mask input to specify in what area of the comp the missing luminance grain needs to be compensated." T Multiply1.maskChannelMask}
addUserKnob {41 invert_mask l invert -STARTLINE T Multiply1.invert_mask}
addUserKnob {26 spacer02 l " " T " "}
addUserKnob {26 divider02 l <strong>Analyze}
addUserKnob {3 number_of_frames l "number of frames" t "Set the number of sample frames to be spread across the input range.\n\nMore frames lead to higher accuracy.\n\nIf there are particularly bright or dark frames, set them manually in the knob below to make sure they are part of the analysis.\n\nIf you want to set all sample frames manually, set this to 0 and add the frames in the knob below."}
number_of_frames 10
addUserKnob {1 additional_frames l "additional frames" t "Set additional frames like this:\n\n1001,1020,1053 (single frames)\n1020-1040 (frame ranges)\n1020-1040x4 (frame ranges with step)"}
addUserKnob {3 sample_count l "sample count" t "The samples are spread across the sample range (which gets calculated automatically) based on the AlexaV3LogC curve. This results in more samples in the dark areas and less samples in the brights.\n\nMore samples lead to a more detailed response curve (while the accuracy is limited by the quality of the degrain)."}
sample_count 20
addUserKnob {22 analyze l Analyze t "this is where the magic happens" T "import base64\nthis = nuke.thisNode()\n\n\ndef _sample_count(this):\n    \"\"\"returns the sample count\"\"\"\n\n    sample_count = int(this\['sample_count'].value())\n\n    if sample_count <= 0:\n        raise RuntimeError('Enter a sample count greater than 0')\n\n    else:\n        return sample_count\n\n\ndef _generate_frame_list(this):\n    \"\"\"converts the frames submitted by the user into a list\"\"\"\n\n    frame_list = \[]\n    number_of_frames = int(this\['number_of_frames'].value())\n    additional_frames = this\['additional_frames'].value()\n\n    if number_of_frames < 1 and additional_frames is '':\n        raise RuntimeError('Either set the number of frames > 0\\nor define additional frames')\n\n    first_frame = max(this.input(1).firstFrame(), this.input(2).firstFrame())\n    last_frame = min(this.input(1).lastFrame(), this.input(2).lastFrame())\n\n    if number_of_frames > 0:\n        distance = (last_frame - first_frame) / (number_of_frames)\n        frame = first_frame + distance / 2\n\n        for x in range(number_of_frames):\n            int_frame = int(round(frame))\n            if int_frame not in frame_list:\n                frame_list.append(int_frame)\n\n            frame += distance\n\n    frange = nuke.FrameRanges(additional_frames.split(','))\n\n    for r in frange:\n        for f in r:\n            if f >= first_frame and f <= last_frame:\n                if f not in frame_list:\n                    frame_list.append(f)\n\n    frame_list.sort()\n\n    return frame_list\n\n\ndef _setup_for_multiframe(frame_list):\n    \"\"\" arranges all sample frames next to each other, starting at frame 0\n    and sets the frame number knob of the FrameBlend node\"\"\"\n\n    time_warp = nuke.toNode('TimeWarp1')\n    time_warp\['lookup'].clearAnimated()\n    time_warp\['lookup'].setAnimated()\n    anim_list = \[]\n\n    for n, frame in enumerate(frame_list):\n        anim_list.append(nuke.AnimationKey(n, frame))\n\n    anim = time_warp\['lookup'].animation(0)\n    anim.addKey(anim_list)\n\n    frame_blend = nuke.toNode('FrameBlend1')\n    frame_blend\['endframe'].setValue(len(frame_list)-1)\n\n\ndef _generate_sample_list(sample_count, sample_range, sample_radius):\n    \"\"\"generate a list of sample values spread equally between the\n    min and max values of the sample range\"\"\"\n\n    sample_list = \[]\n\n    for item in range(0, sample_count):\n        sample_list.append(float(item) / sample_count * (sample_range\[1] - sample_range\[0]) + sample_range\[0] + sample_radius)\n\n    return sample_list\n\n\ndef _get_sample_range(channel, channel_list, frame_list):\n    \"\"\" samples the minimum and maximum values of the given frame range and\n    sets the sample range to those values\"\"\"\n\n    curve_tool = nuke.toNode('CurveTool_Range')\n    min_knob = curve_tool\['minlumapixvalue']\n    max_knob = curve_tool\['maxlumapixvalue']\n\n    min_knob.setAnimated()\n    max_knob.setAnimated()\n\n    curve_tool\['channels'].setValue(channel)\n\n    nuke.execute(curve_tool, nuke.FrameRanges(frame_list))\n\n    index = channel_list.index(channel)\n    min_list = \[key.y for key in min_knob.animation(index).keys()]\n    max_list = \[key.y for key in max_knob.animation(index).keys()]\n\n    min_value = min(min_list)\n    max_value = max(max_list)\n\n    min_knob.clearAnimated()\n    max_knob.clearAnimated()\n    curve_tool\['minlumapixdata'].clearAnimated()\n    curve_tool\['maxlumapixdata'].clearAnimated()\n\n    return \[min_value, max_value]\n\n\ndef _sample_it(keyer, curve_tool, sample, sample_radius):\n    \"\"\"analyze the grain level per channel and sample value in the sample range\"\"\"\n\n    keyer\['temp_expr0'].setValue(str(sample - sample_radius))\n    keyer\['temp_expr1'].setValue(str(sample + sample_radius))\n\n    intensity_knob = curve_tool\['intensitydata']\n    intensity_knob.clearAnimated()\n    intensity_knob.setAnimated()\n\n    nuke.execute(curve_tool, nuke.frame(), nuke.frame())\n    sample_values = intensity_knob.value()\n    intensity_knob.clearAnimated()\n\n    return sample_values\n\n\ndef check_inputs(this):\n    if this.input(1) is None:\n        raise RuntimeError('no plate connected')\n\n    if this.input(2) is None:\n        raise RuntimeError('no degrained plate connected')\n\n    def format_tuple(node):\n        return node.format().width(), node.format().height(), node.format().pixelAspect()\n\n    if format_tuple(this.input(1)) != format_tuple(this.input(2)):\n        raise RuntimeError(\"Format missmatch: Make sure the formats of plate and degrained plate match.\")\n\n\ndef start(this):\n    \"\"\"let's do this!\"\"\"\n\n    check_inputs(this)\n\n    with this:\n        frame_list = _generate_frame_list(this)\n        _setup_for_multiframe(frame_list)\n        sample_count = _sample_count(this)\n\n        blank = base64.b64decode('cmVkIHtjdXJ2ZX0KZ3JlZW4ge2N1cnZlfQpibHVlIHtjdXJ2ZX0=').decode('ascii')\n\n        lut = nuke.toNode('Sampler1')\['lut']\n        lut.fromScript(blank)\n\n        channel_list = \['red', 'green', 'blue']\n\n        keyer = nuke.toNode('Expression2')\n        copy = nuke.toNode('Copy2')\n\n        curve_tool = nuke.toNode('CurveTool')\n        pixel = curve_tool\['ROI'].value()\[2] * curve_tool\['ROI'].value()\[3]\n\n        task = nuke.ProgressTask('Analysing...')\n        step = 100.0 / 3 / sample_count\n        progress = step\n\n        time_warp = nuke.toNode('TimeWarp1')\n        frame_blend = nuke.toNode('FrameBlend1')\n\n        time_warp\['disable'].setValue(False)\n        frame_blend\['disable'].setValue(False)\n\n        for channel in channel_list:\n            task.setMessage('\{\} range'.format(channel))\n\n            copy\['from0'].setValue('rgba.\{\}'.format(channel))\n\n            sample_range = _get_sample_range(channel, channel_list, frame_list)\n            sample_radius = (sample_range\[1] - sample_range\[0]) / sample_count / 2\n            sample_list = _generate_sample_list(sample_count, sample_range, sample_radius)\n\n            for sample in sample_list:\n                if task.isCancelled():\n                    return\n\n                task.setProgress(int(progress))\n\n                sample_values = _sample_it(keyer, curve_tool, sample, sample_radius)\n\n                task.setMessage('\{\} channel at \{\}'.format(channel, round(sample, 2)))\n\n                if sample_values\[3] * pixel >= 10:\n                    lut.setValueAt(sample_values\[0] / sample_values\[3], sample_values\[1] / sample_values\[3], channel_list.index(channel))\n\n                progress += step\n\n        time_warp\['lookup'].clearAnimated()\n        time_warp\['disable'].setValue(True)  # hopefully prevents slowing down the comp\n        frame_blend\['disable'].setValue(True)  # hopefully prevents slowing down the comp\n\n    del task\n\n\nstart(this)\n" +STARTLINE}
addUserKnob {26 divider03 l " "}
addUserKnob {41 analysis_mask l "analysis mask" t "Use this channel from the mask input to control what area of the plate will be analyzed.\n\nUsefull if the degrain is obviously bad in some areas." T ChannelMerge1.A}
addUserKnob {6 invert_1 l invert -STARTLINE}
addUserKnob {20 Adjust_tab l Adjust}
addUserKnob {22 whatsthis l "What am I looking at?" T "nuke.message(\"After the analysis you'll see the sampled grain response curves here. On the x-axis is the brightness of the image and on the y-axis the grain intensity. Grain increases with brightness, so <strong>the slope of the curves should always be positive</strong> (they should always go up &#8599;).<br><br>The quality of the curves depends entirely on the quality of the degrain. If the curves look wrong (for example they go up and down), try to improve the degrain first. If they still look wrong and the resulting regrain doesn't work well enough, you can try to improve the curves here by deleting/correcting all points that don't follow an upwards trend.<br><br>You can also extend the curves (again: with an upwards trend) if the comp has values that don't exist in the plate.<br><br>Note: The curve is used for both the normalization as well as the adaptation of the grain, so it doesn't give direct control of the grain intensity.\")" +STARTLINE}
addUserKnob {41 lut l "" +STARTLINE T Sampler1.lut}
addUserKnob {20 Replace_tab l Replace}
addUserKnob {6 external_grain l "use external grain" t "Use external grain from a second DasGrain, with the output set to 'normalised grain', to replace masked area.\nConnect it to the 'external grain' input of this DasGrain (it's a bit hidden on the left side of the node)." +STARTLINE}
addUserKnob {26 divider04 l <strong>Scatter}
addUserKnob {26 divider05 l <strong>Scatter +HIDDEN T "<span style=\"color:red\">Make sure you're sampling an area without any plate detail.</a>"}
addUserKnob {6 scatter l activate t "Activates the scatter function. It generates a new grain based on the plate grain in the sample box using a Voronoi noise." +STARTLINE}
addUserKnob {41 useGPUIfAvailable l "Use GPU if available" -STARTLINE T VoronoiScatter.useGPUIfAvailable}
addUserKnob {15 box l "sample box" t "Define an area that is used as a source for the scatter function. The plate grain in this area should be as even as possible, without any visible detail."}
box {100 100 500 300}
addUserKnob {3 sample_frame l "sample frame" t "The frame at which the grain is being sampled. Is set automatically once the sample box is changed." +DISABLED}
sample_frame 1
addUserKnob {4 stereo l "stereo behaviour" t "randomize offset per view: same voronoy pattern for all views, but different offset\n\nrandomize pattern per view: different voronoy pattern for every view" M {none "randomize offset per view" "randomize pattern per view" ""}}
addUserKnob {26 spacer06 l "" +STARTLINE T " "}
addUserKnob {6 overlay l "overlay cell pattern" t "Overlay the cell pattern of the voronoy noise. Useful to check where the seams are and if distortion or blending is necessary." +STARTLINE}
addUserKnob {7 cell_size l "cell size" t "Cell size of the scatter. Shoudn't be too small, as lower grain frequencies might break.\nCan't be too big either, to prevent it from breaking the border of the samplebox (will error if it does)." R 5 100}
cell_size 40
addUserKnob {26 spacer07 l "" +STARTLINE T " "}
addUserKnob {20 concealer l "edge concealer" n 1}
concealer 0
addUserKnob {26 concealer_help l " " T "If you can see the voronoi pattern in the grain QC output,\nincrease the edge blend size."}
addUserKnob {3 edge_blend_size l "edge blend size" t "Set the output to grain QC. If you see the cell seams, increase the edge blend size to conceal them.\n\nThis is a bit hacky and slow."}
addUserKnob {26 tip l "" -STARTLINE T "sloooow - keep this below 3 if possible"}
addUserKnob {26 distortion_help l " " T "\nDistortion might help as well, if somehow the straight\nseams are visible (you might want to toggle the overlay\nwhile adjusting)."}
addUserKnob {7 amplitude R 0 50}
addUserKnob {7 frequency R 0 50}
frequency 15
addUserKnob {20 endGroup n -1}
addUserKnob {26 divider06 l "" +STARTLINE}
addUserKnob {41 replace_mask l "replace mask" t "Use this channel from the mask input to specify where you want to use scattered grain instead of the adapted plate grain." -STARTLINE T Merge9.maskChannelMask}
addUserKnob {41 invert_mask_1 l invert -STARTLINE T Merge9.invert_mask}
addUserKnob {20 GrainGroupEnd l "" +STARTLINE n -3}
addUserKnob {20 Help_tab l Help}
addUserKnob {26 basic_setup l "" +STARTLINE T "<font size=\"5\">Basic setup</font>"}
addUserKnob {26 ""}
addUserKnob {26 explanation l "" +STARTLINE T "<strong>Bold</strong> steps are always necessary"}
addUserKnob {26 steps l "" +STARTLINE T "<br><strong>1. This should be the only regrain node in your comp.<br>2. Connect <i>plate</i>, <i>degrained plate</i> and <i>comp</i>.<br>&nbsp;&nbsp;&nbsp;&nbsp;The comp should be done on the degrained plate!</strong><br>3. Set the <i>luminance degrain amount</i>.<br><strong>4. Press the <i>Analyze</i> button.</strong><br>5. Correct the response curves in the <i>Adjust</i> tab.<br>6. Move the <i>sample box</i> to an area without any plate detail and activate <i>scatter</i>.<br>7. If necessary, activate <i>edge blend</i> and/or <i>distortion</i> to conceal seams."}
addUserKnob {26 in_depth l "" +STARTLINE T "<br>For an in depth explanation of the steps, read the tooltips and check out this video:<br><a href=\"https://vimeo.com/284820390/\"><span style=\"color:#C8C8C8;\">https://vimeo.com/284820390</a>"}
addUserKnob {26 pushthebutton l "" +STARTLINE T "<br><br>If the result is not as expected and you don't know why, push this button:"}
addUserKnob {22 troubleshoot l Troubleshoot t HEEEEEEELP T "import base64\n\nmessages = \[]\n\nthis = nuke.thisNode()\n\n#########################\n\nif this.input(0) is None or this.input(1) is None or this.input(2) is None:\n    messages.append(\"<font color='red'><strong>ERROR</strong></font> Plate, degrained plate and comp need to be connected to the appropriate inputs.\")\n\n#########################\n\nelse:\n\n    def format_to_tuple(g):\n        \"\"\"returns (1024, 786, 2.0)\n        \"\"\"\n        return (g.format().width(), g.format().height(), g.format().pixelAspect())\n\n    format_set = set(\[\n        format_to_tuple(this.input(0)),\n        format_to_tuple(this.input(1)),\n        format_to_tuple(this.input(2)),\n        ])\n    if len(format_set) != 1:\n        messages.append(\"<font color='orange'><strong>WARNING</strong></font> Format missmatch: Make sure formats of plate, degrained plate and comp match.\")\n\n    if (this.input(1).firstFrame() != this.input(2).firstFrame()) or (this.input(1).lastFrame() != this.input(2).lastFrame()):\n        messages.append(\"<font color='orange'><strong>WARNING</strong></font> The frame ranges of plate and degrained plate don't match. Double check that they belong together.\")\n\n#########################\n\nmessages.append(\"Double check that plate and degrained plate haven't been modified in any way (paint, despill, etc).\")\n\n#########################\n\nif this\['luminance'].getValue() == 1:\n    messages.append(\"Are you working on a completely degrained plate? If not, you might have to set the luminance degrain amount.\")\n\n#########################\n\nblank = base64.b64decode('cmVkIHtjdXJ2ZX0KZ3JlZW4ge2N1cnZlfQpibHVlIHtjdXJ2ZX0=').decode('ascii')\n\nwith this:\n    Sampler = nuke.toNode('Sampler1')     \n    if Sampler\['lut'].toScript() == blank:\n        messages.append(\"<font color='red'><strong>ERROR</strong></font> You haven't pressed the Analyze button yet!\")\n\n#########################\n\nclass BadThings(Exception): pass\n\ndef thingy():\n    with this:\n        Sampler = nuke.toNode('Sampler1')\n        list = this\['lut'].toScript().replace('\}','').split('\\n')\n        for item in list:\n            sample_value = 0\n            for value in item.split(' '):\n                try:\n                    value == float(value)\n                    if value < sample_value:\n                        raise BadThings(\"<font color='orange'><strong>WARNING</strong></font> Check and fix the response curves. Their slopes should always be positive (the curves should always go up &#8599;).\")\n                        \n                    else:\n                        sample_value = value\n                except ValueError:\n                    # Ignore non-numeric things like x-values of \"x5.46\" and channel names like \"red\{\" etc\n                    pass\ntry:\n    thingy()\nexcept BadThings as e:\n    messages.append(str(e))\n    \n#########################\n\nif this\['scatter'].value() == True:\n    if this\['box'].getValue() == \[100.0, 100.0, 500.0, 300.0]:\n        messages.append(\"<font color='orange'><strong>WARNING</strong></font> Scatter has been activated, but the sample box is still in its default position. Are you sure that's a good area to sample?\")\n\n#########################\n\nmessages.append(\"Did you copy/paste DasGrain from another script? Make sure to reanalyze and to reset the sample area if you are using scatter.\")\n\n#########################\n\nif len(messages) > 0:\n    nuke.message(\"<font size=\\\"5\\\">Things worth checking</font><br><br>\"\n                               \"%s<br><br><br>If any of this doesn't make sense to you, it might be worth checking out the video on vimeo.\" % (\n                                  \"<hr>\".join(\"%s: %s\" % (i+1, m) for i, m in enumerate(messages))))\n" +STARTLINE}
addUserKnob {26 dont_despair l "" +STARTLINE T "<br>If it still doesn't work and you're about to flip the table, send me a <a href=\"mailto:holtzf+nuke@gmail.com?subject=Help with DasGrain v1.7.8\"><span style=\"color:#C8C8C8;\">mail</a>.<br>I'm happy to help! :)"}
addUserKnob {20 Info_tab l Info}
addUserKnob {26 dasname l "" +STARTLINE T "<font size='5'>DasGrain</font> v1.8<br>"}
addUserKnob {26 text_1 l "" +STARTLINE T "DasGrain makes regraining as simple as clicking a few buttons.<br>Follow the steps in the <i>Help</i> tab and you'll have a perfect\nregrain<br>in no time!"}
addUserKnob {26 ""}
addUserKnob {26 info l "" +STARTLINE T "Last change: 2021-03-07\n\n"}
addUserKnob {26 name_1 l "" +STARTLINE T "Fabian Holtz"}
addUserKnob {26 mail l "" +STARTLINE T "<a href=\"mailto:holtzf+nuke@gmail.com?subject=Help with DasGrain v1.7.8\"><span style=\"color:#C8C8C8;\">holtzf+nuke@gmail.com</a>"}
addUserKnob {26 testimonial l "" +STARTLINE T "<br><br><br><i>&laquo;It's really working!&raquo;</i><br>&mdash; anonymous<br><br>"}
addUserKnob {26 ""}
addUserKnob {26 credit l "" +STARTLINE T "<br>VoronoiScatter based on <a href=\"http://www.nukepedia.com/blink/image/voronoi/\"><span style=\"color:#C8C8C8;\">Ivan Busquets' implementation</a> of<br> libNoise's\nVoronoi generator"}
addUserKnob {26 thanks l "" +STARTLINE T "<br>Special thanks to Ben Dickson for bearing with my questions and<br>problems and RSP comp for the valuable feedback."}
}
BackdropNode {
inputs 0
name BackdropNode1
tile_color 0x7f7f7fff
label "normalise grain"
note_font_size 30
xpos 170
ypos 1662
bdwidth 320
bdheight 110
}
BackdropNode {
inputs 0
name BackdropNode11
tile_color 0x7f7f7fff
label "add grain"
note_font_size 30
xpos 830
ypos 2766
bdwidth 320
bdheight 110
}
BackdropNode {
inputs 0
name BackdropNode13
tile_color 0x7f7f7fff
label scatter
note_font_size 30
xpos -50
ypos 2022
bdwidth 320
bdheight 110
}
BackdropNode {
inputs 0
name BackdropNode14
tile_color 0x7f7f7fff
label "analyze grain"
note_font_size 30
xpos -159
ypos 606
bdwidth 319
bdheight 877
}
BackdropNode {
inputs 0
name BackdropNode2
tile_color 0x7f7f7fff
label "grain response curve"
note_font_size 30
xpos 610
ypos 2574
bdwidth 320
bdheight 110
}
BackdropNode {
inputs 0
name BackdropNode3
tile_color 0x7f7f7fff
label QC
note_font_size 30
xpos 1050
ypos 3222
bdwidth 320
bdheight 110
}
BackdropNode {
inputs 0
name BackdropNode4
tile_color 0x7f7f7fff
label "grain response curve"
note_font_size 30
xpos 610
ypos 1422
bdwidth 320
bdheight 110
}
BackdropNode {
inputs 0
name BackdropNode5
tile_color 0x7f7f7fff
label "adapt grain"
note_font_size 30
xpos 170
ypos 2574
bdwidth 320
bdheight 110
}
BackdropNode {
inputs 0
name BackdropNode6
tile_color 0x7f7f7fff
label "sample range"
note_font_size 30
xpos -490
ypos 606
bdwidth 320
bdheight 110
}
BackdropNode {
inputs 0
name BackdropNode7
tile_color 0x7f7f7fff
label "luminance level"
note_font_size 30
xpos 280
ypos -282
bdwidth 760
bdheight 685
}
BackdropNode {
inputs 0
name BackdropNode8
tile_color 0x7f7f7fff
label "plate grain"
note_font_size 30
xpos 170
ypos 606
bdwidth 320
bdheight 110
}
BackdropNode {
inputs 0
name BackdropNode9
tile_color 0x7f7f7fff
label replace
note_font_size 30
xpos 60
ypos 2191
bdwidth 540
bdheight 226
}
Input {
inputs 0
name DEGRAINED_PLATE
label "\[value number]"
note_font_size 30
xpos 730
ypos -896
number 2
}
OCIOColorSpace {
in_colorspace {{OCIOColorSpace1.in_colorspace}}
out_colorspace {{OCIOColorSpace1.out_colorspace}}
name OCIOColorSpace2
xpos 730
ypos -490
}
Dot {
name Dot9
xpos 764
ypos -390
}
set N614b8800 [stack 0]
Dot {
name Dot28
xpos 764
ypos -198
}
set N614b8400 [stack 0]
Dot {
name Dot32
xpos 764
ypos 234
}
set N61477c00 [stack 0]
push $N614b8400
Dot {
name Dot27
xpos 624
ypos -198
}
Colorspace {
colorspace_out YCbCr
name Colorspace1
xpos 590
ypos -130
}
Dot {
name Dot7
xpos 624
ypos -54
}
set N61477000 [stack 0]
Input {
inputs 0
name PLATE
label "\[value number]"
note_font_size 30
xpos 290
ypos -892
number 1
}
Dot {
name Dot50
xpos 324
ypos -726
}
set N61476800 [stack 0]
OCIOColorSpace {
in_colorspace scene_linear
out_colorspace scene_linear
name OCIOColorSpace1
xpos 290
ypos -490
}
Dot {
name Dot29
xpos 324
ypos -198
}
set N61475c00 [stack 0]
Dot {
name Dot6
xpos 464
ypos -198
}
Colorspace {
colorspace_out YCbCr
name Colorspace2
xpos 430
ypos -130
}
Merge2 {
inputs 2
operation from
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge4
xpos 430
ypos -58
}
Multiply {
channels rgb
value {{"1 / parent.luminance - 1"} 0 0 0}
name Multiply6
xpos 430
ypos 14
}
Dot {
name Dot31
xpos 464
ypos 90
}
push $N61477000
Merge2 {
inputs 2
operation plus
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge5
xpos 590
ypos 86
}
Colorspace {
colorspace_in YCbCr
name Colorspace3
xpos 590
ypos 158
}
Merge2 {
inputs 2
operation from
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge6
xpos 590
ypos 230
}
Dot {
name Dot35
xpos 624
ypos 306
}
set N6142f400 [stack 0]
push $N61477c00
Merge2 {
inputs 2
operation from
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge7
xpos 730
ypos 302
disable {{"Multiply6.value.r == 0"}}
}
Dot {
name Dot2
xpos 764
ypos 522
}
set N6142ec00 [stack 0]
Dot {
name Dot30
xpos 764
ypos 690
}
set N6142e800 [stack 0]
Dot {
name Dot55
xpos 764
ypos 1170
}
set N6142e400 [stack 0]
Input {
inputs 0
name mask
label "\[value number]"
note_font_size 30
xpos 1170
ypos -896
number 3
}
Dot {
name Dot39
xpos 1204
ypos 258
}
set N6142dc00 [stack 0]
Dot {
name Dot26
xpos 1204
ypos 1074
}
set N6142d800 [stack 0]
Invert {
name Invert2
xpos 180
ypos 1064
disable {{!parent.invert_1}}
}
push $N6142e800
push $N61475c00
Merge2 {
inputs 2
operation from
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge27
xpos 290
ypos 686
}
Dot {
name Dot3
xpos 324
ypos 786
}
set N6142cc00 [stack 0]
Dot {
name Dot5
xpos 104
ypos 786
}
set N6142c800 [stack 0]
push $N6142c800
Copy {
inputs 2
from0 {{{parent.Copy2.from0}}}
to0 rgba.red
name Copy3
xpos 70
ypos 848
}
Expression {
expr0 abs(r)
channel1 {none none none rgba.alpha}
expr1 "r == 0"
channel2 none
channel3 none
name Expression4
xpos 70
ypos 926
}
set N2c897c00 [stack 0]
push $N6142ec00
Colorspace {
colorspace_out AlexaV3LogC
name Colorspace5
xpos 70
ypos 518
}
Clamp {
maximum_enable false
name Clamp2
xpos -40
ypos 512
}
Dot {
name Dot1
xpos -116
ypos 522
}
set N2c897000 [stack 0]
Dot {
name Dot48
xpos -116
ypos 786
}
set N2c896c00 [stack 0]
push $N2c896c00
Copy {
inputs 2
from0 rgba.blue
to0 rgba.red
name Copy2
xpos -150
ypos 848
}
Expression {
temp_name0 min
temp_name1 max
channel0 {none none none rgba.alpha}
expr0 "r >= min && r <= max"
channel1 none
channel2 none
channel3 none
name Expression2
xpos -150
ypos 926
}
Dot {
name Dot4
xpos -116
ypos 1002
}
ChannelMerge {
inputs 2
operation stencil
name ChannelMerge2
xpos -40
ypos 985
}
push $N2c897c00
Copy {
inputs 2
from0 rgba.alpha
to0 rgba.alpha
name Copy1
xpos 70
ypos 992
}
ChannelMerge {
inputs 2
A -rgba.green
operation multiply
name ChannelMerge1
xpos 70
ypos 1057
disable {{!A}}
}
Copy {
inputs 2
from0 {{{parent.Copy2.from0}}}
to0 rgba.green
name Copy4
xpos 70
ypos 1160
}
Premult {
channels {rgba.red rgba.green -rgba.blue none}
name Premult1
xpos 70
ypos 1238
}
TimeWarp {
lookup 1081
time ""
filter nearest
name TimeWarp1
xpos 70
ypos 1286
disable true
}
FrameBlend {
channels {rgba.red rgba.green -rgba.blue rgba.alpha}
startframe 0
endframe 9
userange true
name FrameBlend1
xpos 70
ypos 1352
disable true
}
CurveTool {
avgframes 0
channels {rgba.red rgba.green -rgba.blue rgba.alpha}
ROI {0 0 {width} {height}}
intensitydata {{curve}}
name CurveTool
xpos 70
ypos 1424
}
push $N2c897000
Dot {
name Dot16
xpos -336
ypos 522
}
CurveTool {
operation "Max Luma Pixel"
channels {-rgba.red -rgba.green rgba.blue none}
ROI {0 0 {width} {height}}
maxlumapixdata {{curve} {curve}}
maxlumapixvalue {{curve}}
minlumapixdata {{curve} {curve}}
minlumapixvalue {{curve}}
name CurveTool_Range
xpos -370
ypos 680
}
Sampler {
inputs 0
lut {red {curve}
  green {curve}
  blue {curve}}
name Sampler1
onCreate "n = nuke.thisNode()\nn\['sampler'].setEnabled(False)"
knobChanged "n = nuke.thisNode()\nk = nuke.thisKnob()\np = nuke.thisParent()\n\nif k.name() == 'lut':\n    with p:\n        for c in \['ColorLookup1','ColorLookup2']:\n           nuke.toNode(c)\['lut'].fromScript(k.toScript())"
xpos 840
ypos 1502
}
push $N61476800
Dot {
name Dot51
xpos 115
ypos -726
}
Input {
inputs 0
name COMP
label "\[value number]"
note_font_size 30
xpos 950
ypos -896
}
Dot {
name Dot49
xpos 984
ypos -605
}
set N2c826400 [stack 0]
Switch {
inputs 2
which {{parent.meta}}
name Switch1
xpos 81
ypos -609
}
Dot {
name Dot54
xpos 115
ypos -486
}
Dot {
name Dot52
xpos -685
ypos -486
}
Dot {
name Dot53
xpos -685
ypos 3762
}
push $N6142dc00
Dot {
name Dot40
xpos 874
ypos 258
}
push $N6142f400
Dot {
name Dot34
xpos 624
ypos 378
}
Multiply {
inputs 1+1
channels rgb
value 0
maskChannelMask -rgba.red
name Multiply1
xpos 840
ypos 374
}
push $N2c826400
OCIOColorSpace {
in_colorspace {{OCIOColorSpace1.in_colorspace}}
out_colorspace {{OCIOColorSpace1.out_colorspace}}
name OCIOColorSpace3
xpos 950
ypos -490
}
Dot {
name Dot44
xpos 984
ypos -390
}
set Nab397800 [stack 0]
Merge2 {
inputs 2
operation from
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge8
xpos 950
ypos 374
disable {{"Multiply6.value.r == 0"}}
}
Dot {
name Dot18
xpos 984
ypos 2658
}
set Nab397000 [stack 0]
ColorLookup {
lut {master {}
  red {curve}
  green {curve}
  blue {curve}
  alpha {}}
name ColorLookup2
xpos 730
ypos 2654
}
push $N6142d800
Dot {
name Dot38
xpos 1204
ypos 1842
}
Dot {
name Dot37
xpos 544
ypos 1842
}
Dot {
name Dot22
xpos 544
ypos 2271
}
set Nab396000 [stack 0]
Dot {
name Dot20
xpos 544
ypos 2391
}
push $Nab396000
Dot {
name Dot17
xpos 434
ypos 2271
}
set Nab395800 [stack 0]
Dot {
name Dot13
xpos 214
ypos 2271
}
Input {
inputs 0
name external_grain
label "\[value number]"
note_font_size 30
xpos -150
ypos 1716
number 4
}
Dot {
name Dot21
xpos -116
ypos 1938
}
push $N6142e400
ColorLookup {
channels rgb
lut {master {}
  red {curve}
  green {curve}
  blue {curve}
  alpha {}}
name ColorLookup1
xpos 730
ypos 1502
}
Dot {
name Dot24
xpos 764
ypos 1746
}
push $N6142cc00
Dot {
name Dot33
xpos 324
ypos 1386
}
MergeExpression {
inputs 2
temp_name0 target
temp_expr0 .01
expr0 "Br * (target / Ar)"
expr1 "Bg * (target / Ag)"
expr2 "Bb * (target / Ab)"
channel3 none
name MergeExpression1
xpos 290
ypos 1742
}
Dot {
name Dot15
xpos 324
ypos 1842
}
set Nab35b400 [stack 0]
Dot {
name Dot25
xpos 104
ypos 1842
}
Switch {
inputs 2
which {{parent.external_grain}}
name Switch2
xpos 70
ypos 1934
}
Group {
name VoronoiScatter
xpos 70
ypos 2102
disable {{!parent.scatter}}
addUserKnob {20 User}
addUserKnob {41 useGPUIfAvailable l "Use GPU if available" T VoroNoise.useGPUIfAvailable}
addUserKnob {41 vectorize l "Vectorize on CPU" -STARTLINE T VoroNoise.vectorize}
addUserKnob {15 box}
box {{parent.box x1004 0 x1036 -75} {parent.box x1004 100 x1036 120} {parent.box x1004 496 x1036 325} {parent.box x1004 916 x1036 320}}
addUserKnob {3 sample_frame l "sample frame"}
sample_frame {{parent.sample_frame}}
addUserKnob {7 cell_size l "cell size" R 0 100}
cell_size {{parent.cell_size}}
addUserKnob {6 overlay_pattern l "overlay pattern" -STARTLINE}
overlay_pattern {{parent.overlay}}
addUserKnob {3 edge_blend_size l "edge blend size"}
edge_blend_size {{parent.edge_blend_size}}
addUserKnob {7 amplitude R 0 100}
amplitude {{parent.amplitude}}
addUserKnob {7 frequency R 0 100}
frequency {{parent.frequency}}
addUserKnob {41 VoroNoise_Seed l Seed T VoroNoise.VoroNoise_Seed}
}
Input {
inputs 0
name Input1
xpos 180
ypos -879
}
Dot {
name Dot14
xpos 214
ypos -750
}
set Nab35a400 [stack 0]
Dot {
name Dot16
xpos 434
ypos -750
}
Remove {
name Remove1
xpos 400
ypos -687
}
Dot {
name Dot6
xpos 434
ypos -606
}
set Nab359800 [stack 0]
Dot {
name Dot15
xpos 654
ypos -606
}
set Nab359400 [stack 0]
Dot {
name Dot7
xpos 874
ypos -606
}
Noise {
output {rgba.red -rgba.green -rgba.blue none}
replace true
size {{parent.frequency} {"parent.frequency * pixel_aspect"}}
zoffset {{"x + 1000"}}
gamma 1
name Noise1
xpos 840
ypos -514
}
Noise {
output {-rgba.red rgba.green -rgba.blue none}
replace true
size {{parent.Noise1.size} {parent.Noise1.size}}
zoffset {{x}}
gamma 1
name Noise2
xpos 840
ypos -466
}
Clamp {
name Clamp1
xpos 840
ypos -424
}
Dot {
name Dot11
xpos 874
ypos -366
}
push $Nab359400
BlinkScript {
ProgramGroup 1
KernelDescription "2 \"VoroNoise\" iterate pixelWise c117be128a07c11b6d82fd34148d66b3bcac41976ec9c2082affe38e890c2c0f 2 \"src\" Read Point \"dst\" Write Point 6 \"Frequency\" Float 1 AABIQg== \"Seed\" Int 1 AAAAAA== \"aspect ratio\" Float 1 AACAPw== \"width\" Int 1 AAAAAA== \"height\" Int 1 AAAAAA== \"Randomness\" Float 1 AAAAPw== 6 \"frequency\" 1 1 \"seed\" 1 1 \"aspect_ratio\" 1 1 \"width\" 1 1 \"height\" 1 1 \"randomness\" 1 1 0"
kernelSource "// Voronoi.blink\n// A test implementation of libNoise's Voronoi generator using Blink\n// Ivan Busquets - August 2013\n// Modified for DasGrain by Fabian Holtz - April 2019\n\n#define X_NOISE_GEN  1619\n#define Y_NOISE_GEN  31337\n#define Z_NOISE_GEN  6971\n#define SEED_NOISE_GEN  1013\n#define SQRT_3 1.73205081\n\ninline int IntValueNoise3D (int x, int y, int z, int seed)\n\{\n  // All constants are primes and must remain prime in order for this noise\n  // function to work correctly.\n  int n = (\n      X_NOISE_GEN    * x\n    + Y_NOISE_GEN    * y\n    + Z_NOISE_GEN    * z\n    + SEED_NOISE_GEN * seed)\n    & 0x7fffffff;\n  n = (n >> 13) ^ n;\n  return (n * (n * n * 60493 + 19990303) + 1376312589) & 0x7fffffff;\n\}\n\ninline float ValueNoise3D (int x, int y, int z, int seed)\n\{\n  return 1.0 - ((float)IntValueNoise3D (x, y, z, seed) / 1073741824.0);\n\}\n\nkernel VoroNoise : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead> src;\n  Image<eWrite, eAccessPoint> dst;\n\nparam:\n  float frequency;\n  int seed;\n  float aspect_ratio;\n  int width;\n  int height;\n  float randomness;\n\n\n  void define() \{\n    defineParam(frequency, \"Frequency\", 50.0f);\n    defineParam(aspect_ratio, \"aspect ratio\", 1.0f);\n    defineParam(seed, \"Seed\", 0);\n    defineParam(randomness, \"Randomness\", 0.5f);\n  \}\n\n\n\n\n  void process(int2 pos) \{\n   float x = pos.x * aspect_ratio * frequency / width;\n   float y = pos.y * frequency / width;\n   int xInt = (x > 0.0) ? x : x - 1;\n   int yInt = (y > 0.0) ? y : y - 1;\n\n\n    float minDist = 2147483647.0;\n    float xCandidate = 0;\n    float yCandidate = 0;\n\n    float dist;\n\nfor (int yCur = yInt - 2; yCur <= yInt + 2; yCur++) \{\n      for (int xCur = xInt - 2; xCur <= xInt + 2; xCur++) \{\n\n        // Calculate the position and distance to the seed point inside of\n        // this unit cube. Limited by the randomness value\n        float xPos = xCur + (ValueNoise3D (xCur, yCur, 0, seed    ) + 1 ) * randomness + (1-randomness) - 1;\n        float yPos = yCur + (ValueNoise3D (xCur, yCur, 0, seed + 1) + 1 ) * randomness + (1-randomness) - 1;\n\n        float xDist = xPos - x;\n        float yDist = yPos - y;\n\n        dist = pow(xDist, 2) + pow(yDist, 2);\n        if (dist < minDist) \{\n          // This seed point is closer to any others found so far, so record\n          // this seed point.\n          minDist = dist;\n          xCandidate = xPos;\n          yCandidate = yPos;\n\t\}\n    \}\n\}\n\n    SampleType(dst) sample(0.0f);\n\n    sample.x = xCandidate / aspect_ratio / frequency;\n    sample.y = yCandidate / height * width / frequency;\n    sample.z = 0;\n\n    dst() = sample;\n\}\n\};"
rebuild ""
VoroNoise_Frequency {{"width / parent.cell_size"}}
VoroNoise_Seed {{"(x + (parent.parent.stereo == 2 ? \[lsearch \[value root.views] \[view]] / 2 : 0)) * 5"}}
"VoroNoise_aspect ratio" {{pixel_aspect}}
VoroNoise_width {{width}}
VoroNoise_height {{height}}
rebuild_finalise ""
name VoroNoise
xpos 620
ypos -520
}
Copy {
inputs 2
from0 rgba.red
to0 forward.u
from1 rgba.green
to1 forward.v
name Copy1
xpos 620
ypos -382
disable {{"parent.amplitude == 0"}}
}
IDistort {
uv forward
uv_offset 0.5
uv_scale {{parent.amplitude} {"uv_scale.w * pixel_aspect"}}
filter impulse
name IDistort1
xpos 620
ypos -280
disable {{"parent.amplitude == 0"}}
}
Dot {
name Dot5
xpos 654
ypos -246
}
NoTimeBlur {
rounding floor
name NoTimeBlur3
xpos 620
ypos -154
}
Transform {
translate {{"floor((x * size) % 1 * (size)) - int(size / 2)"} {"floor(x % 1 * (size)) - int(size/2)"}}
filter impulse
black_outside false
name Transform1
xpos 620
ypos -58
disable {{"parent.edge_blend_size < 1"}}
addUserKnob {20 User}
addUserKnob {3 size}
size {{"parent.edge_blend_size + 1"}}
}
Dot {
name Dot9
xpos 654
ypos 42
}
set Nab2f6000 [stack 0]
push $Nab359800
Expression {
expr0 "(x + .5) / width"
expr1 "(y + .5) / height"
expr2 0
name STMapGenerator
xpos 400
ypos -514
}
NoTimeBlur {
rounding floor
name NoTimeBlur2
xpos 400
ypos -154
}
Merge2 {
inputs 2
operation from
Achannels {rgba.red rgba.green -rgba.blue none}
Bchannels {rgba.red rgba.green -rgba.blue none}
output {rgba.red rgba.green -rgba.blue none}
name Merge2
xpos 400
ypos 38
}
Dot {
name Dot10
xpos 434
ypos 210
}
push $Nab2f6000
Expression {
temp_name0 view_index
temp_expr0 "parent.parent.stereo == 1 ? \[lsearch \[value root.views] \[view]] / 2 : 0"
expr0 "random((r + view_index) * 1000000, 0) * (maxx - minx) + minx"
expr1 "random((g + view_index) * 1000000, 0) * (maxy - miny) + miny"
channel2 none
channel3 none
name Expression3
xpos 620
ypos 110
addUserKnob {20 User}
addUserKnob {7 frequency R 0 100}
frequency {{parent.parent.cell_size}}
addUserKnob {7 multiplier R 0 3}
multiplier 0.5
addUserKnob {15 shrink}
shrink {{"frequency * multiplier + ceil(parent.edge_blend_size / 2) + IDistort1.uv_scale.w / 2"} {"frequency * multiplier + ceil(parent.edge_blend_size / 2) + IDistort1.uv_scale.h / 2"} {"frequency * multiplier + floor(parent.edge_blend_size / 2) + IDistort1.uv_scale.w / 2"} {"frequency * multiplier + floor(parent.edge_blend_size / 2) + IDistort1.uv_scale.h / 2"}}
addUserKnob {26 ""}
addUserKnob {7 minx}
minx {{"(parent.box.x + shrink.x + .5) / width"}}
addUserKnob {7 maxx}
maxx {{"(parent.box.r - shrink.r - .5) / width"}}
addUserKnob {7 miny}
miny {{"(parent.box.y + shrink.y + .5) / height"}}
addUserKnob {7 maxy}
maxy {{"(parent.box.t - shrink.t - .5) / height"}}
}
Merge2 {
inputs 2
operation plus
Achannels {rgba.red rgba.green -rgba.blue none}
Bchannels {rgba.red rgba.green -rgba.blue none}
output {rgba.red rgba.green -rgba.blue none}
name Merge3
xpos 620
ypos 206
}
Expression {
expr0 "(r + (maxx - minx) - minx) % (maxx - minx) + minx"
expr1 "(g + (maxy - miny) - miny) % (maxy - miny) + miny"
channel2 none
channel3 none
name Expression7
xpos 620
ypos 278
addUserKnob {20 User}
addUserKnob {7 minx}
minx {{"(parent.box.x + rint(x % 1 * parent.edge_blend_size) + .5) / width"}}
addUserKnob {7 maxx}
maxx {{"(parent.box.r + rint(x % 1 * parent.edge_blend_size) - .5) / width"}}
addUserKnob {7 miny}
miny {{"(parent.box.y + rint(x % 1 * parent.edge_blend_size) + .5) / height"}}
addUserKnob {7 maxy}
maxy {{"(parent.box.t + rint(x % 1 * parent.edge_blend_size) - .5) / height"}}
}
Dot {
name Dot3
xpos 654
ypos 354
}
set N23067c00 [stack 0]
Dot {
name Dot13
xpos 654
ypos 546
}
push $N23067c00
Dot {
name Dot8
xpos 874
ypos 354
}
Blur {
channels rgb
size {{pixel_aspect} 1}
name Blur1
label "\[value size]"
xpos 840
ypos 440
}
Difference {
inputs 2
name Difference2
xpos 840
ypos 536
}
Expression {
channel0 {none none none rgba.alpha}
expr0 "a > 1e-9"
channel1 none
channel2 none
channel3 none
name Expression2
xpos 840
ypos 614
}
Shuffle {
red alpha
green alpha
blue alpha
name Shuffle1
label "\[value in]:\[value out]"
xpos 840
ypos 680
}
Dot {
name Dot4
xpos 874
ypos 762
}
push $N23067c00
push $Nab35a400
FrameHold {
first_frame {{parent.sample_frame}}
name FrameHold1
xpos 180
ypos -256
}
NoTimeBlur {
rounding floor
name NoTimeBlur1
xpos 180
ypos -154
}
STMap {
inputs 2
channels rgb
uv rgb
filter impulse
name STMap1
xpos 180
ypos 350
}
set N23065800 [stack 0]
TimeBlur {
divisions {{"max(Transform1.size == 1 ? 2 : pow2(Transform1.size), 1)"}}
shutter 1
shuttercustomoffset {{"1 / divisions / 2"}}
name TimeBlur1
xpos 180
ypos 446
disable {{"parent.edge_blend_size < 1"}}
}
set N23065400 [stack 0]
push $N23065800
Dot {
name Dot1
xpos -6
ypos 354
}
Difference {
inputs 2
name Difference1
xpos -40
ypos 440
}
Expression {
channel0 {none none none rgba.alpha}
expr0 "a > 1e-10"
channel1 none
channel2 none
channel3 none
name Expression1
xpos -40
ypos 494
}
Blur {
channels alpha
size {{parent.parent.edge_blend_size}}
name Blur2
xpos -40
ypos 536
}
Grade {
channels alpha
blackpoint 0.5
white_clamp true
name Grade2
xpos -40
ypos 584
}
Dot {
name Dot2
xpos -6
ypos 666
}
push $N23065400
Grade {
inputs 1+1
white 1.4
black_clamp false
name Grade1
xpos 180
ypos 662
disable {{"parent.edge_blend_size < 1"}}
}
Merge2 {
inputs 2
Achannels rgb
Bchannels rgb
output rgb
name Merge1
xpos 180
ypos 758
disable {{!parent.overlay_pattern}}
}
Assert {
expression {{"Expression3.maxx > Expression3.minx && Expression3.maxy > Expression3.miny"}}
message "increase sample box size or decrease cell size"
name error
xpos 180
ypos 854
}
Output {
name Output1
xpos 180
ypos 950
}
end_group
Multiply {
inputs 1+1
channels rgb
value 1.8
maskChannelMask {{{parent.Merge9.maskChannelMask}}}
invert_mask {{!Merge9.invert_mask}}
name Multiply7
xpos 70
ypos 2315
disable {{"!maskChannelMask || !\[exists parent.input3.name]"}}
}
Dot {
name Dot23
xpos 104
ypos 2391
}
push $Nab395800
push $Nab35b400
Multiply {
inputs 1+1
channels rgb
value 1.8
maskChannelMask {{{parent.Merge9.maskChannelMask}}}
invert_mask {{parent.Merge9.invert_mask}}
name Multiply2
xpos 290
ypos 2315
disable {{"!maskChannelMask || (!parent.scatter && !parent.external_grain)"}}
}
Merge2 {
inputs 2+1
operation copy
Achannels rgb
Bchannels rgb
output rgb
maskChannelMask -rgba.alpha
name Merge9
xpos 290
ypos 2387
disable {{"!(parent.scatter || parent.external_grain)"}}
}
Dot {
name Dot11
xpos 324
ypos 2490
}
set N23005400 [stack 0]
MergeExpression {
inputs 2
temp_name0 reverse
temp_expr0 "1 / MergeExpression1.temp_expr0"
expr0 "Br * Ar * reverse"
expr1 "Bg * Ag * reverse"
expr2 "Bb * Ab * reverse"
name MergeExpression2
xpos 290
ypos 2654
}
Dot {
name Dot8
xpos 324
ypos 2850
}
push $Nab397000
Merge2 {
inputs 2
operation plus
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge3
xpos 950
ypos 2846
}
Dot {
name Dot42
xpos 984
ypos 3018
}
set N23004400 [stack 0]
OCIOColorSpace {
in_colorspace {{OCIOColorSpace1.out_colorspace}}
out_colorspace {{OCIOColorSpace1.in_colorspace}}
name OCIOColorSpace4
xpos 950
ypos 3086
}
Dot {
name Dot19
xpos 984
ypos 3162
}
set Ne4477400 [stack 0]
Dot {
name Dot41
xpos 1204
ypos 3162
}
set Ne4477000 [stack 0]
Dot {
name Dot36
xpos 1314
ypos 3162
}
Blur {
channels rgb
size 1
name Blur1
xpos 1280
ypos 3254
}
push $Ne4477000
Merge2 {
inputs 2
operation difference
bbox B
Achannels rgb
Bchannels rgb
output rgb
name Merge10
xpos 1170
ypos 3254
}
Multiply {
channels rgb
value 50
name Multiply3
xpos 1170
ypos 3302
}
Dot {
name Dot43
xpos 1204
ypos 3402
}
push $Nab397800
Dot {
name Dot45
xpos 1424
ypos -390
}
push $N23004400
Merge2 {
inputs 2
operation from
Achannels rgb
Bchannels rgb
output rgb
name Merge11
xpos 1390
ypos 3014
}
Dot {
name Dot46
xpos 1424
ypos 3522
}
push $N23005400
Dot {
name Dot14
xpos 104
ypos 2490
}
Dot {
name Dot12
xpos 104
ypos 3402
}
push $N614b8800
Dot {
name Dot47
xpos -556
ypos -390
}
push $N61475c00
Merge2 {
inputs 2
operation from
Achannels rgb
Bchannels rgb
output rgb
name Merge12
xpos -590
ypos -202
}
Dot {
name Dot10
xpos -556
ypos 3522
}
push $Ne4477400
Switch {
inputs 5
which {{output}}
name Output
xpos 950
ypos 3656
addUserKnob {20 User}
addUserKnob {4 output M {"regrained comp" "plate grain" "normalised grain" "adapted grain" "grain QC"}}
}
CopyMetaData {
inputs 2
mergeMode "Meta only"
name CopyMetaData1
xpos 950
ypos 3758
}
Output {
name Output1
xpos 950
ypos 3854
}
end_group
push $cut_paste_input
push 0
Group {
inputs 2
name ColorCopy
tile_color 0x8378ff
selected true
xpos -32430
ypos 13233
addUserKnob {20 "" l User}
addUserKnob {6 hue -STARTLINE}
hue true
addUserKnob {6 saturation -STARTLINE}
saturation true
addUserKnob {6 value -STARTLINE}
addUserKnob {7 huemix l "hue mix"}
huemix 0.27
addUserKnob {7 satmix l "saturation mix"}
satmix 0.51
addUserKnob {7 valmix l "value mix"}
valmix 1
addUserKnob {4 bbox M {"A side" "B side"}}
}
Input {
inputs 0
name B
xpos -150
ypos -450
}
set N38ef0c00 [stack 0]
Dot {
name Dot1
tile_color 0xc0c0c000
xpos -264
ypos -380
}
Input {
inputs 0
name A
xpos 245
ypos -465
number 1
}
Colorspace {
colorspace_out HSV
name Colorspace5
xpos 235
ypos -404
}
set Nf393bc00 [stack 0]
Dot {
name Dot2
tile_color 0xc0c0c000
xpos 214
ypos 114
}
push $Nf393bc00
push $Nf393bc00
push $Nf393bc00
push $N38ef0c00
Colorspace {
colorspace_out HSV
name Colorspace4
xpos -150
ypos -393
}
set Nf393b400 [stack 0]
Copy {
inputs 2
from0 rgba.red
to0 rgba.red
bbox A
name ChannelCopy3
tile_color 0x9e3c6300
label "(red -> red)"
xpos -30
ypos -270
disable {{1-parent.hue}}
}
push $Nf393b400
Dissolve {
inputs 2
channels {rgba.red -rgba.green -rgba.blue none}
which {{parent.huemix}}
name Dissolve1
label (red)
xpos -150
ypos -225
}
set Nf393ac00 [stack 0]
Copy {
inputs 2
from0 rgba.green
to0 rgba.green
bbox A
name ChannelCopy4
tile_color 0x9e3c6300
label "(green -> green)"
xpos -30
ypos -199
disable {{1-parent.saturation}}
}
push $Nf393ac00
Dissolve {
inputs 2
channels {-rgba.red rgba.green -rgba.blue none}
which {{parent.satmix}}
name Dissolve2
label (green)
xpos -150
ypos -136
}
set Nf393a400 [stack 0]
Copy {
inputs 2
from0 rgba.blue
to0 rgba.blue
bbox A
name ChannelCopy1
tile_color 0x9e3c6300
label "(blue -> blue)"
xpos -26
ypos -88
disable {{1-parent.value}}
}
push $Nf393a400
Dissolve {
inputs 2
channels {-rgba.red -rgba.green rgba.blue none}
which {{parent.valmix}}
name Dissolve3
label (blue)
xpos -150
ypos -16
}
Colorspace {
colorspace_in HSV
name Colorspace6
xpos -150
ypos 63
}
CopyBBox {
inputs 2
name CopyBBox2
tile_color 0x9e3c6300
xpos -150
ypos 111
}
CopyBBox {
inputs 2
name CopyBBox1
tile_color 0x9e3c6300
selected true
xpos -298
ypos 111
disable {{1-(parent.bbox==1)}}
}
set Nf3939000 [stack 0]
Viewer {
frame_range 1,26
roi {40 40 600 440}
name Viewer1
tile_color 0xff00f200
xpos -343
ypos -321
hide_input true
}
push $Nf3939000
Output {
name Output1
xpos -298
ypos 183
}
end_group
push $cut_paste_input
Expression {
expr0 x/root.width
expr1 y/root.height
name Expression1
label "ST MAP"
selected true
xpos -32427
ypos 13362
}
ContactSheet {
inputs 0
width {{input.width*columns*resMult}}
height {{input.height*rows*resMult}}
rows {{"\[expr \{int( (sqrt( \[numvalue inputs] ) ) )\} ] * \[expr \{int( ceil ( (\[numvalue inputs] /(sqrt( \[numvalue inputs] ) ) )) )\} ] < \[numvalue inputs]   ? \[expr \{int( (sqrt( \[numvalue inputs] ) ) )\} ] +1 : \[expr \{int( (sqrt( \[numvalue inputs] ) ) )\} ]"}}
columns {{"\[expr \{int( ceil ( (\[numvalue inputs] /(sqrt( \[numvalue inputs] )) )) )\} ]"}}
center true
roworder TopBottom
name ContactSheetAuto
tile_color 0xff69f7ff
selected true
xpos -32522
ypos 13473
cached true
addUserKnob {20 Settings}
addUserKnob {7 resMult l "Resolution Multiplier" R 0.1 2}
resMult 1
}
